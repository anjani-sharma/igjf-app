PROJECT STRUCTURE:

├── .expo
│   ├── README.md
│   └── settings.json
├── .gitignore
├── backend
│   ├── .env
│   ├── config
│   │   └── database.js
│   ├── controllers
│   │   ├── authController.js
│   │   └── memberController.js
│   ├── database.sqlite
│   ├── debug-server.js
│   ├── middleware
│   │   └── auth.js
│   ├── models
│   │   └── User.js
│   ├── package-lock.json
│   ├── package.json
│   ├── routes
│   │   ├── auth.js
│   │   └── members.js
│   ├── scripts
│   │   ├── addAadharFieldsToExisting.js
│   │   └── createAdmin.js
│   ├── server.js
│   ├── services
│   │   └── emailService.js
│   ├── test-server-with-db.js
│   ├── test-server.js
│   └── uploads
│       ├── 1758129565426.jpg
│       └── 1758131445094.jpg
├── combine.py
├── mobile-app
│   ├── .expo
│   │   ├── README.md
│   │   ├── devices.json
│   │   └── types
│   ├── .vscode
│   │   └── settings.json
│   ├── app
│   │   ├── _layout.tsx
│   │   ├── admin.tsx
│   │   ├── dashboard.tsx
│   │   ├── index.tsx
│   │   ├── login.tsx
│   │   ├── members.tsx
│   │   ├── profile-edit.tsx
│   │   ├── register.tsx
│   │   ├── roles.tsx
│   │   └── scanner.tsx
│   ├── app.json
│   ├── assets
│   │   ├── fonts
│   │   └── images
│   ├── components
│   │   ├── Collapsible.tsx
│   │   ├── ExternalLink.tsx
│   │   ├── HapticTab.tsx
│   │   ├── HelloWave.tsx
│   │   ├── ParallaxScrollView.tsx
│   │   ├── TabBarBackground.tsx
│   │   ├── ThemedText.tsx
│   │   ├── ThemedView.tsx
│   │   └── ui
│   │       ├── IconSymbol.tsx
│   │       └── TabBarBackground.ios.tsx
│   ├── constants
│   │   ├── Colors.ts
│   │   └── Theme.ts
│   ├── contexts
│   │   └── AuthContext.tsx
│   ├── eslint.config.js
│   ├── hooks
│   │   ├── useColorScheme.ts
│   │   ├── useColorScheme.web.ts
│   │   └── useThemeColor.ts
│   ├── package-lock.json
│   ├── package.json
│   ├── scripts
│   ├── services
│   │   └── apiService.js
│   ├── src
│   │   ├── components
│   │   ├── context
│   │   │   └── AuthContext.js
│   │   ├── screens
│   │   │   ├── LoginScreen.js
│   │   │   ├── RegisterScreen.js
│   │   │   └── WelcomeScreen.js
│   │   └── services
│   │       └── api.js
│   ├── tsconfig.json
│   └── utils
│       └── apiUtils.ts
├── project_code.txt
├── project_code1.txt
└── rebuild_mobile_app.py


================ CODE =================


# ==== ./combine.py ====

import os

# File extensions to include
extensions = (".py", ".js", ".ts", ".tsx", ".html", ".css", ".json")

# Files to explicitly skip (lockfiles, large auto-generated files, old exports, etc.)
skip_files = {
    "package-lock.json",
    "yarn.lock",
    "pnpm-lock.yaml",
    "poetry.lock",
    "Pipfile.lock",
    "igjf/app/project_code1.txt",  # old code base
    "igjf/app/rebuild_mobile_app.py"
}

# Folders to skip
skip_dirs = {"node_modules", "__pycache__", ".git"}

output_file = "project_code.txt"

def get_tree(path, prefix=""):
    """Return a string representing the folder tree."""
    tree_str = ""
    items = sorted(os.listdir(path))
    pointers = ["├── "] * (len(items) - 1) + ["└── "]
    for pointer, name in zip(pointers, items):
        full_path = os.path.join(path, name)
        if name in skip_dirs or full_path.replace("\\", "/") in skip_files:
            continue
        tree_str += prefix + pointer + name + "\n"
        if os.path.isdir(full_path):
            extension = "│   " if pointer == "├── " else "    "
            tree_str += get_tree(full_path, prefix + extension)
    return tree_str

with open(output_file, "w", encoding="utf-8") as outfile:
    # Write project structure first
    outfile.write("PROJECT STRUCTURE:\n\n")
    outfile.write(get_tree("."))
    outfile.write("\n\n================ CODE =================\n")

    # Then write all code files
    for root, _, files in os.walk("."):
        if any(skip in root for skip in skip_dirs):
            continue
        for file in files:
            full_path = os.path.join(root, file)
            normalized_path = full_path.replace("\\", "/")
            if file in skip_files or normalized_path in skip_files:
                continue
            if file.endswith(extensions):
                try:
                    with open(full_path, "r", encoding="utf-8") as infile:
                        outfile.write(f"\n\n# ==== {normalized_path} ====\n\n")
                        outfile.write(infile.read())
                except Exception as e:
                    outfile.write(f"\n\n# ==== {normalized_path} (ERROR READING: {e}) ====\n\n")


# ==== ./rebuild_mobile_app.py ====

#!/usr/bin/env python3
"""
Mobile App Directory Rebuild Script
This script recreates the entire mobile-app folder structure with all files
"""

import os
import json

def create_directory_structure():
    """Create all the directories needed for the mobile app"""
    directories = [
        "mobile-app",
        "mobile-app/.expo",
        "mobile-app/.expo/types",
        "mobile-app/.vscode",
        "mobile-app/app",
        "mobile-app/assets",
        "mobile-app/assets/fonts",
        "mobile-app/assets/images",
        "mobile-app/components",
        "mobile-app/components/ui",
        "mobile-app/constants",
        "mobile-app/contexts",
        "mobile-app/hooks",
        "mobile-app/scripts",
        "mobile-app/src",
        "mobile-app/src/components",
        "mobile-app/src/context",
        "mobile-app/src/screens",
        "mobile-app/src/services"
    ]
    
    for directory in directories:
        os.makedirs(directory, exist_ok=True)
        print(f"✅ Created directory: {directory}")

def create_package_json():
    """Create package.json file"""
    package_json = {
        "name": "mobile-app",
        "main": "expo-router/entry",
        "version": "1.0.0",
        "scripts": {
            "start": "expo start",
            "android": "expo start --android",
            "ios": "expo start --ios",
            "web": "expo start --web",
            "reset-project": "node ./scripts/reset-project.js"
        },
        "dependencies": {
            "@expo/metro-runtime": "~6.1.2",
            "@expo/vector-icons": "^15.0.2",
            "@react-native-async-storage/async-storage": "2.2.0",
            "expo": "^54.0.0",
            "expo-barcode-scanner": "~14.0.0",
            "expo-camera": "~17.0.7",
            "expo-constants": "~18.0.8",
            "expo-font": "~14.0.8",
            "expo-image-picker": "~17.0.8",
            "expo-linking": "~8.0.8",
            "expo-router": "~6.0.3",
            "expo-splash-screen": "~31.0.10",
            "react": "19.1.0",
            "react-native": "0.81.4",
            "react-native-qrcode-svg": "^6.3.15",
            "react-native-safe-area-context": "~5.6.0",
            "react-native-screens": "~4.16.0",
            "react-native-svg": "15.12.1",
            "expo-status-bar": "~3.0.8"
        },
        "devDependencies": {
            "@babel/core": "^7.25.2",
            "@types/react": "~19.1.10",
            "typescript": "~5.9.2"
        },
        "private": True
    }
    
    with open("mobile-app/package.json", "w") as f:
        json.dump(package_json, f, indent=2)
    print("✅ Created package.json")

def create_app_json():
    """Create app.json file"""
    app_json = {
        "expo": {
            "name": "mobile-app",
            "slug": "mobile-app",
            "version": "1.0.0",
            "orientation": "portrait",
            "scheme": "mobileapp",
            "userInterfaceStyle": "automatic",
            "newArchEnabled": True,
            "sdkVersion": "54.0.0",
            "ios": {
                "supportsTablet": True
            },
            "android": {
                "adaptiveIcon": {
                    "backgroundColor": "#ffffff"
                },
                "edgeToEdgeEnabled": True
            },
            "web": {
                "bundler": "metro",
                "output": "server"
            },
            "plugins": [
                "expo-router"
            ]
        }
    }
    
    with open("mobile-app/app.json", "w") as f:
        json.dump(app_json, f, indent=2)
    print("✅ Created app.json")

def create_tsconfig():
    """Create tsconfig.json"""
    tsconfig = {
        "compilerOptions": {},
        "extends": "expo/tsconfig.base"
    }
    
    with open("mobile-app/tsconfig.json", "w") as f:
        json.dump(tsconfig, f, indent=2)
    print("✅ Created tsconfig.json")

def create_eslint_config():
    """Create eslint.config.js"""
    eslint_content = '''// https://docs.expo.dev/guides/using-eslint/
const { defineConfig } = require('eslint/config');
const expoConfig = require('eslint-config-expo/flat');

module.exports = defineConfig([
  expoConfig,
  {
    ignores: ['dist/*'],
  },
]);
'''
    
    with open("mobile-app/eslint.config.js", "w") as f:
        f.write(eslint_content)
    print("✅ Created eslint.config.js")

def create_expo_files():
    """Create .expo directory files"""
    # devices.json
    devices_json = {"devices": []}
    with open("mobile-app/.expo/devices.json", "w") as f:
        json.dump(devices_json, f, indent=2)
    
    print("✅ Created .expo/devices.json")

def create_vscode_settings():
    """Create .vscode/settings.json"""
    settings = {
        "editor.codeActionsOnSave": {
            "source.fixAll": "explicit",
            "source.organizeImports": "explicit",
            "source.sortMembers": "explicit"
        }
    }
    
    with open("mobile-app/.vscode/settings.json", "w") as f:
        json.dump(settings, f, indent=2)
    print("✅ Created .vscode/settings.json")

def create_constants():
    """Create constants/Colors.ts"""
    colors_content = '''/**
 * Below are the colors that are used in the app. The colors are defined in the light and dark mode.
 * There are many other ways to style your app. For example, [Nativewind](https://www.nativewind.dev/), [Tamagui](https://tamagui.dev/), [unistyles](https://reactnativeunistyles.vercel.app), etc.
 */

const tintColorLight = '#0a7ea4';
const tintColorDark = '#fff';

export const Colors = {
  light: {
    text: '#11181C',
    background: '#fff',
    tint: tintColorLight,
    icon: '#687076',
    tabIconDefault: '#687076',
    tabIconSelected: tintColorLight,
  },
  dark: {
    text: '#ECEDEE',
    background: '#151718',
    tint: tintColorDark,
    icon: '#9BA1A6',
    tabIconDefault: '#9BA1A6',
    tabIconSelected: tintColorDark,
  },
};
'''
    
    with open("mobile-app/constants/Colors.ts", "w") as f:
        f.write(colors_content)
    print("✅ Created constants/Colors.ts")

def create_auth_context():
    """Create contexts/AuthContext.tsx"""
    auth_context_content = '''import React, { createContext, useState, useContext, useEffect } from 'react';
import AsyncStorage from '@react-native-async-storage/async-storage';

interface User {
  id: string;
  membershipId: string;
  name: string;
  email: string;
  role: string;
  qrCode?: string;
}

interface AuthContextType {
  user: User | null;
  login: (token: string, userData: User) => Promise<void>;
  logout: () => Promise<void>;
  loading: boolean;
}

const AuthContext = createContext<AuthContextType | undefined>(undefined);

export const AuthProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {
  const [user, setUser] = useState<User | null>(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    loadUserData();
  }, []);

  const loadUserData = async () => {
    try {
      const token = await AsyncStorage.getItem('token');
      const userData = await AsyncStorage.getItem('user');
      
      if (token && userData) {
        setUser(JSON.parse(userData));
      }
    } catch (error) {
      console.error('Error loading user data:', error);
    } finally {
      setLoading(false);
    }
  };

  const login = async (token: string, userData: User) => {
    try {
      await AsyncStorage.setItem('token', token);
      await AsyncStorage.setItem('user', JSON.stringify(userData));
      setUser(userData);
    } catch (error) {
      console.error('Error saving user data:', error);
    }
  };

  const logout = async () => {
    try {
      await AsyncStorage.removeItem('token');
      await AsyncStorage.removeItem('user');
      setUser(null);
    } catch (error) {
      console.error('Error removing user data:', error);
    }
  };

  return (
    <AuthContext.Provider value={{ user, login, logout, loading }}>
      {children}
    </AuthContext.Provider>
  );
};

export const useAuth = () => {
  const context = useContext(AuthContext);
  if (!context) {
    throw new Error('useAuth must be used within an AuthProvider');
  }
  return context;
};
'''
    
    with open("mobile-app/contexts/AuthContext.tsx", "w") as f:
        f.write(auth_context_content)
    print("✅ Created contexts/AuthContext.tsx")

def create_hooks():
    """Create hook files"""
    # useColorScheme.ts
    color_scheme_content = "export { useColorScheme } from 'react-native';"
    with open("mobile-app/hooks/useColorScheme.ts", "w") as f:
        f.write(color_scheme_content)
    
    # useColorScheme.web.ts
    color_scheme_web_content = '''import { useEffect, useState } from 'react';
import { useColorScheme as useRNColorScheme } from 'react-native';

/**
 * To support static rendering, this value needs to be re-calculated on the client side for web
 */
export function useColorScheme() {
  const [hasHydrated, setHasHydrated] = useState(false);

  useEffect(() => {
    setHasHydrated(true);
  }, []);

  const colorScheme = useRNColorScheme();

  if (hasHydrated) {
    return colorScheme;
  }

  return 'light';
}
'''
    with open("mobile-app/hooks/useColorScheme.web.ts", "w") as f:
        f.write(color_scheme_web_content)
    
    # useThemeColor.ts
    theme_color_content = '''/**
 * Learn more about light and dark modes:
 * https://docs.expo.dev/guides/color-schemes/
 */

import { Colors } from '@/constants/Colors';
import { useColorScheme } from '@/hooks/useColorScheme';

export function useThemeColor(
  props: { light?: string; dark?: string },
  colorName: keyof typeof Colors.light & keyof typeof Colors.dark
) {
  const theme = useColorScheme() ?? 'light';
  const colorFromProps = props[theme];

  if (colorFromProps) {
    return colorFromProps;
  } else {
    return Colors[theme][colorName];
  }
}
'''
    with open("mobile-app/hooks/useThemeColor.ts", "w") as f:
        f.write(theme_color_content)
    
    print("✅ Created hook files")

def create_app_layout():
    """Create app/_layout.tsx"""
    layout_content = '''import { Stack } from 'expo-router';
import { AuthProvider } from '../contexts/AuthContext';

export default function RootLayout() {
  return (
    <AuthProvider>
      <Stack screenOptions={{ headerShown: false }}>
        <Stack.Screen name="index" />
        <Stack.Screen name="register" />
        <Stack.Screen name="login" />
        <Stack.Screen name="dashboard" />
        <Stack.Screen name="admin" />
        <Stack.Screen name="scanner" />
        <Stack.Screen name="members" />
        <Stack.Screen name="roles" />
      </Stack>
    </AuthProvider>
  );
}
'''
    
    with open("mobile-app/app/_layout.tsx", "w") as f:
        f.write(layout_content)
    print("✅ Created app/_layout.tsx")

def create_app_index():
    """Create app/index.tsx"""
    index_content = '''import React, { useEffect } from 'react';
import {
  View,
  Text,
  StyleSheet,
  SafeAreaView,
  TouchableOpacity,
  Image,
} from 'react-native';
import { StatusBar } from 'expo-status-bar';
import { router } from 'expo-router';
import { useAuth } from '../contexts/AuthContext';

export default function WelcomeScreen() {
  const { user, loading } = useAuth();

  useEffect(() => {
    if (!loading) {
      if (user) {
        // User is logged in, redirect based on role
        if (user.role === 'admin') {
          router.replace('/admin');
        } else {
          router.replace('/dashboard');
        }
      }
    }
  }, [user, loading]);

  if (loading) {
    return (
      <SafeAreaView style={styles.container}>
        <View style={styles.loadingContainer}>
          <Text style={styles.loadingText}>Loading...</Text>
        </View>
        <StatusBar style="light" />
      </SafeAreaView>
    );
  }

  return (
    <SafeAreaView style={styles.container}>
      <View style={styles.header}>
        <View style={styles.logoSection}>
          <Text style={styles.partyName}>POLITICAL PARTY</Text>
          <Text style={styles.tagline}>Member Management System</Text>
        </View>
      </View>

      <View style={styles.content}>
        <View style={styles.welcomeSection}>
          <Text style={styles.title}>Welcome</Text>
          <Text style={styles.subtitle}>
            Manage your party membership with ease
          </Text>
        </View>

        <View style={styles.buttonSection}>
          <TouchableOpacity
            style={styles.loginButton}
            onPress={() => router.push('/login')}
          >
            <Text style={styles.loginButtonText}>Member Login</Text>
          </TouchableOpacity>

          <TouchableOpacity
            style={styles.registerButton}
            onPress={() => router.push('/register')}
          >
            <Text style={styles.registerButtonText}>
              Register as New Member
            </Text>
          </TouchableOpacity>
        </View>
      </View>

      <StatusBar style="light" />
    </SafeAreaView>
  );
}

const styles = StyleSheet.create({
  container: {
    flex: 1,
    backgroundColor: '#1B2951',
  },
  loadingContainer: {
    flex: 1,
    justifyContent: 'center',
    alignItems: 'center',
  },
  loadingText: {
    color: 'white',
    fontSize: 18,
  },
  header: {
    paddingTop: 60,
    paddingHorizontal: 30,
    alignItems: 'center',
  },
  logoSection: {
    alignItems: 'center',
    marginBottom: 40,
  },
  partyName: {
    fontSize: 24,
    fontWeight: 'bold',
    color: '#2D5016',
    marginBottom: 5,
  },
  tagline: {
    fontSize: 16,
    color: '#E0E0E0',
  },
  content: {
    flex: 1,
    paddingHorizontal: 30,
    justifyContent: 'center',
  },
  welcomeSection: {
    alignItems: 'center',
    marginBottom: 60,
  },
  title: {
    fontSize: 36,
    fontWeight: 'bold',
    color: 'white',
    marginBottom: 15,
  },
  subtitle: {
    fontSize: 18,
    color: '#E0E0E0',
    textAlign: 'center',
    lineHeight: 26,
  },
  buttonSection: {
    gap: 20,
  },
  loginButton: {
    backgroundColor: '#2D5016',
    paddingVertical: 18,
    borderRadius: 12,
    alignItems: 'center',
  },
  loginButtonText: {
    color: 'white',
    fontSize: 18,
    fontWeight: 'bold',
  },
  registerButton: {
    backgroundColor: 'transparent',
    borderWidth: 2,
    borderColor: 'white',
    paddingVertical: 18,
    borderRadius: 12,
    alignItems: 'center',
  },
  registerButtonText: {
    color: 'white',
    fontSize: 18,
    fontWeight: 'bold',
  },
});
'''
    
    with open("mobile-app/app/index.tsx", "w") as f:
        f.write(index_content)
    print("✅ Created app/index.tsx")

def create_root_app_js():
    """Create root App.js file"""
    app_js_content = '''import React from 'react';
import { View, Text, StyleSheet } from 'react-native';

export default function App() {
  return (
    <View style={styles.container}>
      <Text style={styles.text}>🚀 NEW APP WORKING!</Text>
    </View>
  );
}

const styles = StyleSheet.create({
  container: {
    flex: 1,
    backgroundColor: 'red',
    justifyContent: 'center',
    alignItems: 'center',
  },
  text: {
    fontSize: 30,
    color: 'white',
    fontWeight: 'bold',
  },
});
'''
    
    with open("mobile-app/App.js", "w") as f:
        f.write(app_js_content)
    print("✅ Created App.js")

def create_login_screen():
    """Create a basic login screen"""
    login_content = '''import React, { useState } from 'react';
import {
  View,
  Text,
  TextInput,
  StyleSheet,
  SafeAreaView,
  TouchableOpacity,
  Alert,
} from 'react-native';
import { StatusBar } from 'expo-status-bar';
import { router } from 'expo-router';
import { useAuth } from '../contexts/AuthContext';

const API_URL = 'http://localhost:3001/api';

export default function LoginScreen() {
  const [membershipId, setMembershipId] = useState('');
  const [password, setPassword] = useState('');
  const [loading, setLoading] = useState(false);
  const { login } = useAuth();

  const handleLogin = async () => {
    if (!membershipId.trim() || !password.trim()) {
      Alert.alert('Error', 'Please fill in all fields');
      return;
    }

    setLoading(true);

    try {
      const response = await fetch(`${API_URL}/auth/login`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          membershipId: membershipId.trim(),
          password,
        }),
      });

      const data = await response.json();

      if (response.ok) {
        await login(data.token, data.user);
        
        // Navigate based on user role
        if (data.user.role === 'admin') {
          router.replace('/admin');
        } else {
          router.replace('/dashboard');
        }
      } else {
        Alert.alert('Login Failed', data.message || 'Invalid credentials');
      }
    } catch (error) {
      console.error('Login error:', error);
      Alert.alert('Error', 'Network error. Please try again.');
    } finally {
      setLoading(false);
    }
  };

  return (
    <SafeAreaView style={styles.container}>
      <View style={styles.header}>
        <TouchableOpacity
          style={styles.backButton}
          onPress={() => router.back()}
        >
          <Text style={styles.backButtonText}>← Back</Text>
        </TouchableOpacity>
        
        <View style={styles.logoSection}>
          <Text style={styles.partyName}>POLITICAL PARTY</Text>
          <Text style={styles.title}>Member Login</Text>
        </View>
      </View>

      <View style={styles.form}>
        <TextInput
          style={styles.input}
          placeholder="Membership ID"
          value={membershipId}
          onChangeText={setMembershipId}
          autoCapitalize="none"
          autoCorrect={false}
        />
        
        <TextInput
          style={styles.input}
          placeholder="Password"
          value={password}
          onChangeText={setPassword}
          secureTextEntry
          autoCapitalize="none"
          autoCorrect={false}
        />

        <TouchableOpacity
          style={[styles.loginButton, loading && styles.disabledButton]}
          onPress={handleLogin}
          disabled={loading}
        >
          <Text style={styles.loginButtonText}>
            {loading ? 'Logging in...' : 'Login'}
          </Text>
        </TouchableOpacity>
      </View>

      <StatusBar style="light" />
    </SafeAreaView>
  );
}

const styles = StyleSheet.create({
  container: {
    flex: 1,
    backgroundColor: '#1B2951',
  },
  header: {
    paddingTop: 20,
    paddingHorizontal: 20,
    paddingBottom: 40,
  },
  backButton: {
    marginBottom: 20,
  },
  backButtonText: {
    color: 'white',
    fontSize: 16,
  },
  logoSection: {
    alignItems: 'center',
  },
  partyName: {
    fontSize: 20,
    fontWeight: 'bold',
    color: 'white',
    marginBottom: 10,
  },
  title: {
    fontSize: 28,
    fontWeight: 'bold',
    color: 'white',
  },
  form: {
    flex: 1,
    paddingHorizontal: 30,
    paddingTop: 40,
  },
  input: {
    backgroundColor: 'white',
    paddingHorizontal: 15,
    paddingVertical: 12,
    borderRadius: 8,
    marginBottom: 20,
    fontSize: 16,
  },
  loginButton: {
    backgroundColor: '#2D5016',
    paddingVertical: 15,
    borderRadius: 8,
    marginTop: 10,
  },
  loginButtonText: {
    color: 'white',
    fontSize: 18,
    fontWeight: 'bold',
    textAlign: 'center',
  },
  disabledButton: {
    backgroundColor: '#999',
  },
});
'''
    
    with open("mobile-app/app/login.tsx", "w") as f:
        f.write(login_content)
    print("✅ Created app/login.tsx")

def main():
    """Main function to create the entire mobile app structure"""
    print("🚀 Starting Mobile App Rebuild...")
    print("=" * 50)
    
    # Create directory structure
    create_directory_structure()
    print()
    
    # Create configuration files
    create_package_json()
    create_app_json()
    create_tsconfig()
    create_eslint_config()
    create_expo_files()
    create_vscode_settings()
    print()
    
    # Create source files
    create_constants()
    create_auth_context()
    create_hooks()
    print()
    
    # Create app files
    create_app_layout()
    create_app_index()
    create_login_screen()
    create_root_app_js()
    print()
    
    print("=" * 50)
    print("✅ Mobile App Structure Created Successfully!")
    print()
    print("Next steps:")
    print("1. cd mobile-app")
    print("2. npm install")
    print("3. npx expo start")
    print()
    print("Note: This script created the basic structure and core files.")
    print("You'll need to add the remaining app screens (register, dashboard, scanner, etc.)")
    print("using the code from the previous artifacts.")

if __name__ == "__main__":
    main()

# ==== ./mobile-app/app.json ====

{
  "expo": {
    "name": "mobile-app",
    "slug": "mobile-app",
    "version": "1.0.0",
    "orientation": "portrait",
    "scheme": "mobileapp",
    "userInterfaceStyle": "automatic",
    "newArchEnabled": true,
    "sdkVersion": "54.0.0",
    "ios": {
      "supportsTablet": true
    },
    "android": {
      "adaptiveIcon": {
        "backgroundColor": "#ffffff"
      },
      "edgeToEdgeEnabled": true
    },
    "web": {
      "bundler": "metro",
      "output": "server"
    },
    "plugins": [
      "expo-router"
    ]
  }
}

# ==== ./mobile-app/package.json ====

{
  "name": "mobile-app",
  "main": "expo-router/entry",
  "version": "1.0.0",
  "scripts": {
    "start": "expo start",
    "android": "expo start --android",
    "ios": "expo start --ios",
    "web": "expo start --web",
    "reset-project": "node ./scripts/reset-project.js"
  },
  "dependencies": {
    "@expo/metro-runtime": "~6.1.2",
    "@expo/vector-icons": "^15.0.2",
    "@react-native-async-storage/async-storage": "2.2.0",
    "expo": "54.0.8",
    "expo-barcode-scanner": "~14.0.0",
    "expo-camera": "~17.0.8",
    "expo-constants": "~18.0.9",
    "expo-font": "~14.0.8",
    "expo-image-picker": "~17.0.8",
    "expo-linking": "~8.0.8",
    "expo-router": "~6.0.6",
    "expo-splash-screen": "~31.0.10",
    "expo-status-bar": "~3.0.8",
    "react": "^19.1.0",
    "react-native": "0.81.4",
    "react-native-qrcode-svg": "^6.3.15",
    "react-native-safe-area-context": "~5.6.0",
    "react-native-screens": "~4.16.0",
    "react-native-svg": "15.12.1"
  },
  "devDependencies": {
    "@babel/core": "^7.25.2",
    "@types/react": "~19.1.10",
    "typescript": "~5.9.2"
  },
  "private": true
}


# ==== ./mobile-app/tsconfig.json ====

{
  "compilerOptions": {},
  "extends": "expo/tsconfig.base"
}

# ==== ./mobile-app/eslint.config.js ====

// https://docs.expo.dev/guides/using-eslint/
const { defineConfig } = require('eslint/config');
const expoConfig = require('eslint-config-expo/flat');

module.exports = defineConfig([
  expoConfig,
  {
    ignores: ['dist/*'],
  },
]);
// https://docs.expo.dev/guides/using-eslint/
const { defineConfig } = require('eslint/config');
const expoConfig = require('eslint-config-expo/flat');

module.exports = defineConfig([
  expoConfig,
  {
    ignores: ['dist/*'],
  },
]);

# ==== ./mobile-app/.expo/devices.json ====

{
  "devices": []
}

# ==== ./mobile-app/contexts/AuthContext.tsx ====

// mobile-app/contexts/AuthContext.tsx - COMPLETE FILE
import React, { createContext, useContext, useState, useEffect, ReactNode } from 'react';
import AsyncStorage from '@react-native-async-storage/async-storage';

// User interface
interface User {
  id: number;
  membershipId: string;
  fullName?: string;
  name?: string;
  email: string;
  phone?: string;
  dateOfBirth?: string;
  occupation?: string;
  address?: string;
  city?: string;
  state?: string;
  pincode?: string;
  constituency?: string;
  role: string;
  isVerified?: boolean;
  isActive?: boolean;
  profilePhoto?: string;
  qrCode?: string;
  qrCodeData?: string;
  aadharNumber?: string;
  aadharVerified?: boolean;
  aadharVerificationDate?: string;
  createdAt?: string;
  updatedAt?: string;
  registeredBy?: string;
  fatherName?: string;
  [key: string]: any;
}

interface AuthContextType {
  user: User | null;
  login: (token: string, userData: User) => Promise<void>;
  logout: () => Promise<void>;
  loading: boolean;
}

const AuthContext = createContext<AuthContextType | undefined>(undefined);

export const AuthProvider: React.FC<{ children: ReactNode }> = ({ children }) => {
  const [user, setUser] = useState<User | null>(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    loadUserData();
  }, []);

  const loadUserData = async () => {
    try {
      const token = await AsyncStorage.getItem('token');
      const userData = await AsyncStorage.getItem('user');
      
      if (token && userData) {
        const parsedUser = JSON.parse(userData);
        console.log('✅ Loaded user data:', parsedUser);
        setUser(parsedUser);
      }
    } catch (error) {
      console.error('⚠️ Error loading user data:', error);
      // Clear corrupted data
      try {
        await AsyncStorage.removeItem('token');
        await AsyncStorage.removeItem('user');
      } catch (clearError) {
        console.error('Error clearing storage:', clearError);
      }
    } finally {
      setLoading(false);
    }
  };

  const login = async (token: string, userData: User) => {
    try {
      console.log('🔐 Logging in user:', userData);
      
      await AsyncStorage.setItem('token', token);
      await AsyncStorage.setItem('user', JSON.stringify(userData));
      setUser(userData);
      
      console.log('✅ User logged in and saved to storage');
    } catch (error) {
      console.error('⚠️ Error saving user data:', error);
      throw new Error('Failed to save login data');
    }
  };

  const logout = async () => {
    try {
      console.log('🚪 Logging out user');
      
      await AsyncStorage.removeItem('token');
      await AsyncStorage.removeItem('user');
      setUser(null);
      
      console.log('✅ User logged out successfully');
    } catch (error) {
      console.error('⚠️ Error removing user data:', error);
      // Still set user to null even if storage clear fails
      setUser(null);
    }
  };

  return (
    <AuthContext.Provider value={{ user, login, logout, loading }}>
      {children}
    </AuthContext.Provider>
  );
};

export const useAuth = () => {
  const context = useContext(AuthContext);
  if (!context) {
    throw new Error('useAuth must be used within an AuthProvider');
  }
  return context;
};

export type { User };

# ==== ./mobile-app/app/index.tsx ====

import React, { useEffect } from 'react';
import {
  View,
  Text,
  StyleSheet,
  TouchableOpacity,
  Image,
} from 'react-native';
import { SafeAreaView } from 'react-native-safe-area-context';
import { StatusBar } from 'expo-status-bar';
import { router } from 'expo-router';
import { useAuth } from '../contexts/AuthContext';

export default function WelcomeScreen() {
  const { user, loading } = useAuth();

  useEffect(() => {
    if (!loading) {
      if (user) {
        // Redirect all logged-in users to the main dashboard
        router.replace('/dashboard');
      }
    }
  }, [user, loading]);

  if (loading) {
    return (
      <SafeAreaView style={styles.container}>
        <View style={styles.loadingContainer}>
          <Text style={styles.loadingText}>Loading...</Text>
        </View>
        <StatusBar style="light" />
      </SafeAreaView>
    );
  }

  return (
    <SafeAreaView style={styles.container}>
      <View style={styles.header}>
        <View style={styles.logoSection}>
          <Text style={styles.partyName}>POLITICAL PARTY</Text>
          <Text style={styles.tagline}>Member Management System</Text>
        </View>
      </View>

      <View style={styles.content}>
        <View style={styles.welcomeSection}>
          <Text style={styles.title}>Welcome</Text>
          <Text style={styles.subtitle}>
            Manage your party membership with ease
          </Text>
        </View>

        <View style={styles.buttonSection}>
          <TouchableOpacity
            style={styles.loginButton}
            onPress={() => router.push('/login')}
          >
            <Text style={styles.loginButtonText}>Member Login</Text>
          </TouchableOpacity>

          <TouchableOpacity
            style={styles.registerButton}
            onPress={() => router.push('/register')}
          >
            <Text style={styles.registerButtonText}>
              Register as New Member
            </Text>
          </TouchableOpacity>
        </View>
      </View>

      <StatusBar style="light" />
    </SafeAreaView>
  );
}

const styles = StyleSheet.create({
  container: {
    flex: 1,
    backgroundColor: '#1B2951',
  },
  loadingContainer: {
    flex: 1,
    justifyContent: 'center',
    alignItems: 'center',
  },
  loadingText: {
    color: 'white',
    fontSize: 18,
  },
  header: {
    paddingTop: 60,
    paddingHorizontal: 30,
    alignItems: 'center',
  },
  logoSection: {
    alignItems: 'center',
    marginBottom: 40,
  },
  partyName: {
    fontSize: 24,
    fontWeight: 'bold',
    color: '#2D5016',
    marginBottom: 5,
  },
  tagline: {
    fontSize: 16,
    color: '#E0E0E0',
  },
  content: {
    flex: 1,
    paddingHorizontal: 30,
    justifyContent: 'center',
  },
  welcomeSection: {
    alignItems: 'center',
    marginBottom: 60,
  },
  title: {
    fontSize: 36,
    fontWeight: 'bold',
    color: 'white',
    marginBottom: 15,
  },
  subtitle: {
    fontSize: 18,
    color: '#E0E0E0',
    textAlign: 'center',
    lineHeight: 26,
  },
  buttonSection: {
    gap: 20,
  },
  loginButton: {
    backgroundColor: '#2D5016',
    paddingVertical: 18,
    borderRadius: 12,
    alignItems: 'center',
  },
  loginButtonText: {
    color: 'white',
    fontSize: 18,
    fontWeight: 'bold',
  },
  registerButton: {
    backgroundColor: 'transparent',
    borderWidth: 2,
    borderColor: 'white',
    paddingVertical: 18,
    borderRadius: 12,
    alignItems: 'center',
  },
  registerButtonText: {
    color: 'white',
    fontSize: 18,
    fontWeight: 'bold',
  },
});


# ==== ./mobile-app/app/roles.tsx ====

import React, { useState, useEffect } from 'react';
import {
  View,
  Text,
  StyleSheet,
  FlatList,
  TouchableOpacity,
  ActivityIndicator,
  Alert,
} from 'react-native';
import { SafeAreaView } from 'react-native-safe-area-context';
import { StatusBar } from 'expo-status-bar';
import { router } from 'expo-router';
import { useAuth } from '../contexts/AuthContext';
import AsyncStorage from '@react-native-async-storage/async-storage';

export default function RoleManagement() {
  const { user } = useAuth();
  const [members, setMembers] = useState([]);
  const [loading, setLoading] = useState(true);
  const isAdmin = user?.role === 'admin';

  useEffect(() => {
    loadMembers();
  }, []);

  const loadMembers = async () => {
    try {
      const token = await AsyncStorage.getItem('token');
      const response = await fetch('http://192.168.1.65:5000/api/members/all', {
        headers: {
          'Authorization': `Bearer ${token}`,
        },
      });

      if (response.ok) {
        const data = await response.json();
        setMembers(data);
      } else {
        Alert.alert('Error', 'Failed to load members');
      }
    } catch (error) {
      console.error('Load members error:', error);
      Alert.alert('Error', 'Network error');
    } finally {
      setLoading(false);
    }
  };

  const updateMemberRole = async (memberId, newRole) => {
    try {
      console.log('Updating member:', memberId, 'to role:', newRole);
      const token = await AsyncStorage.getItem('token');
      const response = await fetch(`http://192.168.1.65:5000/api/members/role/${memberId}`, {
        method: 'PUT',
        headers: {
          'Authorization': `Bearer ${token}`,
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ role: newRole }),
      });
      console.log('Response status:', response.status); // Add this
      const responseData = await response.json(); // Add this
      console.log('Response data:', responseData); // Add this


      if (response.ok) {
        Alert.alert('Success', 'Role updated successfully');
        loadMembers(); // Reload the list
      } else {
        Alert.alert('Error', 'Failed to update role');
      }
    } catch (error) {
      console.error('Update role error:', error);
      Alert.alert('Error', 'Network error');
    }
  };

  const deleteMember = async (memberId) => {
    if (!isAdmin) {
      Alert.alert('Access Denied', 'Only admins can delete members');
      return;
    }

    Alert.alert(
      'Delete Member',
      'Are you sure you want to delete this member? This action cannot be undone.',
      [
        { text: 'Cancel', style: 'cancel' },
        {
          text: 'Delete',
          style: 'destructive',
          onPress: async () => {
            try {
              const token = await AsyncStorage.getItem('token');
              const response = await fetch(`http://192.168.1.65:5000/api/members/${memberId}`, {
                method: 'DELETE',
                headers: {
                  'Authorization': `Bearer ${token}`,
                  'Content-Type': 'application/json',
                },
                body: JSON.stringify({  // Add the required confirmationText
                  confirmationText: 'DELETE MEMBER'
                }),
              });

              if (response.ok) {
                Alert.alert('Success', 'Member deleted successfully');
                loadMembers();
              } else {
                const errorData = await response.json();
                Alert.alert('Error', errorData.message || 'Failed to delete member');
              }
            } catch (error) {
              console.error('Delete member error:', error);
              Alert.alert('Error', 'Network error');
            }
          }
        }
      ]
    );
  };

  const showRoleOptions = (member) => {
    const options = ['member', 'organizer'];
    if (isAdmin) {
      options.push('admin');
    }

    Alert.alert(
      'Change Role',
      `Select new role for ${member.personalInfo.fullName}:`,
      [
        ...options.map(role => ({
          text: role.charAt(0).toUpperCase() + role.slice(1),
          onPress: () => {
            if (role !== member.role) {
              updateMemberRole(member._id, role);
            }
          }
        })),
        { text: 'Cancel', style: 'cancel' }
      ]
    );
  };

  const renderMember = ({ item }) => (
    <View style={styles.memberCard}>
      <View style={styles.memberHeader}>
        <View style={styles.avatar}>
          <Text style={styles.avatarText}>
            {item.personalInfo.fullName.charAt(0).toUpperCase()}
          </Text>
        </View>
        <View style={styles.memberInfo}>
          <Text style={styles.memberName}>{item.personalInfo.fullName}</Text>
          <Text style={styles.memberId}>ID: {item.membershipId}</Text>
          <Text style={styles.memberEmail}>{item.personalInfo.email}</Text>
        </View>
      </View>

      <View style={styles.memberActions}>
        <View style={styles.currentRole}>
          <Text style={styles.roleLabel}>Current Role:</Text>
          <Text style={[
            styles.roleValue,
            { 
              color: item.role === 'admin' ? '#FF5722' : 
                     item.role === 'organizer' ? '#2196F3' : '#4CAF50'
            }
          ]}>
            {item.role?.toUpperCase() || 'MEMBER'}
          </Text>
        </View>

        <View style={styles.actionButtons}>
          <TouchableOpacity
            style={styles.roleButton}
            onPress={() => showRoleOptions(item)}
          >
            <Text style={styles.roleButtonText}>Change Role</Text>
          </TouchableOpacity>

          {isAdmin && (
            <TouchableOpacity
              style={styles.deleteButton}
              onPress={() => deleteMember(item._id)}
            >
              <Text style={styles.deleteButtonText}>Delete</Text>
            </TouchableOpacity>
          )}
        </View>
      </View>
    </View>
  );

  if (loading) {
    return (
      <SafeAreaView style={styles.container}>
        <View style={styles.header}>
          <TouchableOpacity
            style={styles.backButton}
            onPress={() => router.back()}
          >
            <Text style={styles.backButtonText}>← Back</Text>
          </TouchableOpacity>
          <Text style={styles.title}>Loading...</Text>
        </View>
        <View style={styles.loadingContainer}>
          <ActivityIndicator size="large" color="#2D5016" />
        </View>
      </SafeAreaView>
    );
  }

  return (
    <SafeAreaView style={styles.container}>
      <View style={styles.header}>
        <TouchableOpacity
          style={styles.backButton}
          onPress={() => router.back()}
        >
          <Text style={styles.backButtonText}>← Back</Text>
        </TouchableOpacity>
        <Text style={styles.title}>Manage Roles</Text>
      </View>

      <View style={styles.infoCard}>
        <Text style={styles.infoText}>
          {isAdmin 
            ? 'Admin Access: You can change member roles and delete members.'
            : 'Organizer Access: You can change member roles but cannot delete members.'
          }
        </Text>
      </View>

      <FlatList
        data={members}
        renderItem={renderMember}
        keyExtractor={(item) => item._id.toString()}
        contentContainerStyle={styles.listContainer}
        showsVerticalScrollIndicator={false}
      />

      <StatusBar style="light" />
    </SafeAreaView>
  );
}

const styles = StyleSheet.create({
  container: {
    flex: 1,
    backgroundColor: '#f5f5f5',
  },
  header: {
    backgroundColor: '#1B2951',
    paddingVertical: 15,
    paddingHorizontal: 20,
    flexDirection: 'row',
    alignItems: 'center',
  },
  backButton: {
    marginRight: 15,
  },
  backButtonText: {
    color: 'white',
    fontSize: 16,
  },
  title: {
    color: 'white',
    fontSize: 18,
    fontWeight: 'bold',
    flex: 1,
  },
  loadingContainer: {
    flex: 1,
    justifyContent: 'center',
    alignItems: 'center',
  },
  infoCard: {
    backgroundColor: '#E3F2FD',
    margin: 15,
    padding: 15,
    borderRadius: 8,
    borderLeftWidth: 4,
    borderLeftColor: '#2196F3',
  },
  infoText: {
    fontSize: 14,
    color: '#1565C0',
  },
  listContainer: {
    paddingVertical: 10,
  },
  memberCard: {
    backgroundColor: 'white',
    marginHorizontal: 15,
    marginVertical: 5,
    borderRadius: 12,
    padding: 15,
    shadowColor: '#000',
    shadowOffset: { width: 0, height: 2 },
    shadowOpacity: 0.1,
    shadowRadius: 4,
    elevation: 3,
  },
  memberHeader: {
    flexDirection: 'row',
    alignItems: 'center',
    marginBottom: 15,
  },
  avatar: {
    width: 50,
    height: 50,
    borderRadius: 25,
    backgroundColor: '#2D5016',
    justifyContent: 'center',
    alignItems: 'center',
    marginRight: 15,
  },
  avatarText: {
    fontSize: 18,
    fontWeight: 'bold',
    color: 'white',
  },
  memberInfo: {
    flex: 1,
  },
  memberName: {
    fontSize: 16,
    fontWeight: 'bold',
    color: '#333',
    marginBottom: 2,
  },
  memberId: {
    fontSize: 14,
    color: '#2D5016',
    fontWeight: '600',
    marginBottom: 2,
  },
  memberEmail: {
    fontSize: 14,
    color: '#666',
  },
  memberActions: {
    borderTopWidth: 1,
    borderTopColor: '#e0e0e0',
    paddingTop: 15,
  },
  currentRole: {
    flexDirection: 'row',
    alignItems: 'center',
    marginBottom: 10,
  },
  roleLabel: {
    fontSize: 14,
    color: '#666',
    marginRight: 10,
  },
  roleValue: {
    fontSize: 14,
    fontWeight: 'bold',
  },
  actionButtons: {
    flexDirection: 'row',
    gap: 10,
  },
  roleButton: {
    backgroundColor: '#2196F3',
    paddingVertical: 8,
    paddingHorizontal: 15,
    borderRadius: 6,
    flex: 1,
  },
  roleButtonText: {
    color: 'white',
    fontSize: 14,
    fontWeight: 'bold',
    textAlign: 'center',
  },
  deleteButton: {
    backgroundColor: '#F44336',
    paddingVertical: 8,
    paddingHorizontal: 15,
    borderRadius: 6,
    flex: 1,
  },
  deleteButtonText: {
    color: 'white',
    fontSize: 14,
    fontWeight: 'bold',
    textAlign: 'center',
  },
});

# ==== ./mobile-app/app/login.tsx ====

// mobile-app/app/login.tsx - COMPLETE FILE
import React, { useState } from 'react';
import {
  View,
  Text,
  TextInput,
  StyleSheet,
  SafeAreaView,
  TouchableOpacity,
  Alert,
  KeyboardAvoidingView,
  Platform,
} from 'react-native';
import { StatusBar } from 'expo-status-bar';
import { router } from 'expo-router';
import { useAuth } from '../contexts/AuthContext';
import { authAPI, handleApiError } from '../services/apiService';

export default function LoginScreen() {
  const [identifier, setIdentifier] = useState('');
  const [password, setPassword] = useState('');
  const [loading, setLoading] = useState(false);
  const { login } = useAuth();

  const handleLogin = async () => {
    // Input validation
    if (!identifier.trim() || !password.trim()) {
      Alert.alert('Error', 'Please fill in all fields');
      return;
    }

    setLoading(true);

    try {
      console.log('🔐 Starting login process...');
      
      // Call the API using our service
      const result = await authAPI.login(identifier.trim(), password);
      
      if (result.success) {
        console.log('✅ Login successful');
        
        // Save user data using auth context
        await login(result.data.token, result.data.user);
        
        // Navigate based on user role
        if (result.data.user.role === 'admin') {
          router.replace('/admin');
        } else {
          router.replace('/dashboard');
        }
      } else {
        console.log('❌ Login failed:', result.error);
        Alert.alert('Login Failed', result.error || 'Invalid credentials');
      }
    } catch (error) {
      console.error('🚨 Login error:', error);
      Alert.alert('Connection Error', handleApiError(error));
    } finally {
      setLoading(false);
    }
  };

  return (
    <KeyboardAvoidingView 
      style={styles.container} 
      behavior={Platform.OS === 'ios' ? 'padding' : 'height'}
    >
      <SafeAreaView style={styles.container}>
        <StatusBar style="light" />
        
        {/* Header */}
        <View style={styles.header}>
          <TouchableOpacity
            style={styles.backButton}
            onPress={() => router.back()}
          >
            <Text style={styles.backButtonText}>← Back</Text>
          </TouchableOpacity>
          
          <View style={styles.logoSection}>
            <Text style={styles.partyName}>GORKHA JANSHAKTI FRONT</Text>
            <Text style={styles.title}>Member Login</Text>
          </View>
        </View>

        {/* Form */}
        <View style={styles.form}>
          <TextInput
            style={styles.input}
            placeholder="Email or Phone"
            placeholderTextColor="#999"
            value={identifier}
            onChangeText={setIdentifier}
            autoCapitalize="none"
            autoCorrect={false}
            keyboardType="email-address"
            editable={!loading}
          />
          
          <TextInput
            style={styles.input}
            placeholder="Password"
            placeholderTextColor="#999"
            value={password}
            onChangeText={setPassword}
            secureTextEntry
            autoCapitalize="none"
            autoCorrect={false}
            editable={!loading}
          />

          <TouchableOpacity
            style={[styles.loginButton, loading && styles.disabledButton]}
            onPress={handleLogin}
            disabled={loading}
          >
            <Text style={styles.loginButtonText}>
              {loading ? 'Logging in...' : 'Login'}
            </Text>
          </TouchableOpacity>

          {/* Register Link */}
          <TouchableOpacity
            style={styles.registerLink}
            onPress={() => router.push('/register')}
          >
            <Text style={styles.registerText}>
              Don't have an account? <Text style={styles.registerTextBold}>Register</Text>
            </Text>
          </TouchableOpacity>
        </View>
      </SafeAreaView>
    </KeyboardAvoidingView>
  );
}

const styles = StyleSheet.create({
  container: {
    flex: 1,
    backgroundColor: '#1B2951',
  },
  header: {
    paddingTop: 20,
    paddingHorizontal: 20,
    paddingBottom: 40,
  },
  backButton: {
    marginBottom: 20,
  },
  backButtonText: {
    color: 'white',
    fontSize: 16,
    fontWeight: '500',
  },
  logoSection: {
    alignItems: 'center',
  },
  partyName: {
    fontSize: 18,
    fontWeight: 'bold',
    color: 'white',
    marginBottom: 10,
    textAlign: 'center',
  },
  title: {
    fontSize: 28,
    fontWeight: 'bold',
    color: 'white',
    textAlign: 'center',
  },
  form: {
    flex: 1,
    paddingHorizontal: 30,
    paddingTop: 40,
  },
  input: {
    backgroundColor: 'white',
    paddingHorizontal: 15,
    paddingVertical: 12,
    borderRadius: 8,
    marginBottom: 20,
    fontSize: 16,
  },
  loginButton: {
    backgroundColor: '#2D5016',
    paddingVertical: 15,
    borderRadius: 8,
    marginTop: 10,
  },
  loginButtonText: {
    color: 'white',
    fontSize: 18,
    fontWeight: 'bold',
    textAlign: 'center',
  },
  disabledButton: {
    backgroundColor: '#999',
    opacity: 0.6,
  },
  registerLink: {
    alignItems: 'center',
    marginTop: 30,
    paddingVertical: 10,
  },
  registerText: {
    color: 'white',
    fontSize: 16,
    opacity: 0.8,
  },
  registerTextBold: {
    color: 'white',
    fontWeight: 'bold',
    opacity: 1,
  },
});

# ==== ./mobile-app/app/dashboard.tsx ====

// File: mobile-app/app/dashboard.tsx - FIXED VERSION (Preserves all features)
import React, { useState, useEffect, useCallback, useRef } from 'react';
import {
  View,
  Text,
  StyleSheet,
  ScrollView,
  TouchableOpacity,
  Alert,
  RefreshControl,
  Image,
  Modal,
  ActivityIndicator,
} from 'react-native';
import { SafeAreaView } from 'react-native-safe-area-context';
import { StatusBar } from 'expo-status-bar';
import { router } from 'expo-router';
import { useAuth } from '../contexts/AuthContext';
import QRCode from 'react-native-qrcode-svg';
import AsyncStorage from '@react-native-async-storage/async-storage';
import { apiRequest } from '../utils/apiUtils';
import { User } from '../contexts/AuthContext'; 

const Theme = {
  colors: {
    primary: '#1B2951',
    secondary: '#2D5016',
    accent: '#E0E0E0',
    background: '#f5f5f5',
    surface: '#ffffff',
    text: {
      primary: '#333333',
      secondary: '#666666',
      onPrimary: '#ffffff',
      onSecondary: '#ffffff',
    },
    border: '#eee',
    success: '#4CAF50',
    warning: '#FF9800',
    gold: '#FFD700',
  },
  spacing: {
    xs: 4,
    sm: 8,
    md: 16,
    lg: 24,
    xl: 32,
    xxl: 40,
  },
  typography: {
    h1: { fontSize: 32, fontWeight: 'bold' as const },
    h2: { fontSize: 28, fontWeight: 'bold' as const },
    h3: { fontSize: 24, fontWeight: 'bold' as const },
    h4: { fontSize: 20, fontWeight: 'bold' as const },
    body1: { fontSize: 16, fontWeight: 'normal' as const },
    body2: { fontSize: 14, fontWeight: 'normal' as const },
    caption: { fontSize: 12, fontWeight: 'normal' as const },
  },
  borderRadius: {
    sm: 4,
    md: 8,
    lg: 12,
    xl: 16,
  },
  shadows: {
    card: {
      shadowColor: '#000',
      shadowOffset: { width: 0, height: 4 },
      shadowOpacity: 0.2,
      shadowRadius: 8,
      elevation: 8,
    },
    sm: {
      shadowColor: '#000',
      shadowOffset: { width: 0, height: 1 },
      shadowOpacity: 0.1,
      shadowRadius: 2,
      elevation: 2,
    },
  },
};

interface UserWithPersonalInfo extends User {
  personalInfo?: {
    fullName: string;
    fatherName: string;
    address: string;
    phone: string;
    email: string;
    dateOfBirth: string;
    occupation: string;
    constituency: string;
    city: string;
    state: string;
    pincode: string;
    gender: string;
  };
}

export default function Dashboard() {
  const { user, logout, login } = useAuth();
  const [profile, setProfile] = useState<UserWithPersonalInfo | null>(null);
  const [loading, setLoading] = useState(true);
  const [refreshing, setRefreshing] = useState(false);
  const [showFullDetails, setShowFullDetails] = useState(false);
  
  // 🔥 FIX: Add ref to prevent multiple API calls
  const hasLoadedProfile = useRef(false);
  const isLoadingProfile = useRef(false);

  // 🔥 FIX: Use useCallback to prevent function recreation
  const loadProfile = useCallback(async () => {
    // 🔥 FIX: Prevent multiple simultaneous calls
    if (isLoadingProfile.current) {
      console.log('⏳ Profile loading already in progress, skipping...');
      return;
    }

    try {
      console.log('📡 Starting profile load...');
      isLoadingProfile.current = true;
      setLoading(true);
      setRefreshing(true);
      
      const response = await apiRequest<{ personalInfo: User }>(`/members/profile`, {
        method: 'GET',
      });
      
      if (response.success && response.data) {
        console.log('✅ Profile loaded from API:', response.data);
        const { personalInfo, ...rest } = response.data;
        const formattedProfile = { ...rest, ...personalInfo };
        
        // 🔥 FIX: Only update context if data actually changed
        const token = await AsyncStorage.getItem('token');
        if (token && JSON.stringify(formattedProfile) !== JSON.stringify(user)) {
          await login(token, formattedProfile as User);
        }

        setProfile(formattedProfile as UserWithPersonalInfo);
        hasLoadedProfile.current = true;
      } else {
        console.log('⚠️ API call failed, using cached user data');
        setProfile(user as UserWithPersonalInfo);
        hasLoadedProfile.current = true;
      }
      
    } catch (error) {
      console.error('❌ Error loading profile:', error);
      setProfile(user as UserWithPersonalInfo);
      hasLoadedProfile.current = true;
    } finally {
      setLoading(false);
      setRefreshing(false);
      isLoadingProfile.current = false;
    }
  }, [user, login]); // Dependencies properly managed

  // 🔥 FIX: Only load once when component mounts
  useEffect(() => {
    if (!hasLoadedProfile.current && user && !isLoadingProfile.current) {
      console.log('🔄 Initial profile load...');
      loadProfile();
    }
  }, [user, loadProfile]);

  // 🔥 FIX: Separate refresh function for pull-to-refresh
  const onRefresh = useCallback(() => {
    console.log('🔄 Manual refresh triggered...');
    hasLoadedProfile.current = false; // Reset flag for manual refresh
    setRefreshing(true);
    loadProfile();
  }, [loadProfile]);

  const handleLogout = () => {
    Alert.alert(
      'Logout',
      'Are you sure you want to logout?',
      [
        { text: 'Cancel', style: 'cancel' },
        { 
          text: 'Logout', 
          onPress: async () => {
            await logout();
            router.replace('/');
          }
        },
      ]
    );
  };

  const formatDate = (dateString) => {
    if (!dateString) return 'Not available';
    try {
      return new Date(dateString).toLocaleDateString('en-US', {
        year: 'numeric',
        month: 'long',
        day: 'numeric'
      });
    } catch {
      return 'Invalid date';
    }
  };
  
  const getDisplayValue = (value: any, fallback = 'Not provided') => {
    return value && String(value).trim() ? String(value) : fallback;
  };

  const getDisplayName = () => {
    const profileName = profile?.fullName || profile?.name;
    const userName = user?.fullName || user?.name;
    return profileName || userName || 'Member';
  };

  const getProfileImageUri = () => {
    const photoPath = profile?.profilePhoto || user?.profilePhoto;
    console.log('🖼️ Profile photo path:', photoPath);
    
    if (photoPath) {
      let imageUri;
      if (photoPath.startsWith('http')) {
        imageUri = photoPath;
      } else {
        const cleanPath = photoPath.startsWith('/') ? photoPath.substring(1) : photoPath;
        imageUri = `http://192.168.1.65:5000/${cleanPath}`;
      }
      
      console.log('🖼️ Final image URI:', imageUri);
      return imageUri;
    }
    return null;
  };

  const isAdmin = () => {
    return (profile?.role || user?.role) === 'admin';
  };

  const isOrganizer = () => {
    return (profile?.role || user?.role) === 'organizer';
  };

  if (loading && !profile && !user) {
    return (
      <SafeAreaView style={styles.container} edges={['top', 'left', 'right']}>
        <View style={styles.loadingContainer}>
          <ActivityIndicator size="large" color={Theme.colors.primary} />
          <Text style={styles.loadingText}>Loading profile...</Text>
        </View>
      </SafeAreaView>
    );
  }

  return (
    <SafeAreaView style={styles.container} edges={['top', 'left', 'right']}>
      <ScrollView 
        style={styles.scrollView} 
        showsVerticalScrollIndicator={false}
        refreshControl={
          <RefreshControl refreshing={refreshing} onRefresh={onRefresh} />
        }
      >
        <View style={styles.header}>
          <View style={styles.headerContent}>
            <View style={styles.headerLeft}>
              <Text style={styles.roleText}>
                {isAdmin() ? 'ADMIN ACCOUNT' : isOrganizer() ? 'ORGANIZER ACCOUNT' : 'MEMBER ACCOUNT'}
              </Text>
              <Text style={styles.nameText}>{getDisplayName()}</Text>
            </View>
            <TouchableOpacity style={styles.logoutButton} onPress={handleLogout}>
              <Text style={styles.logoutText}>Logout</Text>
            </TouchableOpacity>
          </View>
        </View>

        <View style={styles.membershipCardContainer}>
          <View style={[
            styles.membershipCard, 
            isAdmin() && styles.adminCard,
            isOrganizer() && styles.organizerCard
          ]}>
            <View style={styles.cardHeader}>
              <View style={[
                styles.roleBadge,
                isAdmin() && styles.adminBadge,
                isOrganizer() && styles.organizerBadge
              ]}>
                <Text style={styles.roleBadgeText}>
                  {isAdmin() ? '👑 ADMIN' : isOrganizer() ? '👥 ORGANIZER' : '👤 MEMBER'}
                </Text>
              </View>
              <Text style={styles.partyName}>GORKHA JANSHAKTI FRONT</Text>
            </View>

            <View style={styles.cardContent}>
              <View style={styles.leftSection}>
                <View style={styles.photoContainer}>
                  {getProfileImageUri() ? (
                    <Image 
                      source={{ uri: getProfileImageUri() }}
                      style={styles.profileImage}
                      onError={(e) => {
                        console.log('❌ Image load error:', e.nativeEvent.error);
                        console.log('🖼️ Failed URI:', getProfileImageUri());
                      }}
                      onLoad={() => {
                        console.log('✅ Image loaded successfully:', getProfileImageUri());
                      }}
                    />
                  ) : (
                    <View style={styles.avatarContainer}>
                      <Text style={styles.avatarText}>
                        {getDisplayName().charAt(0)?.toUpperCase()}
                      </Text>
                    </View>
                  )}
                </View>

                <View style={styles.memberInfo}>
                  <Text style={styles.memberName}>{getDisplayName()}</Text>
                  <Text style={styles.membershipId}>
                    {getDisplayValue(profile?.membershipId || user?.membershipId)}
                  </Text>
                  
                  <View style={styles.memberSince}>
                    <Text style={styles.memberSinceLabel}>Member Since</Text>
                    <Text style={styles.memberSinceDate}>
                      {formatDate(profile?.createdAt || user?.createdAt)}
                    </Text>
                  </View>

                  <View style={[
                    styles.statusBadge,
                    (profile?.isVerified || user?.isVerified) && styles.verifiedBadge
                  ]}>
                    <Text style={[
                      styles.statusText,
                      (profile?.isVerified || user?.isVerified) && styles.verifiedText
                    ]}>
                      {(profile?.isVerified || user?.isVerified) ? '✓ VERIFIED' : '⏳ PENDING'}
                    </Text>
                  </View>
                </View>
              </View>

              <View style={styles.qrSection}>
                <View style={styles.qrContainer}>
                  <QRCode
                    value={profile?.membershipId || user?.membershipId || 'No ID'}
                    size={120}
                    color={Theme.colors.primary}
                    backgroundColor="transparent"
                  />
                </View>
                <Text style={styles.qrLabel}>Scan for Verification</Text>
              </View>
            </View>

            <TouchableOpacity 
              style={styles.viewDetailsButton}
              onPress={() => setShowFullDetails(true)}
            >
              <Text style={styles.viewDetailsText}>📋 View Full Information</Text>
              <Text style={styles.viewDetailsArrow}>→</Text>
            </TouchableOpacity>
          </View>
        </View>

        <View style={styles.quickActions}>
          <Text style={styles.quickActionsTitle}>Quick Actions</Text>
          
          <View style={styles.actionGrid}>
            <TouchableOpacity
              style={styles.actionCard}
              onPress={() => router.push('/profile-edit')}
            >
              <Text style={styles.actionIcon}>✏️</Text>
              <Text style={styles.actionLabel}>Edit Profile</Text>
            </TouchableOpacity>

                {isAdmin() && (
                  <TouchableOpacity
                    style={[styles.actionCard, styles.adminAction]}
                    onPress={() => router.push('/admin')}
                  >
                    <Text style={styles.actionIcon}>🏛️</Text>
                    <Text style={[styles.actionLabel, styles.adminActionText]}>Admin Dashboard</Text>
                  </TouchableOpacity>
                )}

                {(isAdmin() || isOrganizer()) && (
                  <>
                    <TouchableOpacity
                      style={styles.actionCard}
                      onPress={() => router.push('/scanner')}
                    >
                      <Text style={styles.actionIcon}>📱</Text>
                      <Text style={styles.actionLabel}>Scan QR</Text>
                    </TouchableOpacity>

                    <TouchableOpacity
                      style={styles.actionCard}
                      onPress={() => router.push('/members')}
                    >
                      <Text style={styles.actionIcon}>👥</Text>
                      <Text style={styles.actionLabel}>View Members</Text>
                    </TouchableOpacity>
                  </>
                )}
          </View>
        </View>
      </ScrollView>

      <Modal
        visible={showFullDetails}
        animationType="slide"
        presentationStyle="pageSheet"
      >
        <SafeAreaView style={styles.modalContainer} edges={['top', 'left', 'right']}>
          <View style={styles.modalHeader}>
            <TouchableOpacity 
              onPress={() => setShowFullDetails(false)}
              style={styles.closeButton}
            >
              <Text style={styles.closeButtonText}>✕ Close</Text>
            </TouchableOpacity>
            <Text style={styles.modalTitle}>Complete Profile</Text>
            <TouchableOpacity 
              onPress={() => {
                setShowFullDetails(false);
                router.push('/profile-edit');
              }}
              style={styles.editButton}
            >
              <Text style={styles.editButtonText}>Edit</Text>
            </TouchableOpacity>
          </View>

          <ScrollView style={styles.modalContent}>
            <View style={styles.detailSection}>
              <Text style={styles.detailSectionTitle}>Personal Information</Text>
              
              <View style={styles.detailGrid}>
                <View style={styles.detailRow}>
                  <Text style={styles.detailLabel}>Full Name</Text>
                  <Text style={styles.detailValue}>{getDisplayValue(profile?.fullName || user?.fullName)}</Text>
                </View>

                <View style={styles.detailRow}>
                  <Text style={styles.detailLabel}>Father's Name</Text>
                  <Text style={styles.detailValue}>
                    {getDisplayValue(profile?.fatherName || user?.fatherName)}
                  </Text>
                </View>

                <View style={styles.detailRow}>
                  <Text style={styles.detailLabel}>Email</Text>
                  <Text style={styles.detailValue}>
                    {getDisplayValue(profile?.email || user?.email)}
                  </Text>
                </View>

                <View style={styles.detailRow}>
                  <Text style={styles.detailLabel}>Phone</Text>
                  <Text style={styles.detailValue}>
                    {getDisplayValue(profile?.phone || user?.phone)}
                  </Text>
                </View>

                <View style={styles.detailRow}>
                  <Text style={styles.detailLabel}>Date of Birth</Text>
                  <Text style={styles.detailValue}>
                    {formatDate(profile?.dateOfBirth || user?.dateOfBirth)}
                  </Text>
                </View>

                <View style={styles.detailRow}>
                  <Text style={styles.detailLabel}>Gender</Text>
                  <Text style={styles.detailValue}>
                    {getDisplayValue(profile?.gender || user?.gender)}
                  </Text>
                </View>

                <View style={styles.detailRow}>
                  <Text style={styles.detailLabel}>Occupation</Text>
                  <Text style={styles.detailValue}>
                    {getDisplayValue(profile?.occupation || user?.occupation)}
                  </Text>
                </View>

                <View style={styles.detailRow}>
                  <Text style={styles.detailLabel}>Aadhar Number</Text>
                  <Text style={styles.detailValue}>
                    {getDisplayValue(profile?.aadharNumber || user?.aadharNumber, 'Not Provided')}
                  </Text>
                </View>
                
                <View style={styles.detailRow}>
                  <Text style={styles.detailLabel}>Aadhar Verified</Text>
                  <Text style={[styles.detailValue, (profile?.aadharVerified || user?.aadharVerified) ? styles.verifiedText : styles.pendingText]}>
                    {(profile?.aadharVerified || user?.aadharVerified) ? 'Verified' : 'Not Verified'}
                  </Text>
                </View>
              </View>
            </View>

            <View style={styles.detailSection}>
              <Text style={styles.detailSectionTitle}>Address Information</Text>
              
              <View style={styles.detailGrid}>
                <View style={styles.detailRow}>
                  <Text style={styles.detailLabel}>Address</Text>
                  <Text style={styles.detailValue}>
                    {getDisplayValue(profile?.address || user?.address)}
                  </Text>
                </View>

                <View style={styles.detailRow}>
                  <Text style={styles.detailLabel}>City</Text>
                  <Text style={styles.detailValue}>
                    {getDisplayValue(profile?.city || user?.city)}
                  </Text>
                </View>

                <View style={styles.detailRow}>
                  <Text style={styles.detailLabel}>State</Text>
                  <Text style={styles.detailValue}>
                    {getDisplayValue(profile?.state || user?.state)}
                  </Text>
                </View>

                <View style={styles.detailRow}>
                  <Text style={styles.detailLabel}>Pincode</Text>
                  <Text style={styles.detailValue}>
                    {getDisplayValue(profile?.pincode || user?.pincode)}
                  </Text>
                </View>

                <View style={styles.detailRow}>
                  <Text style={styles.detailLabel}>Constituency</Text>
                  <Text style={styles.detailValue}>
                    {getDisplayValue(profile?.constituency || user?.constituency)}
                  </Text>
                </View>
              </View>
            </View>

            <View style={styles.detailSection}>
              <Text style={styles.detailSectionTitle}>Membership Information</Text>
              
              <View style={styles.detailGrid}>
                <View style={styles.detailRow}>
                  <Text style={styles.detailLabel}>Membership ID</Text>
                  <Text style={[styles.detailValue, styles.membershipIdText]}>
                    {getDisplayValue(profile?.membershipId || user?.membershipId)}
                  </Text>
                </View>

                <View style={styles.detailRow}>
                  <Text style={styles.detailLabel}>Role</Text>
                  <Text style={[styles.detailValue, styles.detailRoleText]}>
                    {((profile?.role || user?.role) || 'member').toUpperCase()}
                  </Text>
                </View>

                <View style={styles.detailRow}>
                  <Text style={styles.detailLabel}>Join Date</Text>
                  <Text style={styles.detailValue}>
                    {formatDate(profile?.createdAt || user?.createdAt)}
                  </Text>
                </View>

                <View style={styles.detailRow}>
                  <Text style={styles.detailLabel}>Verification Status</Text>
                  <Text style={[
                    styles.detailValue,
                    (profile?.isVerified || user?.isVerified) ? styles.verifiedText : styles.pendingText
                  ]}>
                    {(profile?.isVerified || user?.isVerified) ? 'Verified ✓' : 'Pending Verification ⏳'}
                  </Text>
                </View>
              </View>
            </View>
          </ScrollView>
        </SafeAreaView>
      </Modal>

      <StatusBar style="light" />
    </SafeAreaView>
  );
}

const styles = StyleSheet.create({
  container: {
    flex: 1,
    backgroundColor: Theme.colors.background,
  },
  loadingContainer: {
    flex: 1,
    justifyContent: 'center',
    alignItems: 'center',
  },
  loadingText: {
    ...Theme.typography.body1,
    color: Theme.colors.text.secondary,
  },
  scrollView: {
    flex: 1,
  },
  header: {
    backgroundColor: Theme.colors.primary,
    paddingBottom: Theme.spacing.lg,
  },
  headerContent: {
    flexDirection: 'row',
    justifyContent: 'space-between',
    alignItems: 'flex-start',
    paddingHorizontal: Theme.spacing.lg,
    paddingTop: Theme.spacing.lg,
  },
  headerLeft: {
    flex: 1,
  },
  roleText: {
    ...Theme.typography.caption,
    color: Theme.colors.gold,
    fontWeight: '700',
    letterSpacing: 1,
  },
  nameText: {
    ...Theme.typography.h3,
    color: Theme.colors.text.onPrimary,
    marginTop: Theme.spacing.xs,
  },
  logoutButton: {
    paddingHorizontal: Theme.spacing.md,
    paddingVertical: Theme.spacing.sm,
    borderRadius: Theme.borderRadius.md,
    borderWidth: 1,
    borderColor: Theme.colors.text.onPrimary,
  },
  logoutText: {
    ...Theme.typography.body2,
    color: Theme.colors.text.onPrimary,
    fontWeight: '600',
  },
  membershipCardContainer: {
    paddingHorizontal: Theme.spacing.lg,
    paddingTop: Theme.spacing.lg,
  },
  membershipCard: {
    backgroundColor: Theme.colors.surface,
    borderRadius: Theme.borderRadius.xl,
    padding: Theme.spacing.lg,
    ...Theme.shadows.card,
    borderLeftWidth: 4,
    borderLeftColor: Theme.colors.secondary,
  },
  adminCard: {
    borderLeftColor: Theme.colors.gold,
    backgroundColor: '#FFF9E6',
  },
  organizerCard: {
    borderLeftColor: '#2196F3',
    backgroundColor: '#E3F2FD',
  },
  cardHeader: {
    alignItems: 'center',
    marginBottom: Theme.spacing.lg,
  },
  roleBadge: {
    backgroundColor: Theme.colors.secondary,
    paddingHorizontal: Theme.spacing.md,
    paddingVertical: Theme.spacing.xs,
    borderRadius: Theme.borderRadius.lg,
    marginBottom: Theme.spacing.sm,
  },
  adminBadge: {
    backgroundColor: Theme.colors.gold,
  },
  organizerBadge: {
    backgroundColor: '#2196F3',
  },
  roleBadgeText: {
    ...Theme.typography.caption,
    color: Theme.colors.text.onSecondary,
    fontWeight: '700',
    letterSpacing: 0.5,
  },
  partyName: {
    ...Theme.typography.body2,
    color: Theme.colors.text.secondary,
    fontWeight: '600',
    textAlign: 'center',
    letterSpacing: 1,
  },
  cardContent: {
    flexDirection: 'row',
    marginBottom: Theme.spacing.lg,
  },
  leftSection: {
    flex: 1,
    marginRight: Theme.spacing.md,
  },
  photoContainer: {
    alignItems: 'center',
    marginBottom: Theme.spacing.md,
  },
  profileImage: {
    width: 100,
    height: 100,
    borderRadius: 50,
    backgroundColor: Theme.colors.background,
    borderWidth: 3,
    borderColor: Theme.colors.surface,
  },
  avatarContainer: {
    width: 100,
    height: 100,
    borderRadius: 50,
    backgroundColor: Theme.colors.secondary,
    justifyContent: 'center',
    alignItems: 'center',
    borderWidth: 3,
    borderColor: Theme.colors.surface,
  },
  avatarText: {
    ...Theme.typography.h2,
    color: Theme.colors.text.onSecondary,
  },
  memberInfo: {
    alignItems: 'center',
  },
  memberName: {
    ...Theme.typography.h4,
    color: Theme.colors.text.primary,
    textAlign: 'center',
    marginBottom: Theme.spacing.xs,
  },
  membershipId: {
    ...Theme.typography.body1,
    color: Theme.colors.primary,
    fontWeight: '700',
    textAlign: 'center',
    marginBottom: Theme.spacing.md,
    letterSpacing: 1,
  },
  memberSince: {
    alignItems: 'center',
    marginBottom: Theme.spacing.md,
  },
  memberSinceLabel: {
    ...Theme.typography.caption,
    color: Theme.colors.text.secondary,
    textTransform: 'uppercase',
    letterSpacing: 0.5,
  },
  memberSinceDate: {
    ...Theme.typography.body2,
    color: Theme.colors.text.primary,
    fontWeight: '600',
  },
  statusBadge: {
    paddingHorizontal: Theme.spacing.sm,
    paddingVertical: Theme.spacing.xs,
    borderRadius: Theme.borderRadius.sm,
    backgroundColor: '#FFF3E0',
    borderWidth: 1,
    borderColor: Theme.colors.warning,
  },
  verifiedBadge: {
    backgroundColor: '#E8F5E8',
    borderColor: Theme.colors.success,
  },
  statusText: {
    ...Theme.typography.caption,
    color: Theme.colors.warning,
    fontWeight: '600',
    letterSpacing: 0.5,
  },
  verifiedText: {
    color: Theme.colors.success,
  },
  qrSection: {
    alignItems: 'center',
    justifyContent: 'center',
  },
  qrContainer: {
    padding: Theme.spacing.sm,
    backgroundColor: Theme.colors.surface,
    borderRadius: Theme.borderRadius.md,
    marginBottom: Theme.spacing.xs,
  },
  qrLabel: {
    ...Theme.typography.caption,
    color: Theme.colors.text.secondary,
    textAlign: 'center',
  },
  viewDetailsButton: {
    flexDirection: 'row',
    alignItems: 'center',
    justifyContent: 'space-between',
    backgroundColor: Theme.colors.background,
    paddingVertical: Theme.spacing.md,
    paddingHorizontal: Theme.spacing.lg,
    borderRadius: Theme.borderRadius.lg,
    borderWidth: 1,
    borderColor: Theme.colors.border,
  },
  viewDetailsText: {
    ...Theme.typography.body1,
    color: Theme.colors.primary,
    fontWeight: '600',
  },
  viewDetailsArrow: {
    ...Theme.typography.h4,
    color: Theme.colors.primary,
  },
  quickActions: {
    padding: Theme.spacing.lg,
  },
  quickActionsTitle: {
    ...Theme.typography.h4,
    color: Theme.colors.text.primary,
    marginBottom: Theme.spacing.md,
  },
  actionGrid: {
    flexDirection: 'row',
    flexWrap: 'wrap',
    gap: Theme.spacing.md,
  },
  actionCard: {
    backgroundColor: Theme.colors.surface,
    paddingVertical: Theme.spacing.lg,
    paddingHorizontal: Theme.spacing.md,
    borderRadius: Theme.borderRadius.lg,
    alignItems: 'center',
    minWidth: '45%',
    ...Theme.shadows.sm,
  },
  adminAction: {
    backgroundColor: Theme.colors.gold,
  },
  actionIcon: {
    fontSize: 24,
    marginBottom: Theme.spacing.sm,
  },
  actionLabel: {
    ...Theme.typography.body2,
    color: Theme.colors.text.primary,
    fontWeight: '600',
    textAlign: 'center',
  },
  adminActionText: {
    color: Theme.colors.text.onSecondary,
  },
  modalContainer: {
    flex: 1,
    backgroundColor: Theme.colors.background,
  },
  modalHeader: {
    flexDirection: 'row',
    alignItems: 'center',
    justifyContent: 'space-between',
    paddingHorizontal: Theme.spacing.lg,
    paddingVertical: Theme.spacing.md,
    backgroundColor: Theme.colors.surface,
    borderBottomWidth: 1,
    borderBottomColor: Theme.colors.border,
  },
  closeButton: {
    minWidth: 60,
  },
  closeButtonText: {
    ...Theme.typography.body1,
    color: Theme.colors.text.secondary,
  },
  modalTitle: {
    ...Theme.typography.h4,
    color: Theme.colors.text.primary,
    flex: 1,
    textAlign: 'center',
  },
  editButton: {
    minWidth: 60,
    alignItems: 'flex-end',
  },
  editButtonText: {
    ...Theme.typography.body1,
    color: Theme.colors.secondary,
    fontWeight: '600',
  },
  modalContent: {
    flex: 1,
  },
  detailSection: {
    backgroundColor: Theme.colors.surface,
    margin: Theme.spacing.lg,
    borderRadius: Theme.borderRadius.lg,
    padding: Theme.spacing.lg,
    ...Theme.shadows.sm,
  },
  detailSectionTitle: {
    ...Theme.typography.h4,
    color: Theme.colors.text.primary,
    marginBottom: Theme.spacing.md,
    borderBottomWidth: 2,
    borderBottomColor: Theme.colors.primary,
    paddingBottom: Theme.spacing.sm,
  },
  detailGrid: {
    gap: Theme.spacing.md,
  },
  detailRow: {
    flexDirection: 'row',
    justifyContent: 'space-between',
    alignItems: 'flex-start',
    paddingVertical: Theme.spacing.sm,
    borderBottomWidth: 1,
    borderBottomColor: Theme.colors.border,
  },
  detailLabel: {
    ...Theme.typography.body2,
    color: Theme.colors.text.secondary,
    fontWeight: '500',
    flex: 1,
  },
  detailValue: {
    ...Theme.typography.body2,
    color: Theme.colors.text.primary,
    fontWeight: '400',
    flex: 2,
    textAlign: 'right',
  },
  membershipIdText: {
    fontWeight: '700',
    color: Theme.colors.primary,
  },
  detailRoleText: {
    fontWeight: '700',
    color: Theme.colors.secondary,
    textTransform: 'capitalize',
  },
  pendingText: {
    color: Theme.colors.warning,
    fontWeight: '600',
  },
});

# ==== ./mobile-app/app/profile-edit.tsx ====

// app/profile-edit.tsx - Enhanced with all user profile fields
import React, { useState, useEffect } from 'react';
import {
  View,
  Text,
  TextInput,
  StyleSheet,
  TouchableOpacity,
  ScrollView,
  Alert,
  KeyboardAvoidingView,
  Platform,
} from 'react-native';
import { SafeAreaView } from 'react-native-safe-area-context';
import { StatusBar } from 'expo-status-bar';
import { router } from 'expo-router';
import { useAuth } from '../contexts/AuthContext';
import AsyncStorage from '@react-native-async-storage/async-storage';

// Theme for consistency
const Theme = {
  colors: {
    primary: '#1B2951',
    secondary: '#2D5016',
    accent: '#E0E0E0',
    background: '#f5f5f5',
    surface: '#ffffff',
    text: {
      primary: '#333333',
      secondary: '#666666',
      onPrimary: '#ffffff',
      onSecondary: '#ffffff',
    },
    border: '#e0e0e0',
    success: '#4CAF50',
    error: '#F44336',
  },
  spacing: {
    xs: 4,
    sm: 8,
    md: 16,
    lg: 24,
    xl: 32,
    xxl: 40,
  },
  typography: {
    h1: { fontSize: 32, fontWeight: 'bold' as const },
    h2: { fontSize: 28, fontWeight: 'bold' as const },
    h3: { fontSize: 24, fontWeight: 'bold' as const },
    h4: { fontSize: 20, fontWeight: 'bold' as const },
    body1: { fontSize: 16, fontWeight: 'normal' as const },
    body2: { fontSize: 14, fontWeight: 'normal' as const },
    caption: { fontSize: 12, fontWeight: 'normal' as const },
  },
  borderRadius: {
    sm: 4,
    md: 8,
    lg: 12,
    xl: 16,
  },
};

export default function ProfileEdit() {
  const { user, login } = useAuth();
  const [formData, setFormData] = useState({
    // Basic Info
    fullName: '',
    fatherName: '',
    email: '',
    phone: '',
    dateOfBirth: '',
    gender: '',
    occupation: '',
    
    // Address Info
    address: '',
    city: '',
    state: '',
    pincode: '',
    constituency: '',
    
    // Additional Info
    aadharNumber: '',
  });
  const [loading, setLoading] = useState(false);
  const [errors, setErrors] = useState({});

  useEffect(() => {
    if (user) {
      setFormData({
        fullName: user.fullName || user.name || '',
        fatherName: user.fatherName || '',
        email: user.email || '',
        phone: user.phone || '',
        dateOfBirth: formatDateForInput(user.dateOfBirth) || '',
        gender: user.gender || '',
        occupation: user.occupation || '',
        address: user.address || '',
        city: user.city || '',
        state: user.state || '',
        pincode: user.pincode || '',
        constituency: user.constituency || '',
        aadharNumber: user.aadharNumber || '',
      });
    }
  }, [user]);

  const formatDateForInput = (dateString) => {
    if (!dateString) return '';
    try {
      const date = new Date(dateString);
      return date.toISOString().split('T')[0]; // Returns YYYY-MM-DD
    } catch {
      return '';
    }
  };

  const handleInputChange = (field: string, value: string) => {
    setFormData(prev => ({
      ...prev,
      [field]: value,
    }));
    
    // Clear error when user starts typing
    if (errors[field]) {
      setErrors(prev => ({
        ...prev,
        [field]: null,
      }));
    }
  };

  const validateForm = () => {
    const newErrors = {};
    
    // Required fields validation
    if (!formData.fullName.trim()) {
      newErrors.fullName = 'Full name is required';
    }
    
    if (!formData.email.trim()) {
      newErrors.email = 'Email is required';
    } else {
      // Email format validation
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!emailRegex.test(formData.email)) {
        newErrors.email = 'Please enter a valid email address';
      }
    }
    
    // Phone validation
    if (formData.phone && formData.phone.trim()) {
      const phoneRegex = /^[\+]?[\d\s\-\(\)]{8,15}$/;
      if (!phoneRegex.test(formData.phone)) {
        newErrors.phone = 'Please enter a valid phone number';
      }
    }
    
    // Date validation
    if (formData.dateOfBirth) {
      const date = new Date(formData.dateOfBirth);
      const today = new Date();
      const age = today.getFullYear() - date.getFullYear();
      if (age < 18 || age > 100) {
        newErrors.dateOfBirth = 'Age must be between 18 and 100 years';
      }
    }
    
    // Aadhar number validation (if provided)
    if (formData.aadharNumber && formData.aadharNumber.trim()) {
      if (!/^\d{12}$/.test(formData.aadharNumber.replace(/\s/g, ''))) {
        newErrors.aadharNumber = 'Aadhar number must be 12 digits';
      }
    }
    
    // Pincode validation (if provided)
    if (formData.pincode && formData.pincode.trim()) {
      if (!/^\d{6}$/.test(formData.pincode)) {
        newErrors.pincode = 'Pincode must be 6 digits';
      }
    }
    
    setErrors(newErrors);
    return Object.keys(newErrors).length === 0;
  };

  const handleSave = async () => {
    if (!validateForm()) {
      Alert.alert('Validation Error', 'Please correct the highlighted fields');
      return;
    }

    setLoading(true);

    try {
      const token = await AsyncStorage.getItem('token');
      
      // Prepare the data to match backend expectations
      const updateData = {
        fullName: formData.fullName,
        fatherName: formData.fatherName,
        email: formData.email,
        phone: formData.phone,
        dateOfBirth: formData.dateOfBirth,
        occupation: formData.occupation,
        address: formData.address,
        constituency: formData.constituency,
        // Add new fields if your backend supports them
        gender: formData.gender,
        city: formData.city,
        state: formData.state,
        pincode: formData.pincode,
        aadharNumber: formData.aadharNumber,
      };

      const response = await fetch('http://192.168.1.65:5000/api/members/profile', {
        method: 'PUT',
        headers: {
          'Authorization': `Bearer ${token}`,
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(updateData),
      });

      const data = await response.json();

      if (response.ok) {
        // Update the user context with new data
        const updatedUser = {
          ...user,
          ...formData,
          name: formData.fullName, // For compatibility
        };
        
        await login(token, updatedUser);
        
        Alert.alert(
          'Success!',
          'Your profile has been updated successfully.',
          [{ text: 'OK', onPress: () => router.back() }]
        );
      } else {
        Alert.alert('Update Failed', data.message || 'Failed to update profile');
      }
    } catch (error) {
      console.error('Update profile error:', error);
      Alert.alert('Error', 'Network error. Please check your connection and try again.');
    } finally {
      setLoading(false);
    }
  };

  return (
    <SafeAreaView style={styles.container}>
      {/* Header */}
      <View style={styles.header}>
        <TouchableOpacity
          style={styles.backButton}
          onPress={() => router.back()}
        >
          <Text style={styles.backButtonText}>← Back</Text>
        </TouchableOpacity>
        
        <Text style={styles.title}>Edit Profile</Text>
        
        <TouchableOpacity
          style={[styles.saveButton, loading && styles.disabledButton]}
          onPress={handleSave}
          disabled={loading}
        >
          <Text style={[styles.saveButtonText, loading && styles.disabledText]}>
            {loading ? 'Saving...' : 'Save'}
          </Text>
        </TouchableOpacity>
      </View>

      <KeyboardAvoidingView 
        behavior={Platform.OS === 'ios' ? 'padding' : 'height'}
        style={styles.keyboardView}
      >
        <ScrollView 
          style={styles.scrollView}
          showsVerticalScrollIndicator={false}
          keyboardShouldPersistTaps="handled"
        >
          <View style={styles.form}>
            
            {/* Personal Information Section */}
            <View style={styles.section}>
              <Text style={styles.sectionTitle}>Personal Information</Text>
              
              <View style={styles.inputGroup}>
                <Text style={styles.label}>Full Name *</Text>
                <TextInput
                  style={[styles.input, errors.fullName && styles.errorInput]}
                  value={formData.fullName}
                  onChangeText={(value) => handleInputChange('fullName', value)}
                  placeholder="Enter your full name"
                  autoCapitalize="words"
                />
                {errors.fullName && <Text style={styles.errorText}>{errors.fullName}</Text>}
              </View>

              <View style={styles.inputGroup}>
                <Text style={styles.label}>Father's Name</Text>
                <TextInput
                  style={styles.input}
                  value={formData.fatherName}
                  onChangeText={(value) => handleInputChange('fatherName', value)}
                  placeholder="Enter father's name"
                  autoCapitalize="words"
                />
              </View>

              <View style={styles.inputGroup}>
                <Text style={styles.label}>Email Address *</Text>
                <TextInput
                  style={[styles.input, errors.email && styles.errorInput]}
                  value={formData.email}
                  onChangeText={(value) => handleInputChange('email', value)}
                  placeholder="Enter your email"
                  keyboardType="email-address"
                  autoCapitalize="none"
                  autoCorrect={false}
                />
                {errors.email && <Text style={styles.errorText}>{errors.email}</Text>}
              </View>

              <View style={styles.inputGroup}>
                <Text style={styles.label}>Phone Number</Text>
                <TextInput
                  style={[styles.input, errors.phone && styles.errorInput]}
                  value={formData.phone}
                  onChangeText={(value) => handleInputChange('phone', value)}
                  placeholder="Enter your phone number"
                  keyboardType="phone-pad"
                />
                {errors.phone && <Text style={styles.errorText}>{errors.phone}</Text>}
              </View>

              <View style={styles.inputGroup}>
                <Text style={styles.label}>Date of Birth</Text>
                <TextInput
                  style={[styles.input, errors.dateOfBirth && styles.errorInput]}
                  value={formData.dateOfBirth}
                  onChangeText={(value) => handleInputChange('dateOfBirth', value)}
                  placeholder="YYYY-MM-DD"
                />
                {errors.dateOfBirth && <Text style={styles.errorText}>{errors.dateOfBirth}</Text>}
              </View>

              <View style={styles.inputGroup}>
                <Text style={styles.label}>Gender</Text>
                <TextInput
                  style={styles.input}
                  value={formData.gender}
                  onChangeText={(value) => handleInputChange('gender', value)}
                  placeholder="Male/Female/Other"
                  autoCapitalize="words"
                />
              </View>

              <View style={styles.inputGroup}>
                <Text style={styles.label}>Occupation</Text>
                <TextInput
                  style={styles.input}
                  value={formData.occupation}
                  onChangeText={(value) => handleInputChange('occupation', value)}
                  placeholder="Enter your occupation"
                  autoCapitalize="words"
                />
              </View>
            </View>

            {/* Address Information Section */}
            <View style={styles.section}>
              <Text style={styles.sectionTitle}>Address Information</Text>
              
              <View style={styles.inputGroup}>
                <Text style={styles.label}>Full Address</Text>
                <TextInput
                  style={[styles.input, styles.textArea]}
                  value={formData.address}
                  onChangeText={(value) => handleInputChange('address', value)}
                  placeholder="Enter your complete address"
                  multiline
                  numberOfLines={3}
                  textAlignVertical="top"
                />
              </View>

              <View style={styles.inputGroup}>
                <Text style={styles.label}>City</Text>
                <TextInput
                  style={styles.input}
                  value={formData.city}
                  onChangeText={(value) => handleInputChange('city', value)}
                  placeholder="Enter your city"
                  autoCapitalize="words"
                />
              </View>

              <View style={styles.inputGroup}>
                <Text style={styles.label}>State</Text>
                <TextInput
                  style={styles.input}
                  value={formData.state}
                  onChangeText={(value) => handleInputChange('state', value)}
                  placeholder="Enter your state"
                  autoCapitalize="words"
                />
              </View>

              <View style={styles.inputGroup}>
                <Text style={styles.label}>Pincode</Text>
                <TextInput
                  style={[styles.input, errors.pincode && styles.errorInput]}
                  value={formData.pincode}
                  onChangeText={(value) => handleInputChange('pincode', value)}
                  placeholder="Enter 6-digit pincode"
                  keyboardType="numeric"
                  maxLength={6}
                />
                {errors.pincode && <Text style={styles.errorText}>{errors.pincode}</Text>}
              </View>

              <View style={styles.inputGroup}>
                <Text style={styles.label}>Constituency</Text>
                <TextInput
                  style={styles.input}
                  value={formData.constituency}
                  onChangeText={(value) => handleInputChange('constituency', value)}
                  placeholder="Enter your constituency"
                  autoCapitalize="words"
                />
              </View>
            </View>

            {/* Additional Information Section */}
            <View style={styles.section}>
              <Text style={styles.sectionTitle}>Additional Information</Text>
              
              <View style={styles.inputGroup}>
                <Text style={styles.label}>Aadhar Number (Optional)</Text>
                <TextInput
                  style={[styles.input, errors.aadharNumber && styles.errorInput]}
                  value={formData.aadharNumber}
                  onChangeText={(value) => handleInputChange('aadharNumber', value)}
                  placeholder="Enter 12-digit Aadhar number"
                  keyboardType="numeric"
                  maxLength={12}
                />
                {errors.aadharNumber && <Text style={styles.errorText}>{errors.aadharNumber}</Text>}
              </View>
            </View>

            {/* Info Card */}
            <View style={styles.infoCard}>
              <Text style={styles.infoTitle}>📝 Note:</Text>
              <Text style={styles.infoText}>
                • Fields marked with * are required{'\n'}
                • Your Membership ID cannot be changed{'\n'}
                • All information will be kept confidential{'\n'}
                • Updated information may take a few minutes to reflect
              </Text>
            </View>

            {/* Read-only Information */}
            <View style={styles.readOnlySection}>
              <Text style={styles.sectionTitle}>Membership Information</Text>
              <View style={styles.readOnlyCard}>
                <View style={styles.readOnlyRow}>
                  <Text style={styles.readOnlyLabel}>Membership ID:</Text>
                  <Text style={styles.readOnlyValue}>{user?.membershipId}</Text>
                </View>
                <View style={styles.readOnlyRow}>
                  <Text style={styles.readOnlyLabel}>Member Since:</Text>
                  <Text style={styles.readOnlyValue}>
                    {user?.createdAt ? new Date(user.createdAt).toLocaleDateString() : 'N/A'}
                  </Text>
                </View>
                <View style={styles.readOnlyRow}>
                  <Text style={styles.readOnlyLabel}>Status:</Text>
                  <Text style={[styles.readOnlyValue, styles.statusText]}>
                    {user?.isVerified ? 'Verified ✓' : 'Pending Verification'}
                  </Text>
                </View>
              </View>
            </View>

          </View>
        </ScrollView>
      </KeyboardAvoidingView>

      <StatusBar style="light" />
    </SafeAreaView>
  );
}

const styles = StyleSheet.create({
  container: {
    flex: 1,
    backgroundColor: Theme.colors.background,
  },
  
  header: {
    backgroundColor: Theme.colors.primary,
    paddingVertical: Theme.spacing.md,
    paddingHorizontal: Theme.spacing.lg,
    flexDirection: 'row',
    alignItems: 'center',
    justifyContent: 'space-between',
    ...Platform.select({
      ios: {
        shadowColor: '#000',
        shadowOffset: { width: 0, height: 1 },
        shadowOpacity: 0.1,
        shadowRadius: 2,
      },
      android: {
        elevation: 2,
      },
    }),
  },
  
  backButton: {
    minWidth: 60,
  },
  
  backButtonText: {
    ...Theme.typography.body1,
    color: Theme.colors.text.onPrimary,
  },
  
  title: {
    ...Theme.typography.h4,
    color: Theme.colors.text.onPrimary,
    textAlign: 'center',
    flex: 1,
  },
  
  saveButton: {
    minWidth: 60,
    alignItems: 'flex-end',
  },
  
  saveButtonText: {
    ...Theme.typography.body1,
    color: Theme.colors.success,
    fontWeight: '600',
  },

  disabledButton: {
    opacity: 0.6,
  },

  disabledText: {
    color: Theme.colors.text.secondary,
  },
  
  keyboardView: {
    flex: 1,
  },
  
  scrollView: {
    flex: 1,
  },
  
  form: {
    padding: Theme.spacing.lg,
  },
  
  section: {
    marginBottom: Theme.spacing.xl,
  },
  
  sectionTitle: {
    ...Theme.typography.h4,
    color: Theme.colors.text.primary,
    marginBottom: Theme.spacing.md,
    paddingBottom: Theme.spacing.sm,
    borderBottomWidth: 2,
    borderBottomColor: Theme.colors.primary,
  },
  
  inputGroup: {
    marginBottom: Theme.spacing.lg,
  },
  
  label: {
    ...Theme.typography.body2,
    fontWeight: '600',
    color: Theme.colors.text.primary,
    marginBottom: Theme.spacing.xs,
  },
  
  input: {
    backgroundColor: Theme.colors.surface,
    paddingHorizontal: Theme.spacing.md,
    paddingVertical: Theme.spacing.sm + 2,
    borderRadius: Theme.borderRadius.md,
    fontSize: Theme.typography.body1.fontSize,
    borderWidth: 1,
    borderColor: Theme.colors.border,
    color: Theme.colors.text.primary,
  },
  
  textArea: {
    height: 80,
    textAlignVertical: 'top',
    paddingTop: Theme.spacing.sm + 2,
  },

  errorInput: {
    borderColor: Theme.colors.error,
    borderWidth: 1.5,
  },

  errorText: {
    ...Theme.typography.caption,
    color: Theme.colors.error,
    marginTop: Theme.spacing.xs,
  },
  
  infoCard: {
    backgroundColor: '#E8F5E8',
    padding: Theme.spacing.md,
    borderRadius: Theme.borderRadius.lg,
    marginVertical: Theme.spacing.lg,
    borderLeftWidth: 4,
    borderLeftColor: Theme.colors.success,
  },

  infoTitle: {
    ...Theme.typography.body2,
    fontWeight: '600',
    color: Theme.colors.secondary,
    marginBottom: Theme.spacing.xs,
  },
  
  infoText: {
    ...Theme.typography.caption,
    color: Theme.colors.secondary,
    lineHeight: 16,
  },

  readOnlySection: {
    marginTop: Theme.spacing.lg,
  },

  readOnlyCard: {
    backgroundColor: Theme.colors.surface,
    borderRadius: Theme.borderRadius.lg,
    padding: Theme.spacing.md,
    borderWidth: 1,
    borderColor: Theme.colors.border,
  },

  readOnlyRow: {
    flexDirection: 'row',
    justifyContent: 'space-between',
    alignItems: 'center',
    paddingVertical: Theme.spacing.xs,
  },

  readOnlyLabel: {
    ...Theme.typography.body2,
    color: Theme.colors.text.secondary,
    fontWeight: '500',
  },

  readOnlyValue: {
    ...Theme.typography.body2,
    color: Theme.colors.text.primary,
    fontWeight: '600',
  },

  statusText: {
    color: Theme.colors.success,
  },
});

# ==== ./mobile-app/app/register.tsx ====

import React, { useState, useRef } from 'react';
import {
  View,
  Text,
  StyleSheet,
  ScrollView,
  TextInput,
  TouchableOpacity,
  Alert,
  Modal,
  Image,
} from 'react-native';
import { SafeAreaView } from 'react-native-safe-area-context';
import { StatusBar } from 'expo-status-bar';
import { Ionicons } from '@expo/vector-icons';
import { router } from 'expo-router';
import { CameraView, CameraType, useCameraPermissions } from 'expo-camera';
import * as ImagePicker from 'expo-image-picker';

export default function Register() {
  const [formData, setFormData] = useState({
    aadhaarNumber: '',
    fullName: '',
    fatherName: '',
    address: '',
    phone: '',
    email: '',
    dateOfBirth: '',
    occupation: '',
    constituency: '',
    password: '',
    confirmPassword: '',
  });

  const [aadhaarValidated, setAadhaarValidated] = useState(false);
  const [aadhaarLoading, setAadhaarLoading] = useState(false);
  const [useAadhaarVerification, setUseAadhaarVerification] = useState(null); // null = not selected, true = use Aadhar, false = manual
  const [loading, setLoading] = useState(false);
  const [photo, setPhoto] = useState(null);
  const [showCamera, setShowCamera] = useState(false);
  const [showImageOptions, setShowImageOptions] = useState(false);
  const [facing, setFacing] = useState<CameraType>('front');
  const [permission, requestPermission] = useCameraPermissions();
  const camera = useRef(null);

  // Aadhaar validation function
  const validateAadhaar = (aadhaarNumber) => {
    // Remove spaces and dashes
    const cleanAadhaar = aadhaarNumber.replace(/[\s-]/g, '');
    
    // Check if it's 12 digits
    if (!/^\d{12}$/.test(cleanAadhaar)) {
      return false;
    }
    
    // Verhoeff algorithm for Aadhaar validation
    const verhoeffTable = [
      [0, 1, 2, 3, 4, 5, 6, 7, 8, 9],
      [1, 2, 3, 4, 0, 6, 7, 8, 9, 5],
      [2, 3, 4, 0, 1, 7, 8, 9, 5, 6],
      [3, 4, 0, 1, 2, 8, 9, 5, 6, 7],
      [4, 0, 1, 2, 3, 9, 5, 6, 7, 8],
      [5, 9, 8, 7, 6, 0, 4, 3, 2, 1],
      [6, 5, 9, 8, 7, 1, 0, 4, 3, 2],
      [7, 6, 5, 9, 8, 2, 1, 0, 4, 3],
      [8, 7, 6, 5, 9, 3, 2, 1, 0, 4],
      [9, 8, 7, 6, 5, 4, 3, 2, 1, 0]
    ];
    
    const multiplicationTable = [
      [0, 1, 2, 3, 4, 5, 6, 7, 8, 9],
      [1, 5, 7, 6, 2, 8, 3, 0, 9, 4],
      [5, 8, 0, 3, 7, 9, 6, 1, 4, 2],
      [8, 9, 1, 6, 0, 4, 3, 5, 2, 7],
      [9, 4, 5, 3, 1, 2, 6, 8, 7, 0],
      [4, 2, 8, 6, 5, 7, 3, 9, 0, 1],
      [2, 7, 9, 3, 8, 0, 6, 4, 1, 5],
      [7, 0, 4, 6, 9, 1, 3, 2, 5, 8]
    ];
    
    let checksum = 0;
    const digits = cleanAadhaar.split('').map(Number).reverse();
    
    for (let i = 0; i < digits.length; i++) {
      checksum = verhoeffTable[checksum][multiplicationTable[i % 8][digits[i]]];
    }
    
    return checksum === 0;
  };

  // Format Aadhaar number with spaces
  const formatAadhaar = (value) => {
    const cleaned = value.replace(/\D/g, '');
    const groups = cleaned.match(/.{1,4}/g);
    return groups ? groups.join(' ') : cleaned;
  };

  // Handle Aadhaar input and validation
  const handleAadhaarChange = async (text) => {
    const formatted = formatAadhaar(text);
    setFormData({...formData, aadhaarNumber: formatted});
    setAadhaarValidated(false);
    
    const cleanAadhaar = text.replace(/[\s-]/g, '');
    
    // Auto-validate when 12 digits are entered
    if (cleanAadhaar.length === 12) {
      setAadhaarLoading(true);
      
      if (validateAadhaar(cleanAadhaar)) {
        // Simulate API call to get Aadhaar details
        setTimeout(() => {
          // Mock Aadhaar data - in real implementation, this would come from UIDAI API
          const mockAadhaarData = {
            name: 'Rajesh Kumar Sharma',
            fatherName: 'Ram Bahadur Sharma',
            address: 'House No 123, Ward No 5, Kalimpong, West Bengal - 734301',
            dateOfBirth: '1990-05-15',
            phone: '+91-9876543210'
          };
          
          setFormData(prev => ({
            ...prev,
            fullName: mockAadhaarData.name,
            fatherName: mockAadhaarData.fatherName,
            address: mockAadhaarData.address,
            dateOfBirth: mockAadhaarData.dateOfBirth,
            phone: mockAadhaarData.phone
          }));
          
          setAadhaarValidated(true);
          setAadhaarLoading(false);
          Alert.alert(
            'Aadhaar Verified!', 
            'Your details have been auto-filled from Aadhaar. Please verify and update if needed.',
            [{ text: 'OK' }]
          );
        }, 2000);
      } else {
        setAadhaarLoading(false);
        Alert.alert('Invalid Aadhaar', 'Please enter a valid 12-digit Aadhaar number');
      }
    }
  };

  const showImagePickerOptions = () => {
    setShowImageOptions(true);
  };

  const hideImageOptions = () => {
    setShowImageOptions(false);
  };

  const openCamera = async () => {
    hideImageOptions();
    
    if (!permission) {
      // Camera permissions are still loading
      return;
    }

    if (!permission.granted) {
      // Camera permissions are not granted yet
      const permissionResponse = await requestPermission();
      if (!permissionResponse.granted) {
        Alert.alert('Permission Required', 'Camera permission is required to take a selfie');
        return;
      }
    }
    
    setShowCamera(true);
  };

  const takePicture = async () => {
    if (camera.current) {
      try {
        const photo = await camera.current.takePictureAsync({
          quality: 0.8,
          skipProcessing: false,
        });
        
        setPhoto(photo);
        setShowCamera(false);
      } catch (error) {
        Alert.alert('Error', 'Failed to take picture: ' + error.message);
      }
    }
  };

  const pickImageFromGallery = async () => {
    hideImageOptions();
    
    // Request gallery permissions
    const { status } = await ImagePicker.requestMediaLibraryPermissionsAsync();
    if (status !== 'granted') {
      Alert.alert('Permission Required', 'Gallery permission is required to select a photo');
      return;
    }

    const result = await ImagePicker.launchImageLibraryAsync({
      mediaTypes: ImagePicker.MediaTypeOptions.Images,
      allowsEditing: true,
      aspect: [1, 1],
      quality: 0.8,
    });

    if (!result.canceled) {
      setPhoto(result.assets[0]);
    }
  };

  const removePhoto = () => {
    setPhoto(null);
    hideImageOptions();
  };

  const handleRegister = async () => {
    try {
      // Validation
      if (!photo) {
        Alert.alert('Error', 'Please take a selfie or select a profile photo');
        return;
      }

      // Check if using Aadhaar verification and validate accordingly
      if (useAadhaarVerification === true && !aadhaarValidated) {
        Alert.alert('Error', 'Please enter and validate your Aadhaar number');
        return;
      }

      if (formData.password !== formData.confirmPassword) {
        Alert.alert('Error', 'Passwords do not match');
        return;
      }

      // Modified validation - Aadhaar is only required if user chose Aadhaar verification
      const requiredFields = ['fullName', 'fatherName', 'address', 'phone',  'dateOfBirth', 'password'];
      if (useAadhaarVerification === true) {
        requiredFields.push('aadhaarNumber');
      }

      const missingFields = requiredFields.filter(field => !formData[field]);
      if (missingFields.length > 0) {
        Alert.alert('Error', 'Please fill in all required fields');
        return;
      }

      // Validate email format
      if (formData.email && formData.email.trim() !== '') {
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(formData.email)) {
          Alert.alert('Error', 'Please enter a valid email address');
          return;
        }
      }

      // Validate phone number
      const phoneRegex = /^[\+]?[1-9][\d]{0,15}$/;
      if (!phoneRegex.test(formData.phone.replace(/[\s\-\(\)]/g, ''))) {
        Alert.alert('Error', 'Please enter a valid phone number');
        return;
      }

      setLoading(true);

      // Prepare form data
      const registerFormData = new FormData();
      
      // Add photo
      registerFormData.append('profilePhoto', {
        uri: photo.uri,
        type: 'image/jpeg',
        name: 'profile.jpg',
      });

    
      // Add other fields (including verification method)
      Object.keys(formData).forEach(key => {
        if (key !== 'confirmPassword') {
          // Map frontend field names to backend field names
          const backendFieldName = key === 'aadhaarNumber' ? 'aadharNumber' : key;
          registerFormData.append(backendFieldName, formData[key]);
        }
      });

      // Add verification method info (using backend field names)
      registerFormData.append('verificationMethod', useAadhaarVerification ? 'aadhaar' : 'manual');
      registerFormData.append('aadharVerified', aadhaarValidated.toString()); // Changed from aadhaarVerified

      const response = await fetch('http://192.168.1.65:5000/api/auth/register', {
        method: 'POST',
        body: registerFormData,
        headers: {
          'Content-Type': 'multipart/form-data',
        },
      });

      const data = await response.json();

      if (response.ok) {
        Alert.alert(
          'Registration Successful!',
          'Welcome to Gorkha Janshakti Front! You can now login with your credentials.',
          [{ text: 'OK', onPress: () => router.replace('/login') }]
        );
      } else {
        Alert.alert('Registration Failed', data.message || 'Please try again');
      }
    } catch (error) {
      Alert.alert('Error', 'Registration failed: ' + error.message);
    } finally {
      setLoading(false);
    }
  };

  // Camera permission check
  if (!permission) {
    // Camera permissions are still loading
    return <View />;
  }

  // Render camera view
  if (showCamera) {
    return (
      <View style={styles.cameraContainer}>
        <CameraView
          ref={camera}
          style={styles.camera}
          facing={facing}
        >
          <View style={styles.cameraControls}>
            <TouchableOpacity
              style={styles.cameraButton}
              onPress={() => setShowCamera(false)}
            >
              <Ionicons name="close" size={30} color="white" />
            </TouchableOpacity>
            <TouchableOpacity
              style={styles.captureButton}
              onPress={takePicture}
            >
              <View style={styles.captureButtonInner} />
            </TouchableOpacity>
          </View>
        </CameraView>
      </View>
    );
  }

  return (
    <SafeAreaView style={styles.container}>
      <StatusBar style="light" />
      
      {/* Header */}
      <View style={styles.header}>
        <TouchableOpacity 
          style={styles.backButton}
          onPress={() => router.back()}
        >
          <Ionicons name="arrow-back" size={24} color="white" />
        </TouchableOpacity>
        
        <View style={styles.logoSection}>
          <Text style={styles.partyName}>GORKHA JANSHAKTI FRONT</Text>
          <Text style={styles.title}>Register</Text>
        </View>
      </View>

      <ScrollView style={styles.formContainer} showsVerticalScrollIndicator={false}>
        {/* Photo Section */}
        <View style={styles.photoSection}>
          <TouchableOpacity onPress={showImagePickerOptions} style={styles.photoContainer}>
            {photo ? (
              <Image source={{ uri: photo.uri }} style={styles.photo} />
            ) : (
              <View style={styles.placeholderPhoto}>
                <Ionicons name="camera" size={40} color="#999" />
                <Text style={styles.photoButtonText}>Take Selfie or{'\n'}Select Photo</Text>
              </View>
            )}
          </TouchableOpacity>
          
          {photo && (
            <TouchableOpacity 
              style={styles.changePhotoButton}
              onPress={showImagePickerOptions}
            >
              <Text style={styles.changePhotoText}>Change Photo</Text>
            </TouchableOpacity>
          )}
        </View>

        {/* Verification Method Selection */}
        {useAadhaarVerification === null && (
          <View style={styles.verificationMethodSection}>
            <Text style={styles.sectionTitle}>Choose Registration Method</Text>
            <Text style={styles.sectionDescription}>
              You can either verify using your Aadhaar card for quick auto-fill, or fill the details manually.
            </Text>
            
            <TouchableOpacity
              style={styles.methodButton}
              onPress={() => setUseAadhaarVerification(true)}
            >
              <View style={styles.methodButtonContent}>
                <Ionicons name="card" size={24} color="#2D5016" />
                <View style={styles.methodButtonText}>
                  <Text style={styles.methodButtonTitle}>Use Aadhaar Verification</Text>
                  <Text style={styles.methodButtonSubtitle}>Auto-fill details from Aadhaar</Text>
                </View>
                <Ionicons name="chevron-forward" size={20} color="#666" />
              </View>
            </TouchableOpacity>

            <TouchableOpacity
              style={styles.methodButton}
              onPress={() => setUseAadhaarVerification(false)}
            >
              <View style={styles.methodButtonContent}>
                <Ionicons name="create" size={24} color="#2D5016" />
                <View style={styles.methodButtonText}>
                  <Text style={styles.methodButtonTitle}>Fill Details Manually</Text>
                  <Text style={styles.methodButtonSubtitle}>Enter all details yourself</Text>
                </View>
                <Ionicons name="chevron-forward" size={20} color="#666" />
              </View>
            </TouchableOpacity>
          </View>
        )}

        {/* Form Fields */}
        {useAadhaarVerification !== null && (
          <View style={styles.form}>
            {/* Method Selection Header */}
            <View style={styles.selectedMethodHeader}>
              <View style={styles.selectedMethodInfo}>
                <Ionicons 
                  name={useAadhaarVerification ? "card" : "create"} 
                  size={20} 
                  color="#2D5016" 
                />
                <Text style={styles.selectedMethodText}>
                  {useAadhaarVerification ? 'Aadhaar Verification' : 'Manual Entry'}
                </Text>
              </View>
              <TouchableOpacity
                style={styles.changeMethodButton}
                onPress={() => {
                  setUseAadhaarVerification(null);
                  setAadhaarValidated(false);
                  setFormData({
                    aadhaarNumber: '',
                    fullName: '',
                    fatherName: '',
                    address: '',
                    phone: '',
                    email: '',
                    dateOfBirth: '',
                    occupation: '',
                    constituency: '',
                    password: '',
                    confirmPassword: '',
                  });
                }}
              >
                <Text style={styles.changeMethodText}>Change Method</Text>
              </TouchableOpacity>
            </View>

            {/* Aadhaar Number Field - Only show if using Aadhaar verification */}
            {useAadhaarVerification && (
              <View style={styles.aadhaarContainer}>
                <View style={styles.aadhaarInputContainer}>
                  <TextInput
                    style={[
                      styles.input, 
                      styles.aadhaarInput,
                      aadhaarValidated && styles.validatedInput
                    ]}
                    placeholder="Aadhaar Number (XXXX XXXX XXXX) *"
                    placeholderTextColor="#999"
                    value={formData.aadhaarNumber}
                    onChangeText={handleAadhaarChange}
                    keyboardType="numeric"
                    maxLength={14} // 12 digits + 2 spaces
                  />
                  {aadhaarLoading && (
                    <View style={styles.aadhaarLoader}>
                      <Text style={styles.loaderText}>Verifying...</Text>
                    </View>
                  )}
                  {aadhaarValidated && (
                    <View style={styles.aadhaarSuccess}>
                      <Ionicons name="checkmark-circle" size={20} color="#4CAF50" />
                      <Text style={styles.successText}>Verified</Text>
                    </View>
                  )}
                </View>
                {aadhaarValidated && (
                  <Text style={styles.aadhaarNote}>
                    ✓ Details auto-filled from Aadhaar. Please verify and update if needed.
                  </Text>
                )}
              </View>
            )}

            {/* Personal Details */}
            <TextInput
              style={[styles.input, aadhaarValidated && styles.autoFilledInput]}
              placeholder="Full Name *"
              placeholderTextColor="#999"
              value={formData.fullName}
              onChangeText={(text) => setFormData({...formData, fullName: text})}
              editable={true}
            />

            <TextInput
              style={[styles.input, aadhaarValidated && styles.autoFilledInput]}
              placeholder="Father's Name *"
              placeholderTextColor="#999"
              value={formData.fatherName}
              onChangeText={(text) => setFormData({...formData, fatherName: text})}
              editable={true}
            />

            <TextInput
              style={[styles.input, aadhaarValidated && styles.autoFilledInput]}
              placeholder="Address *"
              placeholderTextColor="#999"
              multiline
              numberOfLines={3}
              textAlignVertical="top"
              value={formData.address}
              onChangeText={(text) => setFormData({...formData, address: text})}
              editable={true}
            />

            <TextInput
              style={[styles.input, aadhaarValidated && styles.autoFilledInput]}
              placeholder="Phone Number *"
              placeholderTextColor="#999"
              keyboardType="phone-pad"
              value={formData.phone}
              onChangeText={(text) => setFormData({...formData, phone: text})}
              editable={true}
            />

            <TextInput
              style={styles.input}
              placeholder="Email"
              placeholderTextColor="#999"
              keyboardType="email-address"
              autoCapitalize="none"
              value={formData.email}
              onChangeText={(text) => setFormData({...formData, email: text})}
            />

            <TextInput
              style={[styles.input, aadhaarValidated && styles.autoFilledInput]}
              placeholder="Date of Birth (YYYY-MM-DD) *"
              placeholderTextColor="#999"
              value={formData.dateOfBirth}
              onChangeText={(text) => setFormData({...formData, dateOfBirth: text})}
              editable={true}
            />

            <TextInput
              style={styles.input}
              placeholder="Occupation"
              placeholderTextColor="#999"
              value={formData.occupation}
              onChangeText={(text) => setFormData({...formData, occupation: text})}
            />

            <TextInput
              style={styles.input}
              placeholder="Constituency"
              placeholderTextColor="#999"
              value={formData.constituency}
              onChangeText={(text) => setFormData({...formData, constituency: text})}
            />

            <TextInput
              style={styles.input}
              placeholder="Password *"
              placeholderTextColor="#999"
              secureTextEntry
              value={formData.password}
              onChangeText={(text) => setFormData({...formData, password: text})}
            />

            <TextInput
              style={styles.input}
              placeholder="Confirm Password *"
              placeholderTextColor="#999"
              secureTextEntry
              value={formData.confirmPassword}
              onChangeText={(text) => setFormData({...formData, confirmPassword: text})}
            />

            <TouchableOpacity
              style={[styles.registerButton, loading && styles.disabledButton]}
              onPress={handleRegister}
              disabled={loading}
            >
              <Text style={styles.registerButtonText}>
                {loading ? 'Registering...' : 'Register'}
              </Text>
            </TouchableOpacity>

            <View style={styles.loginLink}>
              <Text style={styles.loginLinkText}>
                Already have an account?{' '}
                <Text
                  style={styles.loginLinkHighlight}
                  onPress={() => router.replace('/login')}
                >
                  Login here
                </Text>
              </Text>
            </View>
          </View>
        )}
      </ScrollView>

      {/* Image Picker Modal */}
      <Modal
        visible={showImageOptions}
        transparent={true}
        animationType="slide"
        onRequestClose={hideImageOptions}
      >
        <View style={styles.modalOverlay}>
          <View style={styles.imageOptionsModal}>
            <Text style={styles.modalTitle}>Select Profile Photo</Text>
            
            <TouchableOpacity style={styles.modalOption} onPress={openCamera}>
              <Ionicons name="camera" size={24} color="#2D5016" />
              <Text style={styles.modalOptionText}>Take Photo</Text>
            </TouchableOpacity>
            
            <TouchableOpacity style={styles.modalOption} onPress={pickImageFromGallery}>
              <Ionicons name="images" size={24} color="#2D5016" />
              <Text style={styles.modalOptionText}>Choose from Gallery</Text>
            </TouchableOpacity>
            
            {photo && (
              <TouchableOpacity style={[styles.modalOption, styles.removeOption]} onPress={removePhoto}>
                <Ionicons name="trash" size={24} color="#DC3545" />
                <Text style={[styles.modalOptionText, styles.removeOptionText]}>Remove Photo</Text>
              </TouchableOpacity>
            )}
            
            <TouchableOpacity style={styles.modalCancel} onPress={hideImageOptions}>
              <Text style={styles.modalCancelText}>Cancel</Text>
            </TouchableOpacity>
          </View>
        </View>
      </Modal>
    </SafeAreaView>
  );
}

const styles = StyleSheet.create({
  container: {
    flex: 1,
    backgroundColor: '#1B2951',
  },
  header: {
    paddingTop: 20,
    paddingHorizontal: 20,
    paddingBottom: 30,
  },
  backButton: {
    marginBottom: 20,
  },
  logoSection: {
    alignItems: 'center',
  },
  partyName: {
    fontSize: 20,
    fontWeight: 'bold',
    color: 'white',
    marginBottom: 10,
  },
  title: {
    fontSize: 28,
    fontWeight: 'bold',
    color: 'white',
  },
  formContainer: {
    flex: 1,
    backgroundColor: 'white',
    borderTopLeftRadius: 30,
    borderTopRightRadius: 30,
  },
  photoSection: {
    alignItems: 'center',
    paddingTop: 30,
    paddingBottom: 20,
  },
  photoContainer: {
    width: 120,
    height: 120,
    borderRadius: 60,
    overflow: 'hidden',
    marginBottom: 10,
  },
  photo: {
    width: '100%',
    height: '100%',
  },
  placeholderPhoto: {
    width: '100%',
    height: '100%',
    backgroundColor: '#F0F0F0',
    justifyContent: 'center',
    alignItems: 'center',
    borderWidth: 2,
    borderColor: '#E0E0E0',
    borderStyle: 'dashed',
  },
  photoButtonText: {
    color: '#999',
    fontSize: 12,
    textAlign: 'center',
    marginTop: 8,
  },
  changePhotoButton: {
    paddingHorizontal: 15,
    paddingVertical: 8,
    backgroundColor: '#F8F9FA',
    borderRadius: 20,
    borderWidth: 1,
    borderColor: '#E0E0E0',
  },
  changePhotoText: {
    color: '#2D5016',
    fontSize: 14,
    fontWeight: '500',
  },
  verificationMethodSection: {
    paddingHorizontal: 30,
    paddingVertical: 20,
  },
  sectionTitle: {
    fontSize: 20,
    fontWeight: 'bold',
    color: '#333',
    marginBottom: 10,
  },
  sectionDescription: {
    fontSize: 16,
    color: '#666',
    marginBottom: 25,
    lineHeight: 22,
  },
  methodButton: {
    backgroundColor: 'white',
    borderRadius: 12,
    marginBottom: 15,
    borderWidth: 1,
    borderColor: '#E0E0E0',
    elevation: 2,
    shadowColor: '#000',
    shadowOffset: { width: 0, height: 2 },
    shadowOpacity: 0.1,
    shadowRadius: 4,
  },
  methodButtonContent: {
    flexDirection: 'row',
    alignItems: 'center',
    padding: 20,
  },
  methodButtonText: {
    flex: 1,
    marginLeft: 15,
  },
  methodButtonTitle: {
    fontSize: 16,
    fontWeight: 'bold',
    color: '#333',
    marginBottom: 4,
  },
  methodButtonSubtitle: {
    fontSize: 14,
    color: '#666',
  },
  selectedMethodHeader: {
    flexDirection: 'row',
    justifyContent: 'space-between',
    alignItems: 'center',
    paddingVertical: 15,
    paddingHorizontal: 20,
    backgroundColor: '#F8F9FA',
    borderRadius: 10,
    marginBottom: 20,
  },
  selectedMethodInfo: {
    flexDirection: 'row',
    alignItems: 'center',
  },
  selectedMethodText: {
    fontSize: 16,
    fontWeight: '600',
    color: '#2D5016',
    marginLeft: 8,
  },
  changeMethodButton: {
    paddingHorizontal: 12,
    paddingVertical: 6,
    backgroundColor: 'white',
    borderRadius: 6,
    borderWidth: 1,
    borderColor: '#2D5016',
  },
  changeMethodText: {
    color: '#2D5016',
    fontSize: 12,
    fontWeight: '500',
  },
  form: {
    paddingHorizontal: 30,
    paddingBottom: 40,
  },
  aadhaarContainer: {
    marginBottom: 20,
  },
  aadhaarInputContainer: {
    position: 'relative',
  },
  input: {
    backgroundColor: 'white',
    paddingHorizontal: 15,
    paddingVertical: 12,
    borderRadius: 8,
    marginBottom: 20,
    fontSize: 16,
    borderWidth: 1,
    borderColor: '#E0E0E0',
  },
  aadhaarInput: {
    paddingRight: 80,
  },
  validatedInput: {
    borderColor: '#4CAF50',
    backgroundColor: '#F8FFF8',
  },
  autoFilledInput: {
    backgroundColor: '#F0F8FF',
    borderColor: '#4CAF50',
  },
  aadhaarLoader: {
    position: 'absolute',
    right: 15,
    top: 12,
    flexDirection: 'row',
    alignItems: 'center',
  },
  loaderText: {
    color: '#666',
    fontSize: 12,
    marginRight: 5,
  },
  aadhaarSuccess: {
    position: 'absolute',
    right: 15,
    top: 12,
    flexDirection: 'row',
    alignItems: 'center',
  },
  successText: {
    color: '#4CAF50',
    fontSize: 12,
    marginLeft: 5,
    fontWeight: '600',
  },
  aadhaarNote: {
    color: '#4CAF50',
    fontSize: 12,
    fontStyle: 'italic',
    marginTop: -15,
    marginBottom: 15,
    paddingLeft: 5,
  },
  registerButton: {
    backgroundColor: '#2D5016',
    paddingVertical: 15,
    borderRadius: 8,
    marginTop: 20,
  },
  registerButtonText: {
    color: 'white',
    fontSize: 18,
    fontWeight: 'bold',
    textAlign: 'center',
  },
  disabledButton: {
    backgroundColor: '#999',
  },
  loginLink: {
    alignItems: 'center',
    marginTop: 20,
  },
  loginLinkText: {
    color: '#666',
    fontSize: 16,
  },
  loginLinkHighlight: {
    color: '#2D5016',
    fontWeight: 'bold',
  },
  // Camera styles
  cameraContainer: {
    flex: 1,
    backgroundColor: 'black',
  },
  camera: {
    flex: 1,
  },
  cameraControls: {
    position: 'absolute',
    bottom: 40,
    left: 0,
    right: 0,
    flexDirection: 'row',
    justifyContent: 'space-around',
    alignItems: 'center',
  },
  cameraButton: {
    padding: 20,
  },
  captureButton: {
    width: 70,
    height: 70,
    borderRadius: 35,
    backgroundColor: 'white',
    justifyContent: 'center',
    alignItems: 'center',
  },
  captureButtonInner: {
    width: 60,
    height: 60,
    borderRadius: 30,
    backgroundColor: '#2D5016',
  },
  // Modal styles
  modalOverlay: {
    flex: 1,
    backgroundColor: 'rgba(0, 0, 0, 0.5)',
    justifyContent: 'flex-end',
  },
  imageOptionsModal: {
    backgroundColor: 'white',
    borderTopLeftRadius: 20,
    borderTopRightRadius: 20,
    paddingVertical: 20,
  },
  modalTitle: {
    fontSize: 18,
    fontWeight: 'bold',
    textAlign: 'center',
    marginBottom: 20,
    color: '#333',
  },
  modalOption: {
    flexDirection: 'row',
    alignItems: 'center',
    paddingHorizontal: 30,
    paddingVertical: 15,
    borderBottomWidth: 1,
    borderBottomColor: '#F0F0F0',
  },
  modalOptionText: {
    fontSize: 16,
    marginLeft: 15,
    color: '#333',
  },
  removeOption: {
    borderBottomColor: '#FFE6E6',
  },
  removeOptionText: {
    color: '#DC3545',
  },
  modalCancel: {
    paddingVertical: 15,
    alignItems: 'center',
    marginTop: 10,
  },
  modalCancelText: {
    fontSize: 16,
    color: '#666',
    fontWeight: '600',
  },
});

# ==== ./mobile-app/app/members.tsx ====

import React, { useState, useEffect } from 'react';
import {
  View,
  Text,
  StyleSheet,
  FlatList,
  TouchableOpacity,
  ActivityIndicator,
  Alert,
} from 'react-native';
import { SafeAreaView } from 'react-native-safe-area-context';
import { StatusBar } from 'expo-status-bar';
import { router } from 'expo-router';
import AsyncStorage from '@react-native-async-storage/async-storage';

export default function Members() {
  const [members, setMembers] = useState([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    loadMembers();
  }, []);

  const loadMembers = async () => {
    try {
      const token = await AsyncStorage.getItem('token');
      const response = await fetch('http://192.168.1.65:5000/api/members/all', {
        headers: {
          'Authorization': `Bearer ${token}`,
        },
      });

      if (response.ok) {
        const data = await response.json();
        console.log('Members data structure:', data[0]); // Log first item to see structure
        setMembers(data);
      } else {
        Alert.alert('Error', 'Failed to load members');
      }
    } catch (error) {
      console.error('Load members error:', error);
      Alert.alert('Error', 'Network error');
    } finally {
      setLoading(false);
    }
  };

  const renderMember = ({ item }) => (
    <View style={styles.memberCard}>
      <View style={styles.memberHeader}>
        <View style={styles.avatar}>
          <Text style={styles.avatarText}>
            {item.personalInfo.fullName.charAt(0).toUpperCase()}
          </Text>
        </View>
        <View style={styles.memberInfo}>
          <Text style={styles.memberName}>{item.personalInfo.fullName}</Text>
          <Text style={styles.memberId}>ID: {item.membershipId}</Text>
          <Text style={styles.memberEmail}>{item.personalInfo.email}</Text>
        </View>
      </View>

      <View style={styles.memberMeta}>
        <View style={styles.roleContainer}>
          <Text style={[
            styles.memberRole,
            { 
              backgroundColor: item.role === 'admin' ? '#FF5722' : 
                              item.role === 'organizer' ? '#2196F3' : '#4CAF50',
              color: 'white'
            }
          ]}>
            {item.role?.toUpperCase() || 'MEMBER'}
          </Text>
        </View>
        <Text style={styles.joinDate}>
          Joined {new Date(item.createdAt).toLocaleDateString()}
        </Text>
      </View>
    </View>
  );
   

  if (loading) {
    return (
      <SafeAreaView style={styles.container}>
        <View style={styles.header}>
          <TouchableOpacity
            style={styles.backButton}
            onPress={() => router.back()}
          >
            <Text style={styles.backButtonText}>← Back</Text>
          </TouchableOpacity>
          <Text style={styles.title}>Loading...</Text>
        </View>
        <View style={styles.loadingContainer}>
          <ActivityIndicator size="large" color="#2D5016" />
        </View>
      </SafeAreaView>
    );
  }

  return (
    <SafeAreaView style={styles.container}>
      <View style={styles.header}>
        <TouchableOpacity
          style={styles.backButton}
          onPress={() => router.back()}
        >
          <Text style={styles.backButtonText}>← Back</Text>
        </TouchableOpacity>
        <Text style={styles.title}>All Members</Text>
      </View>

      <View style={styles.statsHeader}>
        <Text style={styles.memberCount}>
          {members.length} Total Members
        </Text>
      </View>

      <FlatList
        data={members}
        renderItem={renderMember}
        keyExtractor={(item) => item.id?.toString() || item._id?.toString()}
        contentContainerStyle={styles.listContainer}
        showsVerticalScrollIndicator={false}
      />

      <StatusBar style="light" />
    </SafeAreaView>
  );
}

const styles = StyleSheet.create({
  container: {
    flex: 1,
    backgroundColor: '#f5f5f5',
  },
  header: {
    backgroundColor: '#1B2951',
    paddingVertical: 15,
    paddingHorizontal: 20,
    flexDirection: 'row',
    alignItems: 'center',
  },
  backButton: {
    marginRight: 15,
  },
  backButtonText: {
    color: 'white',
    fontSize: 16,
  },
  title: {
    color: 'white',
    fontSize: 18,
    fontWeight: 'bold',
    flex: 1,
  },
  loadingContainer: {
    flex: 1,
    justifyContent: 'center',
    alignItems: 'center',
  },
  statsHeader: {
    backgroundColor: 'white',
    paddingVertical: 15,
    paddingHorizontal: 20,
    borderBottomWidth: 1,
    borderBottomColor: '#e0e0e0',
  },
  memberCount: {
    fontSize: 16,
    fontWeight: 'bold',
    color: '#333',
  },
  listContainer: {
    paddingVertical: 10,
  },
  memberCard: {
    backgroundColor: 'white',
    marginHorizontal: 15,
    marginVertical: 5,
    borderRadius: 12,
    padding: 15,
    shadowColor: '#000',
    shadowOffset: { width: 0, height: 2 },
    shadowOpacity: 0.1,
    shadowRadius: 4,
    elevation: 3,
  },
  memberHeader: {
    flexDirection: 'row',
    alignItems: 'center',
    marginBottom: 10,
  },
  avatar: {
    width: 50,
    height: 50,
    borderRadius: 25,
    backgroundColor: '#2D5016',
    justifyContent: 'center',
    alignItems: 'center',
    marginRight: 15,
  },
  avatarText: {
    fontSize: 18,
    fontWeight: 'bold',
    color: 'white',
  },
  memberInfo: {
    flex: 1,
  },
  memberName: {
    fontSize: 16,
    fontWeight: 'bold',
    color: '#333',
    marginBottom: 2,
  },
  memberId: {
    fontSize: 14,
    color: '#2D5016',
    fontWeight: '600',
    marginBottom: 2,
  },
  memberEmail: {
    fontSize: 14,
    color: '#666',
  },
  memberMeta: {
    flexDirection: 'row',
    justifyContent: 'space-between',
    alignItems: 'center',
    borderTopWidth: 1,
    borderTopColor: '#e0e0e0',
    paddingTop: 10,
  },
  roleContainer: {
    alignItems: 'flex-start',
  },
  memberRole: {
    fontSize: 12,
    fontWeight: 'bold',
    paddingHorizontal: 8,
    paddingVertical: 4,
    borderRadius: 4,
  },
  joinDate: {
    fontSize: 12,
    color: '#999',
  },
});

# ==== ./mobile-app/app/scanner.tsx ====

import React, { useState, useEffect } from 'react';
import {
  View,
  Text,
  StyleSheet,
  Alert,
  TouchableOpacity,
  Modal,
  Image,
} from 'react-native';
import { SafeAreaView } from 'react-native-safe-area-context';
import { CameraView, Camera } from "expo-camera";
import { StatusBar } from 'expo-status-bar';
import { router } from 'expo-router';
import AsyncStorage from '@react-native-async-storage/async-storage';

export default function QRScanner() {
  const [hasPermission, setHasPermission] = useState(null);
  const [scanned, setScanned] = useState(false);
  const [memberData, setMemberData] = useState(null);
  const [modalVisible, setModalVisible] = useState(false);
  const [scanning, setScanning] = useState(true);

  useEffect(() => {
    (async () => {
      const { status } = await Camera.requestCameraPermissionsAsync();
      setHasPermission(status === 'granted');
    })();
  }, []);

  const handleBarCodeScanned = async ({ type, data }) => {
    setScanned(true);
    setScanning(false);
    
    try {
      const token = await AsyncStorage.getItem('token');
      const response = await fetch('http://localhost:3001/api/members/scan', {
        method: 'POST',
        headers: {
          'Authorization': `Bearer ${token}`,
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ qrData: data }),
      });

      const result = await response.json();

      if (response.ok && result.member) {
        setMemberData(result.member);
        setModalVisible(true);
      } else {
        Alert.alert('Invalid QR Code', 'Member not found or invalid QR code');
        resetScanner();
      }
    } catch (error) {
      console.error('Scan error:', error);
      Alert.alert('Error', 'Failed to verify member');
      resetScanner();
    }
  };

  const resetScanner = () => {
    setScanned(false);
    setScanning(true);
    setMemberData(null);
    setModalVisible(false);
  };

  const verifyMember = () => {
    Alert.alert(
      'Member Verified',
      `${memberData?.name} has been verified successfully.`,
      [{ text: 'OK', onPress: resetScanner }]
    );
  };

  if (hasPermission === null) {
    return (
      <SafeAreaView style={styles.container}>
        <View style={styles.messageContainer}>
          <Text style={styles.message}>Requesting camera permission...</Text>
        </View>
      </SafeAreaView>
    );
  }

  if (hasPermission === false) {
    return (
      <SafeAreaView style={styles.container}>
        <View style={styles.messageContainer}>
          <Text style={styles.message}>No access to camera</Text>
          <TouchableOpacity style={styles.button} onPress={() => router.back()}>
            <Text style={styles.buttonText}>Go Back</Text>
          </TouchableOpacity>
        </View>
      </SafeAreaView>
    );
  }

  return (
    <SafeAreaView style={styles.container}>
      {/* Header */}
      <View style={styles.header}>
        <TouchableOpacity
          style={styles.backButton}
          onPress={() => router.back()}
        >
          <Text style={styles.backButtonText}>← Back</Text>
        </TouchableOpacity>
        <Text style={styles.title}>QR Scanner</Text>
      </View>

      {/* Camera View */}
      {scanning && (
        <View style={styles.scannerContainer}>
          <CameraView
            style={styles.scanner}
            onBarcodeScanned={scanned ? undefined : handleBarCodeScanned}
            barcodeScannerSettings={{
              barcodeTypes: ["qr", "pdf417"],
            }}
          >
            <View style={styles.overlay}>
              <View style={styles.scanFrame} />
              <Text style={styles.scanText}>
                Point camera at member's QR code
              </Text>
            </View>
          </CameraView>
        </View>
      )}

      {!scanning && !modalVisible && (
        <View style={styles.messageContainer}>
          <Text style={styles.message}>Processing QR code...</Text>
          <TouchableOpacity style={styles.resetButton} onPress={resetScanner}>
            <Text style={styles.resetButtonText}>Scan Again</Text>
          </TouchableOpacity>
        </View>
      )}

      {/* Member Info Modal */}
      <Modal
        animationType="slide"
        transparent={true}
        visible={modalVisible}
        onRequestClose={() => setModalVisible(false)}
      >
        <View style={styles.modalContainer}>
          <View style={styles.modalContent}>
            <Text style={styles.modalTitle}>Member Information</Text>
            
            {memberData && (
              <View style={styles.memberInfo}>
                <View style={styles.memberDetails}>
                  <Text style={styles.detailItem}>
                    <Text style={styles.detailLabel}>Name: </Text>
                    {memberData.name}
                  </Text>
                  <Text style={styles.detailItem}>
                    <Text style={styles.detailLabel}>ID: </Text>
                    {memberData.membershipId}
                  </Text>
                  <Text style={styles.detailItem}>
                    <Text style={styles.detailLabel}>Email: </Text>
                    {memberData.email}
                  </Text>
                  <Text style={styles.detailItem}>
                    <Text style={styles.detailLabel}>Role: </Text>
                    {memberData.role || 'Member'}
                  </Text>
                  <Text style={styles.detailItem}>
                    <Text style={styles.detailLabel}>Member Since: </Text>
                    {new Date(memberData.createdAt).toLocaleDateString()}
                  </Text>
                </View>

                <View style={styles.verificationStatus}>
                  <Text style={styles.verifiedText}>✅ VERIFIED MEMBER</Text>
                </View>
              </View>
            )}

            <View style={styles.modalButtons}>
              <TouchableOpacity
                style={styles.verifyButton}
                onPress={verifyMember}
              >
                <Text style={styles.verifyButtonText}>Mark as Verified</Text>
              </TouchableOpacity>
              
              <TouchableOpacity
                style={styles.scanAgainButton}
                onPress={resetScanner}
              >
                <Text style={styles.scanAgainButtonText}>Scan Another</Text>
              </TouchableOpacity>
            </View>
          </View>
        </View>
      </Modal>
      
      <StatusBar style="light" />
    </SafeAreaView>
  );
}

const styles = StyleSheet.create({
  container: {
    flex: 1,
    backgroundColor: '#000',
  },
  header: {
    backgroundColor: '#1B2951',
    paddingVertical: 15,
    paddingHorizontal: 20,
    flexDirection: 'row',
    alignItems: 'center',
  },
  backButton: {
    marginRight: 15,
  },
  backButtonText: {
    color: 'white',
    fontSize: 16,
  },
  title: {
    color: 'white',
    fontSize: 18,
    fontWeight: 'bold',
    flex: 1,
  },
  messageContainer: {
    flex: 1,
    justifyContent: 'center',
    alignItems: 'center',
    paddingHorizontal: 20,
  },
  message: {
    fontSize: 18,
    color: 'white',
    textAlign: 'center',
    margin: 20,
  },
  button: {
    backgroundColor: '#2D5016',
    paddingVertical: 15,
    paddingHorizontal: 30,
    borderRadius: 8,
    alignSelf: 'center',
  },
  buttonText: {
    color: 'white',
    fontSize: 16,
    fontWeight: 'bold',
  },
  scannerContainer: {
    flex: 1,
    position: 'relative',
  },
  scanner: {
    flex: 1,
  },
  overlay: {
    position: 'absolute',
    top: 0,
    left: 0,
    right: 0,
    bottom: 0,
    justifyContent: 'center',
    alignItems: 'center',
  },
  scanFrame: {
    width: 250,
    height: 250,
    borderWidth: 2,
    borderColor: '#2D5016',
    backgroundColor: 'transparent',
    borderRadius: 20,
  },
  scanText: {
    color: 'white',
    fontSize: 16,
    marginTop: 20,
    textAlign: 'center',
    backgroundColor: 'rgba(0,0,0,0.7)',
    paddingHorizontal: 15,
    paddingVertical: 8,
    borderRadius: 5,
  },
  resetButton: {
    backgroundColor: '#2D5016',
    paddingVertical: 12,
    paddingHorizontal: 25,
    borderRadius: 8,
    marginTop: 20,
  },
  resetButtonText: {
    color: 'white',
    fontSize: 16,
    fontWeight: 'bold',
  },
  modalContainer: {
    flex: 1,
    justifyContent: 'center',
    alignItems: 'center',
    backgroundColor: 'rgba(0,0,0,0.5)',
  },
  modalContent: {
    backgroundColor: 'white',
    borderRadius: 15,
    padding: 20,
    width: '90%',
    maxWidth: 400,
  },
  modalTitle: {
    fontSize: 22,
    fontWeight: 'bold',
    textAlign: 'center',
    marginBottom: 20,
    color: '#1B2951',
  },
  memberInfo: {
    alignItems: 'center',
    marginBottom: 20,
  },
  memberDetails: {
    width: '100%',
    marginBottom: 15,
  },
  detailItem: {
    fontSize: 16,
    marginBottom: 8,
    color: '#333',
  },
  detailLabel: {
    fontWeight: 'bold',
    color: '#1B2951',
  },
  verificationStatus: {
    backgroundColor: '#E8F5E8',
    paddingVertical: 10,
    paddingHorizontal: 20,
    borderRadius: 8,
    marginTop: 10,
  },
  verifiedText: {
    color: '#2D5016',
    fontSize: 16,
    fontWeight: 'bold',
    textAlign: 'center',
  },
  modalButtons: {
    flexDirection: 'row',
    justifyContent: 'space-between',
  },
  verifyButton: {
    backgroundColor: '#4CAF50',
    paddingVertical: 12,
    paddingHorizontal: 20,
    borderRadius: 8,
    flex: 1,
    marginRight: 10,
  },
  verifyButtonText: {
    color: 'white',
    fontSize: 16,
    fontWeight: 'bold',
    textAlign: 'center',
  },
  scanAgainButton: {
    backgroundColor: '#2D5016',
    paddingVertical: 12,
    paddingHorizontal: 20,
    borderRadius: 8,
    flex: 1,
    marginLeft: 10,
  },
  scanAgainButtonText: {
    color: 'white',
    fontSize: 16,
    fontWeight: 'bold',
    textAlign: 'center',
  },
});

# ==== ./mobile-app/app/_layout.tsx ====

import { Stack } from 'expo-router';
import { AuthProvider } from '../contexts/AuthContext';

export default function RootLayout() {
  return (
    <AuthProvider>
      <Stack screenOptions={{ headerShown: false }}>
        <Stack.Screen name="index" />
        <Stack.Screen name="register" />
        <Stack.Screen name="login" />
        <Stack.Screen name="dashboard" />
        <Stack.Screen name="admin" />
        <Stack.Screen name="scanner" />
        <Stack.Screen name="members" />
        <Stack.Screen name="roles" />
      </Stack>
    </AuthProvider>
  );
}


# ==== ./mobile-app/app/admin.tsx ====

import React, { useState, useEffect } from 'react';
import {
  View,
  Text,
  StyleSheet,
  ScrollView,
  TouchableOpacity,
  Alert,
} from 'react-native';
import { SafeAreaView } from 'react-native-safe-area-context';
import { StatusBar } from 'expo-status-bar';
import { router } from 'expo-router';
import { useAuth } from '../contexts/AuthContext';

export default function AdminDashboard() {
  const { user, logout } = useAuth();
  const [stats, setStats] = useState({
    totalMembers: 0,
    newMembersThisWeek: 0,
    activeMembers: 0,
  });

  useEffect(() => {
    loadStats();
  }, []);

  const loadStats = async () => {
    // In a real app, you'd load these from your backend
    setStats({
      totalMembers: 156,
      newMembersThisWeek: 12,
      activeMembers: 142,
    });
  };

  const handleLogout = () => {
    Alert.alert(
      'Logout',
      'Are you sure you want to logout?',
      [
        { text: 'Cancel', style: 'cancel' },
        { 
          text: 'Logout', 
          onPress: async () => {
            await logout();
            router.replace('/');
          }
        },
      ]
    );
  };

  return (
    <SafeAreaView style={styles.container}>
      <ScrollView style={styles.scrollView}>
        {/* Header */}
        <View style={styles.header}>
          <View style={styles.headerLeft}>
            <Text style={styles.roleText}>{user?.role?.toUpperCase()}</Text>
            <Text style={styles.nameText}>{user?.name}</Text>
          </View>
          <TouchableOpacity style={styles.logoutButton} onPress={handleLogout}>
            <Text style={styles.logoutText}>Logout</Text>
          </TouchableOpacity>
        </View>

        {/* Welcome Card */}
        <View style={styles.welcomeCard}>
          <Text style={styles.welcomeTitle}>
            {user?.role === 'admin' ? 'Admin Control Panel' : 'Organizer Dashboard'}
          </Text>
          <Text style={styles.welcomeSubtitle}>
            Manage party membership and activities
          </Text>
        </View>

        {/* Stats Cards */}
        <View style={styles.statsContainer}>
          <View style={styles.statCard}>
            <Text style={styles.statNumber}>{stats.totalMembers}</Text>
            <Text style={styles.statLabel}>Total Members</Text>
          </View>
          <View style={styles.statCard}>
            <Text style={styles.statNumber}>{stats.newMembersThisWeek}</Text>
            <Text style={styles.statLabel}>New This Week</Text>
          </View>
          <View style={styles.statCard}>
            <Text style={styles.statNumber}>{stats.activeMembers}</Text>
            <Text style={styles.statLabel}>Active Members</Text>
          </View>
        </View>

        {/* Action Buttons */}
        <View style={styles.actionSection}>
          <Text style={styles.sectionTitle}>Member Management</Text>
          
          <TouchableOpacity
            style={styles.primaryAction}
            onPress={() => router.push('/scanner')}
          >
            <Text style={styles.primaryActionText}>📱 Scan Member QR Code</Text>
            <Text style={styles.actionSubtext}>Verify member identity</Text>
          </TouchableOpacity>

          <TouchableOpacity
            style={styles.primaryAction}
            onPress={() => router.push('/members')}
          >
            <Text style={styles.primaryActionText}>👥 View All Members</Text>
            <Text style={styles.actionSubtext}>Browse member directory</Text>
          </TouchableOpacity>

          <TouchableOpacity
            style={styles.secondaryAction}
            onPress={() => router.push('/register')}
          >
            <Text style={styles.secondaryActionText}>➕ Register New Member</Text>
          </TouchableOpacity>
        </View>

        {/* Admin Only Features */}
        {user?.role === 'admin' && (
          <View style={styles.actionSection}>
            <Text style={styles.sectionTitle}>Admin Features</Text>
            
            <TouchableOpacity
              style={styles.adminAction}
              onPress={() => router.push('/roles')}
            >
              <Text style={styles.adminActionText}>⚙️ Manage Roles</Text>
              <Text style={styles.actionSubtext}>Assign organizer permissions</Text>
            </TouchableOpacity>

            <TouchableOpacity
              style={styles.adminAction}
              onPress={() => Alert.alert('Feature', 'Export functionality coming soon!')}
            >
              <Text style={styles.adminActionText}>📊 Export Data</Text>
              <Text style={styles.actionSubtext}>Download member reports</Text>
            </TouchableOpacity>
          </View>
        )}
      </ScrollView>

      <StatusBar style="light" />
    </SafeAreaView>
  );
}

const styles = StyleSheet.create({
  container: {
    flex: 1,
    backgroundColor: '#f5f5f5',
  },
  scrollView: {
    flex: 1,
  },
  header: {
    backgroundColor: '#1B2951',
    paddingVertical: 20,
    paddingHorizontal: 20,
    flexDirection: 'row',
    justifyContent: 'space-between',
    alignItems: 'center',
  },
  headerLeft: {
    flex: 1,
  },
  roleText: {
    color: '#4CAF50',
    fontSize: 12,
    fontWeight: 'bold',
  },
  nameText: {
    color: 'white',
    fontSize: 20,
    fontWeight: 'bold',
  },
  logoutButton: {
    paddingHorizontal: 15,
    paddingVertical: 8,
    borderRadius: 8,
    borderWidth: 1,
    borderColor: 'white',
  },
  logoutText: {
    color: 'white',
    fontSize: 14,
    fontWeight: 'bold',
  },
  welcomeCard: {
    backgroundColor: 'white',
    margin: 20,
    borderRadius: 15,
    padding: 20,
    alignItems: 'center',
    shadowColor: '#000',
    shadowOffset: { width: 0, height: 2 },
    shadowOpacity: 0.1,
    shadowRadius: 8,
    elevation: 5,
  },
  welcomeTitle: {
    fontSize: 24,
    fontWeight: 'bold',
    color: '#1B2951',
    marginBottom: 10,
  },
  welcomeSubtitle: {
    fontSize: 16,
    color: '#666',
    textAlign: 'center',
  },
  statsContainer: {
    flexDirection: 'row',
    marginHorizontal: 20,
    marginBottom: 20,
    gap: 10,
  },
  statCard: {
    flex: 1,
    backgroundColor: 'white',
    paddingVertical: 20,
    paddingHorizontal: 15,
    borderRadius: 15,
    alignItems: 'center',
    shadowColor: '#000',
    shadowOffset: { width: 0, height: 2 },
    shadowOpacity: 0.1,
    shadowRadius: 8,
    elevation: 5,
  },
  statNumber: {
    fontSize: 24,
    fontWeight: 'bold',
    color: '#2D5016',
    marginBottom: 5,
  },
  statLabel: {
    fontSize: 12,
    color: '#666',
    textAlign: 'center',
  },
  actionSection: {
    marginHorizontal: 20,
    marginBottom: 30,
  },
  sectionTitle: {
    fontSize: 18,
    fontWeight: 'bold',
    color: '#333',
    marginBottom: 15,
  },
  primaryAction: {
    backgroundColor: '#2D5016',
    paddingVertical: 15,
    paddingHorizontal: 20,
    borderRadius: 12,
    marginBottom: 10,
  },
  primaryActionText: {
    color: 'white',
    fontSize: 16,
    fontWeight: 'bold',
    marginBottom: 5,
  },
  secondaryAction: {
    backgroundColor: 'white',
    borderWidth: 2,
    borderColor: '#2D5016',
    paddingVertical: 15,
    paddingHorizontal: 20,
    borderRadius: 12,
    marginBottom: 10,
  },
  secondaryActionText: {
    color: '#2D5016',
    fontSize: 16,
    fontWeight: 'bold',
    textAlign: 'center',
  },
  adminAction: {
    backgroundColor: '#1B2951',
    paddingVertical: 15,
    paddingHorizontal: 20,
    borderRadius: 12,
    marginBottom: 10,
  },
  adminActionText: {
    color: 'white',
    fontSize: 16,
    fontWeight: 'bold',
    marginBottom: 5,
  },
  actionSubtext: {
    color: 'rgba(255,255,255,0.8)',
    fontSize: 12,
  },
});

# ==== ./mobile-app/constants/Colors.ts ====

/**
 * Below are the colors that are used in the app. The colors are defined in the light and dark mode.
 * There are many other ways to style your app. For example, [Nativewind](https://www.nativewind.dev/), [Tamagui](https://tamagui.dev/), [unistyles](https://reactnativeunistyles.vercel.app), etc.
 */

const tintColorLight = '#0a7ea4';
const tintColorDark = '#fff';

export const Colors = {
  light: {
    text: '#11181C',
    background: '#fff',
    tint: tintColorLight,
    icon: '#687076',
    tabIconDefault: '#687076',
    tabIconSelected: tintColorLight,
  },
  dark: {
    text: '#ECEDEE',
    background: '#151718',
    tint: tintColorDark,
    icon: '#9BA1A6',
    tabIconDefault: '#9BA1A6',
    tabIconSelected: tintColorDark,
  },
};


# ==== ./mobile-app/constants/Theme.ts ====

// constants/Theme.ts
export const Theme = {
  colors: {
    primary: '#1B2951',
    secondary: '#2D5016',
    accent: '#E0E0E0',
    background: '#f5f5f5',
    surface: '#ffffff',
    text: {
      primary: '#000000',
      secondary: '#666666',
      onPrimary: '#ffffff',
      onSecondary: '#ffffff',
    },
    border: '#E0E0E0',
    error: '#FF5252',
    success: '#4CAF50',
    warning: '#FF9800',
  },
  
  spacing: {
    xs: 4,
    sm: 8,
    md: 16,
    lg: 24,
    xl: 32,
    xxl: 40,
  },
  
  typography: {
    h1: {
      fontSize: 32,
      fontWeight: 'bold' as const,
      lineHeight: 40,
    },
    h2: {
      fontSize: 28,
      fontWeight: 'bold' as const,
      lineHeight: 36,
    },
    h3: {
      fontSize: 24,
      fontWeight: 'bold' as const,
      lineHeight: 32,
    },
    h4: {
      fontSize: 20,
      fontWeight: 'bold' as const,
      lineHeight: 28,
    },
    body1: {
      fontSize: 16,
      fontWeight: 'normal' as const,
      lineHeight: 24,
    },
    body2: {
      fontSize: 14,
      fontWeight: 'normal' as const,
      lineHeight: 20,
    },
    button: {
      fontSize: 16,
      fontWeight: 'bold' as const,
      lineHeight: 24,
    },
  },
  
  borderRadius: {
    sm: 4,
    md: 8,
    lg: 12,
    xl: 16,
  },
  
  shadows: {
    sm: {
      shadowColor: '#000',
      shadowOffset: { width: 0, height: 1 },
      shadowOpacity: 0.1,
      shadowRadius: 2,
      elevation: 2,
    },
    md: {
      shadowColor: '#000',
      shadowOffset: { width: 0, height: 2 },
      shadowOpacity: 0.15,
      shadowRadius: 4,
      elevation: 4,
    },
    lg: {
      shadowColor: '#000',
      shadowOffset: { width: 0, height: 4 },
      shadowOpacity: 0.2,
      shadowRadius: 8,
      elevation: 8,
    },
  },
};

// Common layout styles
export const CommonStyles = {
  container: {
    flex: 1,
    backgroundColor: Theme.colors.background,
  },
  
  safeContainer: {
    flex: 1,
    backgroundColor: Theme.colors.primary,
  },
  
  header: {
    backgroundColor: Theme.colors.primary,
    paddingVertical: Theme.spacing.lg,
    paddingHorizontal: Theme.spacing.lg,
  },
  
  content: {
    flex: 1,
    paddingHorizontal: Theme.spacing.lg,
    paddingTop: Theme.spacing.xl,
  },
  
  centerContent: {
    flex: 1,
    justifyContent: 'center',
    alignItems: 'center',
  },
  
  form: {
    gap: Theme.spacing.md,
  },
  
  input: {
    backgroundColor: Theme.colors.surface,
    paddingHorizontal: Theme.spacing.md,
    paddingVertical: Theme.spacing.sm,
    borderRadius: Theme.borderRadius.md,
    fontSize: Theme.typography.body1.fontSize,
    borderWidth: 1,
    borderColor: Theme.colors.border,
  },
  
  primaryButton: {
    backgroundColor: Theme.colors.secondary,
    paddingVertical: Theme.spacing.md,
    borderRadius: Theme.borderRadius.lg,
    alignItems: 'center' as const,
    justifyContent: 'center' as const,
  },
  
  secondaryButton: {
    backgroundColor: 'transparent',
    borderWidth: 2,
    borderColor: Theme.colors.surface,
    paddingVertical: Theme.spacing.md,
    borderRadius: Theme.borderRadius.lg,
    alignItems: 'center' as const,
    justifyContent: 'center' as const,
  },
  
  buttonText: {
    ...Theme.typography.button,
    color: Theme.colors.text.onSecondary,
  },
  
  secondaryButtonText: {
    ...Theme.typography.button,
    color: Theme.colors.surface,
  },
};

# ==== ./mobile-app/utils/apiUtils.ts ====


import AsyncStorage from '@react-native-async-storage/async-storage';

// Configuration
const API_CONFIG = {
  BASE_URL: 'http://192.168.1.65:5000/api',
  TIMEOUT: 8000, // 8 seconds timeout for production
  RETRY_ATTEMPTS: 2,
  RETRY_DELAY: 1000, // 1 second between retries
};

interface ApiOptions extends RequestInit {
  timeout?: number;
  retryAttempts?: number;
  retryDelay?: number;
  requireAuth?: boolean;
}

interface ApiResponse<T = any> {
  success: boolean;
  data?: T;
  error?: string;
  status?: number;
}

// Delay utility for retries
const delay = (ms: number): Promise<void> => 
  new Promise(resolve => setTimeout(resolve, ms));

/**
 * Production-ready fetch wrapper with timeout, retries, and error handling
 */
export const apiRequest = async <T = any>(
  endpoint: string, 
  options: ApiOptions = {}
): Promise<ApiResponse<T>> => {
  const {
    timeout = API_CONFIG.TIMEOUT,
    retryAttempts = API_CONFIG.RETRY_ATTEMPTS,
    retryDelay = API_CONFIG.RETRY_DELAY,
    requireAuth = true,
    ...fetchOptions
  } = options;

  const url = endpoint.startsWith('http') ? endpoint : `${API_CONFIG.BASE_URL}${endpoint}`;
  
  // Prepare headers
  const headers: HeadersInit = {
    'Content-Type': 'application/json',
    ...fetchOptions.headers,
  };

  // Add auth header if required
  if (requireAuth) {
    try {
      const token = await AsyncStorage.getItem('token');
      if (token) {
        headers['Authorization'] = `Bearer ${token}`;
      } else {
        console.log('⚠️ No auth token found for authenticated request');
        return {
          success: false,
          error: 'Authentication required but no token found',
          status: 401,
        };
      }
    } catch (error) {
      console.error('❌ Error getting auth token:', error);
      return {
        success: false,
        error: 'Failed to retrieve authentication token',
        status: 401,
      };
    }
  }

  // Retry logic
  for (let attempt = 0; attempt <= retryAttempts; attempt++) {
    try {
      // Create AbortController for timeout
      const controller = new AbortController();
      const timeoutId = setTimeout(() => {
        controller.abort();
        console.log(`⏰ Request to ${endpoint} timed out after ${timeout}ms (attempt ${attempt + 1})`);
      }, timeout);

      console.log(`🌐 API Request: ${fetchOptions.method || 'GET'} ${url} (attempt ${attempt + 1})`);

      const response = await fetch(url, {
        ...fetchOptions,
        headers,
        signal: controller.signal,
      });

      // Clear timeout on successful request
      clearTimeout(timeoutId);

      console.log(`📡 Response: ${response.status} ${response.statusText}`);

      // Handle different response statuses
      if (response.ok) {
        try {
          const data = await response.json();
          return {
            success: true,
            data,
            status: response.status,
          };
        } catch (parseError) {
          console.error('❌ Error parsing response JSON:', parseError);
          return {
            success: false,
            error: 'Failed to parse server response',
            status: response.status,
          };
        }
      } else {
        // Handle non-2xx responses
        let errorMessage = `Server error: ${response.status} ${response.statusText}`;
        
        try {
          const errorData = await response.json();
          errorMessage = errorData.message || errorData.error || errorMessage;
        } catch {
          // If we can't parse error response, use default message
        }

        console.log(`⚠️ API Error: ${errorMessage}`);
        
        return {
          success: false,
          error: errorMessage,
          status: response.status,
        };
      }

    } catch (error: any) {
      console.error(`❌ Network error (attempt ${attempt + 1}):`, error.message);

      // Don't retry on abort errors (timeouts) or on the last attempt
      if (error.name === 'AbortError' || attempt === retryAttempts) {
        return {
          success: false,
          error: error.name === 'AbortError' ? 'Request timed out' : 'Network error',
          status: 0,
        };
      }

      // Wait before retrying (exponential backoff)
      const waitTime = retryDelay * Math.pow(2, attempt);
      console.log(`⏳ Waiting ${waitTime}ms before retry...`);
      await delay(waitTime);
    }
  }

  // This should never be reached, but TypeScript requires it
  return {
    success: false,
    error: 'Maximum retry attempts exceeded',
    status: 0,
  };
};

/**
 * Specialized API methods for common operations
 */
export const api = {
  // GET request
  get: <T = any>(endpoint: string, options: Omit<ApiOptions, 'method'> = {}) =>
    apiRequest<T>(endpoint, { ...options, method: 'GET' }),

  // POST request
  post: <T = any>(endpoint: string, data?: any, options: Omit<ApiOptions, 'method' | 'body'> = {}) =>
    apiRequest<T>(endpoint, {
      ...options,
      method: 'POST',
      body: data ? JSON.stringify(data) : undefined,
    }),

  // PUT request
  put: <T = any>(endpoint: string, data?: any, options: Omit<ApiOptions, 'method' | 'body'> = {}) =>
    apiRequest<T>(endpoint, {
      ...options,
      method: 'PUT',
      body: data ? JSON.stringify(data) : undefined,
    }),

  // DELETE request
  delete: <T = any>(endpoint: string, options: Omit<ApiOptions, 'method'> = {}) =>
    apiRequest<T>(endpoint, { ...options, method: 'DELETE' }),
};

/**
 * Specific API endpoints
 */
export const profileAPI = {
  // Get user profile
  getProfile: () => api.get('/members/profile'),

  // Update user profile
  updateProfile: (profileData: any) => api.put('/members/profile', profileData),
};

export const authAPI = {
  // Login (no auth required)
  login: (credentials: { identifier: string; password: string }) =>
    api.post('/auth/login', credentials, { requireAuth: false }),

  // Register (no auth required)  
  register: (userData: any) =>
    api.post('/auth/register', userData, { requireAuth: false }),
};

export const memberAPI = {
  // Get all members
  getAllMembers: () => api.get('/members'),

  // Update member role
  updateMemberRole: (id: string, role: string) =>
    api.put(`/members/${id}/role`, { role }),

  // Delete member
  deleteMember: (id: string) => api.delete(`/members/${id}`),
};

export default api;

# ==== ./mobile-app/components/ExternalLink.tsx ====

import { Link } from 'expo-router';
import { openBrowserAsync } from 'expo-web-browser';
import { type ComponentProps } from 'react';
import { Platform } from 'react-native';

type Props = Omit<ComponentProps<typeof Link>, 'href'> & { href: string };

export function ExternalLink({ href, ...rest }: Props) {
  return (
    <Link
      target="_blank"
      {...rest}
      href={href}
      onPress={async (event) => {
        if (Platform.OS !== 'web') {
          // Prevent the default behavior of linking to the default browser on native.
          event.preventDefault();
          // Open the link in an in-app browser.
          await openBrowserAsync(href);
        }
      }}
    />
  );
}

# ==== ./mobile-app/components/ThemedText.tsx ====

import { StyleSheet, Text, type TextProps } from 'react-native';

import { useThemeColor } from '@/hooks/useThemeColor';

export type ThemedTextProps = TextProps & {
  lightColor?: string;
  darkColor?: string;
  type?: 'default' | 'title' | 'defaultSemiBold' | 'subtitle' | 'link';
};

export function ThemedText({
  style,
  lightColor,
  darkColor,
  type = 'default',
  ...rest
}: ThemedTextProps) {
  const color = useThemeColor({ light: lightColor, dark: darkColor }, 'text');

  return (
    <Text
      style={[
        { color },
        type === 'default' ? styles.default : undefined,
        type === 'title' ? styles.title : undefined,
        type === 'defaultSemiBold' ? styles.defaultSemiBold : undefined,
        type === 'subtitle' ? styles.subtitle : undefined,
        type === 'link' ? styles.link : undefined,
        style,
      ]}
      {...rest}
    />
  );
}

const styles = StyleSheet.create({
  default: {
    fontSize: 16,
    lineHeight: 24,
  },
  defaultSemiBold: {
    fontSize: 16,
    lineHeight: 24,
    fontWeight: '600',
  },
  title: {
    fontSize: 32,
    fontWeight: 'bold',
    lineHeight: 32,
  },
  subtitle: {
    fontSize: 20,
    fontWeight: 'bold',
  },
  link: {
    lineHeight: 30,
    fontSize: 16,
    color: '#0a7ea4',
  },
});

# ==== ./mobile-app/components/TabBarBackground.tsx ====

// This is a shim for web and Android where the tab bar is generally opaque.
export default undefined;

export function useBottomTabOverflow() {
  return 0;
}

# ==== ./mobile-app/components/ThemedView.tsx ====

import { View, type ViewProps } from 'react-native';

import { useThemeColor } from '@/hooks/useThemeColor';

export type ThemedViewProps = ViewProps & {
  lightColor?: string;
  darkColor?: string;
};

export function ThemedView({ style, lightColor, darkColor, ...otherProps }: ThemedViewProps) {
  const backgroundColor = useThemeColor({ light: lightColor, dark: darkColor }, 'background');

  return <View style={[{ backgroundColor }, style]} {...otherProps} />;
}

# ==== ./mobile-app/components/HelloWave.tsx ====

import { useEffect } from 'react';
import { StyleSheet } from 'react-native';
import Animated, {
  useAnimatedStyle,
  useSharedValue,
  withRepeat,
  withSequence,
  withTiming,
} from 'react-native-reanimated';

import { ThemedText } from '@/components/ThemedText';

export function HelloWave() {
  const rotationAnimation = useSharedValue(0);

  useEffect(() => {
    rotationAnimation.value = withRepeat(
      withSequence(withTiming(25, { duration: 150 }), withTiming(0, { duration: 150 })),
      4 // Run the animation 4 times
    );
  }, [rotationAnimation]);

  const animatedStyle = useAnimatedStyle(() => ({
    transform: [{ rotate: `${rotationAnimation.value}deg` }],
  }));

  return (
    <Animated.View style={animatedStyle}>
      <ThemedText style={styles.text}>👋</ThemedText>
    </Animated.View>
  );
}

const styles = StyleSheet.create({
  text: {
    fontSize: 28,
    lineHeight: 32,
    marginTop: -6,
  },
});

# ==== ./mobile-app/components/ParallaxScrollView.tsx ====

import type { PropsWithChildren, ReactElement } from 'react';
import { StyleSheet } from 'react-native';
import Animated, {
  interpolate,
  useAnimatedRef,
  useAnimatedStyle,
  useScrollViewOffset,
} from 'react-native-reanimated';

import { ThemedView } from '@/components/ThemedView';
import { useBottomTabOverflow } from '@/components/ui/TabBarBackground';
import { useColorScheme } from '@/hooks/useColorScheme';

const HEADER_HEIGHT = 250;

type Props = PropsWithChildren<{
  headerImage: ReactElement;
  headerBackgroundColor: { dark: string; light: string };
}>;

export default function ParallaxScrollView({
  children,
  headerImage,
  headerBackgroundColor,
}: Props) {
  const colorScheme = useColorScheme() ?? 'light';
  const scrollRef = useAnimatedRef<Animated.ScrollView>();
  const scrollOffset = useScrollViewOffset(scrollRef);
  const bottom = useBottomTabOverflow();
  const headerAnimatedStyle = useAnimatedStyle(() => {
    return {
      transform: [
        {
          translateY: interpolate(
            scrollOffset.value,
            [-HEADER_HEIGHT, 0, HEADER_HEIGHT],
            [-HEADER_HEIGHT / 2, 0, HEADER_HEIGHT * 0.75]
          ),
        },
        {
          scale: interpolate(scrollOffset.value, [-HEADER_HEIGHT, 0, HEADER_HEIGHT], [2, 1, 1]),
        },
      ],
    };
  });

  return (
    <ThemedView style={styles.container}>
      <Animated.ScrollView
        ref={scrollRef}
        scrollEventThrottle={16}
        scrollIndicatorInsets={{ bottom }}
        contentContainerStyle={{ paddingBottom: bottom }}>
        <Animated.View
          style={[
            styles.header,
            { backgroundColor: headerBackgroundColor[colorScheme] },
            headerAnimatedStyle,
          ]}>
          {headerImage}
        </Animated.View>
        <ThemedView style={styles.content}>{children}</ThemedView>
      </Animated.ScrollView>
    </ThemedView>
  );
}

const styles = StyleSheet.create({
  container: {
    flex: 1,
  },
  header: {
    height: HEADER_HEIGHT,
    overflow: 'hidden',
  },
  content: {
    flex: 1,
    padding: 32,
    gap: 16,
    overflow: 'hidden',
  },
});

# ==== ./mobile-app/components/HapticTab.tsx ====

import { BottomTabBarButtonProps } from '@react-navigation/bottom-tabs';
import { PlatformPressable } from '@react-navigation/elements';
import * as Haptics from 'expo-haptics';

export function HapticTab(props: BottomTabBarButtonProps) {
  return (
    <PlatformPressable
      {...props}
      onPressIn={(ev) => {
        if (process.env.EXPO_OS === 'ios') {
          // Add a soft haptic feedback when pressing down on the tabs.
          Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Light);
        }
        props.onPressIn?.(ev);
      }}
    />
  );
}

# ==== ./mobile-app/components/Collapsible.tsx ====

import { PropsWithChildren, useState } from 'react';
import { StyleSheet, TouchableOpacity } from 'react-native';

import { ThemedText } from '@/components/ThemedText';
import { ThemedView } from '@/components/ThemedView';
import { IconSymbol } from '@/components/ui/IconSymbol';
import { Colors } from '@/constants/Colors';
import { useColorScheme } from '@/hooks/useColorScheme';

export function Collapsible({ children, title }: PropsWithChildren & { title: string }) {
  const [isOpen, setIsOpen] = useState(false);
  const theme = useColorScheme() ?? 'light';

  return (
    <ThemedView>
      <TouchableOpacity
        style={styles.heading}
        onPress={() => setIsOpen((value) => !value)}
        activeOpacity={0.8}>
        <IconSymbol
          name="chevron.right"
          size={18}
          weight="medium"
          color={theme === 'light' ? Colors.light.icon : Colors.dark.icon}
          style={{ transform: [{ rotate: isOpen ? '90deg' : '0deg' }] }}
        />
        <ThemedText type="defaultSemiBold">{title}</ThemedText>
      </TouchableOpacity>
      {isOpen && <ThemedView style={styles.content}>{children}</ThemedView>}
    </ThemedView>
  );
}

const styles = StyleSheet.create({
  heading: {
    flexDirection: 'row',
    alignItems: 'center',
    gap: 6,
  },
  content: {
    marginTop: 6,
    marginLeft: 24,
  },
});

# ==== ./mobile-app/components/ui/TabBarBackground.ios.tsx ====

import { BlurView } from 'expo-blur';
import { useSafeAreaInsets } from 'react-native-safe-area-context';

export default function BlurTabBarBackground() {
  const { bottom } = useSafeAreaInsets();

  return (
    <BlurView
      tint="systemMaterial"
      intensity={100}
      style={{
        position: 'absolute',
        top: 0,
        left: 0,
        bottom: -bottom,
        right: 0,
      }}
    />
  );
}

export function useBottomTabOverflow() {
  const { bottom } = useSafeAreaInsets();
  return bottom;
}

# ==== ./mobile-app/components/ui/IconSymbol.tsx ====

import MaterialIcons from '@expo/vector-icons/MaterialIcons';
import { type IconProps } from '@expo/vector-icons/build/createIconSet';
import { type ComponentProps } from 'react';

/**
 * An icon component that uses native SF Symbols on iOS, and Material Icons on Android and web.
 * This ensures a consistent look across platforms, and optimal resource usage.
 * Icon `name`s are based on SF Symbols and require manual mapping to Material Icons.
 */
export function IconSymbol({
  name,
  size = 24,
  color,
  style,
}: {
  name: string;
  size?: number;
  color: string;
  style?: ComponentProps<typeof MaterialIcons>['style'];
}) {
  return <MaterialIcons color={color} size={size} name={name as any} style={style} />;
}

# ==== ./mobile-app/hooks/useColorScheme.web.ts ====

import { useEffect, useState } from 'react';
import { useColorScheme as useRNColorScheme } from 'react-native';

/**
 * To support static rendering, this value needs to be re-calculated on the client side for web
 */
export function useColorScheme() {
  const [hasHydrated, setHasHydrated] = useState(false);

  useEffect(() => {
    setHasHydrated(true);
  }, []);

  const colorScheme = useRNColorScheme();

  if (hasHydrated) {
    return colorScheme;
  }

  return 'light';
}


# ==== ./mobile-app/hooks/useThemeColor.ts ====

/**
 * Learn more about light and dark modes:
 * https://docs.expo.dev/guides/color-schemes/
 */

import { Colors } from '@/constants/Colors';
import { useColorScheme } from '@/hooks/useColorScheme';

export function useThemeColor(
  props: { light?: string; dark?: string },
  colorName: keyof typeof Colors.light & keyof typeof Colors.dark
) {
  const theme = useColorScheme() ?? 'light';
  const colorFromProps = props[theme];

  if (colorFromProps) {
    return colorFromProps;
  } else {
    return Colors[theme][colorName];
  }
}


# ==== ./mobile-app/hooks/useColorScheme.ts ====

export { useColorScheme } from 'react-native';

# ==== ./mobile-app/.vscode/settings.json ====

{
  "editor.codeActionsOnSave": {
    "source.fixAll": "explicit",
    "source.organizeImports": "explicit",
    "source.sortMembers": "explicit"
  }
}

# ==== ./mobile-app/services/apiService.js ====

// mobile-app/services/apiService.js
import AsyncStorage from '@react-native-async-storage/async-storage';

export const API_CONFIG = {
  BASE_URL: 'http://192.168.1.65:5000/api',
  TIMEOUT: 10000,
  RETRY_ATTEMPTS: 2,
  RETRY_DELAY: 1000,
};

const delay = (ms) => new Promise(resolve => setTimeout(resolve, ms));

export const apiRequest = async (endpoint, options = {}) => {
  const {
    timeout = API_CONFIG.TIMEOUT,
    retryAttempts = API_CONFIG.RETRY_ATTEMPTS,
    retryDelay = API_CONFIG.RETRY_DELAY,
    requireAuth = false,
    ...fetchOptions
  } = options;

  const url = endpoint.startsWith('http') ? endpoint : `${API_CONFIG.BASE_URL}${endpoint}`;
  
  const headers = {
    'Content-Type': 'application/json',
    ...fetchOptions.headers,
  };

  if (requireAuth) {
    try {
      const token = await AsyncStorage.getItem('token');
      if (token) {
        headers['Authorization'] = `Bearer ${token}`;
      } else {
        throw new Error('No authentication token found');
      }
    } catch (error) {
      throw new Error('Authentication required but no token found');
    }
  }

  for (let attempt = 0; attempt <= retryAttempts; attempt++) {
    try {
      const controller = new AbortController();
      const timeoutId = setTimeout(() => controller.abort(), timeout);

      console.log(`🌐 API Request: ${fetchOptions.method || 'GET'} ${url} (attempt ${attempt + 1})`);

      const response = await fetch(url, {
        ...fetchOptions,
        headers,
        signal: controller.signal,
      });

      clearTimeout(timeoutId);
      console.log(`📡 Response: ${response.status} ${response.statusText}`);

      const data = await response.json();

      if (response.ok) {
        return { success: true, data, status: response.status };
      } else {
        return { success: false, error: data.message || 'Request failed', status: response.status, data };
      }
    } catch (error) {
      console.error(`❌ Request attempt ${attempt + 1} failed:`, error.message);
      
      if (attempt === retryAttempts) {
        let errorMessage = 'Network error. Please try again.';
        if (error.name === 'AbortError') {
          errorMessage = 'Request timed out. Please check your connection.';
        } else if (error.message.includes('Network request failed')) {
          errorMessage = 'Unable to connect to server. Please check your internet connection.';
        }
        throw new Error(errorMessage);
      }
      await delay(retryDelay);
    }
  }
};

export const authAPI = {
  login: async (identifier, password) => {
    return apiRequest('/auth/login', {
      method: 'POST',
      body: JSON.stringify({ identifier, password }),
    });
  },
};

export const handleApiError = (error, defaultMessage = 'Something went wrong') => {
  if (typeof error === 'string') return error;
  if (error?.message) return error.message;
  return defaultMessage;
};

# ==== ./mobile-app/src/context/AuthContext.js ====

import React, { createContext, useState, useContext, useEffect } from 'react';
import AsyncStorage from '@react-native-async-storage/async-storage';

const AuthContext = createContext();

export const AuthProvider = ({ children }) => {
  const [user, setUser] = useState(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    loadUserData();
  }, []);

  const loadUserData = async () => {
    try {
      const token = await AsyncStorage.getItem('token');
      const userData = await AsyncStorage.getItem('user');
      
      if (token && userData) {
        setUser(JSON.parse(userData));
      }
    } catch (error) {
      console.error('Error loading user data:', error);
    } finally {
      setLoading(false);
    }
  };

  const login = async (token, userData) => {
    try {
      await AsyncStorage.setItem('token', token);
      await AsyncStorage.setItem('user', JSON.stringify(userData));
      setUser(userData);
    } catch (error) {
      console.error('Error saving user data:', error);
    }
  };

  const logout = async () => {
    try {
      await AsyncStorage.removeItem('token');
      await AsyncStorage.removeItem('user');
      setUser(null);
    } catch (error) {
      console.error('Error removing user data:', error);
    }
  };

  return (
    <AuthContext.Provider value={{ user, login, logout, loading }}>
      {children}
    </AuthContext.Provider>
  );
};

export const useAuth = () => {
  const context = useContext(AuthContext);
  if (!context) {
    throw new Error('useAuth must be used within an AuthProvider');
  }
  return context;
};

# ==== ./mobile-app/src/screens/RegisterScreen.js ====

import React from 'react';
import { View, Text } from 'react-native';

const RegisterScreen = () => {
  return (
    <View style={{ flex: 1, justifyContent: 'center', alignItems: 'center' }}>
      <Text>Register Screen - Coming Soon!</Text>
    </View>
  );
};

export default RegisterScreen;

# ==== ./mobile-app/src/screens/LoginScreen.js ====

import React from 'react';
import { View, Text } from 'react-native';

const LoginScreen = () => {
  return (
    <View style={{ flex: 1, justifyContent: 'center', alignItems: 'center' }}>
      <Text>Login Screen - Coming Soon!</Text>
    </View>
  );
};

export default LoginScreen;

# ==== ./mobile-app/src/screens/WelcomeScreen.js ====

import React from 'react';
import { View, Text } from 'react-native';

const WelcomeScreen = () => {
  return (
    <View style={{ flex: 1, justifyContent: 'center', alignItems: 'center' }}>
      <Text>Welcome Screen - Coming Soon!</Text>
    </View>
  );
};

export default WelcomeScreen;

# ==== ./mobile-app/src/services/api.js ====

import AsyncStorage from '@react-native-async-storage/async-storage';

const API_URL = 'http://localhost:3001/api';

class ApiService {
  async getAuthHeader() {
    const token = await AsyncStorage.getItem('token');
    return {
      'Content-Type': 'application/json',
      ...(token && { Authorization: `Bearer ${token}` }),
    };
  }

  async request(endpoint, options = {}) {
    const url = `${API_URL}${endpoint}`;
    const headers = await this.getAuthHeader();

    try {
      const response = await fetch(url, {
        ...options,
        headers: {
          ...headers,
          ...options.headers,
        },
      });

      if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
      }

      return await response.json();
    } catch (error) {
      console.error('API request failed:', error);
      throw error;
    }
  }
}

const apiService = new ApiService();

export const authAPI = {
  login: (credentials) =>
    apiService.request('/auth/login', {
      method: 'POST',
      body: JSON.stringify(credentials),
    }),

  register: (userData) =>
    apiService.request('/auth/register', {
      method: 'POST',
      body: JSON.stringify(userData),
    }),
};

export const memberAPI = {
  getProfile: () => apiService.request('/members/profile'),
  
  updateProfile: (profileData) =>
    apiService.request('/members/profile', {
      method: 'PUT',
      body: JSON.stringify(profileData),
    }),

  getAllMembers: () => apiService.request('/members'),
  
  getMemberById: (id) => apiService.request(`/members/${id}`),
  
  updateMemberRole: (id, role) =>
    apiService.request(`/members/${id}/role`, {
      method: 'PUT',
      body: JSON.stringify({ role }),
    }),
};

# ==== ./.expo/settings.json ====

{
  "hostType": "lan",
  "lanType": "ip",
  "dev": true,
  "minify": false,
  "urlRandomness": null,
  "https": false
}


# ==== ./backend/server.js ====

// backend/server.js - COMPLETE FIXED VERSION
const express = require('express');
const cors = require('cors');
const path = require('path');
require('dotenv').config();

const { sequelize } = require('./config/database');
const authRoutes = require('./routes/auth');
const memberRoutes = require('./routes/members');

const app = express();
const PORT = process.env.PORT || 5000;

console.log('🚀 Starting server...');

// CORS configuration - CRITICAL FOR MOBILE APP
app.use(cors({
  origin: '*', // Allow all origins for development
  methods: ['GET', 'POST', 'PUT', 'DELETE', 'PATCH', 'OPTIONS'],
  allowedHeaders: ['Content-Type', 'Authorization', 'X-Requested-With'],
  credentials: false
}));

// Handle preflight requests
app.options('*', cors());

// Body parsing middleware
app.use(express.json({ limit: '10mb' }));
app.use(express.urlencoded({ extended: true, limit: '10mb' }));

// Request logging middleware
app.use((req, res, next) => {
  console.log(`${new Date().toISOString()} - ${req.method} ${req.path}`);
  next();
});

// Serve static files (profile photos)
app.use('/uploads', express.static(path.join(__dirname, 'uploads')));

// Health check endpoint
app.get('/health', (req, res) => {
  res.json({ 
    status: 'OK', 
    message: 'Server is running',
    timestamp: new Date().toISOString(),
    version: '1.0.0'
  });
});

// Root endpoint
app.get('/', (req, res) => {
  res.json({
    message: 'Gorkha Janshakti Front API Server',
    status: 'Running',
    endpoints: {
      health: '/health',
      auth: '/api/auth',
      members: '/api/members'
    }
  });
});

// API routes
app.use('/api/auth', authRoutes);
app.use('/api/members', memberRoutes);

// Error handling middleware
app.use((err, req, res, next) => {
  console.error('❌ Server error:', err);
  res.status(500).json({ 
    message: 'Internal server error',
    error: process.env.NODE_ENV === 'development' ? err.message : 'Something went wrong'
  });
});

// 404 handler
app.use('*', (req, res) => {
  console.log(`❓ Route not found: ${req.method} ${req.originalUrl}`);
  res.status(404).json({ 
    message: 'Route not found',
    path: req.originalUrl,
    method: req.method
  });
});

// Start server
const startServer = async () => {
  try {
    console.log('🔌 Testing database connection...');
    await sequelize.authenticate();
    console.log('✅ Database connected successfully');

    console.log('🔄 Syncing database...');
    await sequelize.sync({ alter: true });
    console.log('✅ Database synced');

    // Start listening
    const server = app.listen(PORT, '0.0.0.0', () => {
      console.log('🎉 Server started successfully!');
      console.log('📍 Server running on:');
      console.log(`   - Local: http://localhost:${PORT}`);
      console.log(`   - Network: http://192.168.1.65:${PORT}`);
      console.log('📱 API Base URL: http://192.168.1.65:5000/api');
      console.log('🔍 Health Check: http://192.168.1.65:5000/health');
      console.log('='.repeat(50));
    });

    // Graceful shutdown
    process.on('SIGTERM', () => {
      console.log('🛑 SIGTERM received, shutting down gracefully...');
      server.close(() => {
        console.log('✅ Process terminated');
      });
    });

  } catch (error) {
    console.error('❌ Server startup error:', error);
    process.exit(1);
  }
};

startServer();

# ==== ./backend/test-server-with-db.js ====

const express = require('express');
const cors = require('cors');
const path = require('path');
require('dotenv').config();

console.log('🔌 Testing database connection...');
const { sequelize } = require('./config/database');

const app = express();
const PORT = process.env.PORT || 5000;

console.log('🚀 Starting test server with database...');

// Middleware
app.use(cors({
  origin: '*',
  methods: ['GET', 'POST', 'PUT', 'DELETE', 'PATCH', 'OPTIONS'],
  allowedHeaders: ['Content-Type', 'Authorization', 'X-Requested-With'],
  credentials: false
}));

app.use(express.json({ limit: '10mb' }));
app.use(express.urlencoded({ extended: true, limit: '10mb' }));

// Health check
app.get('/health', (req, res) => {
  res.json({ 
    status: 'OK', 
    message: 'Test server with DB is running',
    timestamp: new Date().toISOString()
  });
});

// Load routes
const authRoutes = require('./routes/auth');
const memberRoutes = require('./routes/members');

app.use('/api/auth', authRoutes);
app.use('/api/members', memberRoutes);

// Start server with database
const startServer = async () => {
  try {
    await sequelize.authenticate();
    console.log('✅ Database connected successfully');

    await sequelize.sync({ alter: true });
    console.log('✅ Database synced');

    app.listen(PORT, '0.0.0.0', () => {
      console.log('✅ Test server with DB started successfully on port', PORT);
    });
  } catch (error) {
    console.error('❌ Server startup error:', error);
    process.exit(1);
  }
};

startServer();


# ==== ./backend/package.json ====

{
  "name": "backend",
  "version": "1.0.0",
  "main": "index.js",
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1",
    "start": "node server.js",
    "dev": "nodemon server.js"
  },
  "keywords": [],
  "author": "",
  "license": "ISC",
  "description": "",
  "dependencies": {
    "@expo/vector-icons": "^14.1.0",
    "bcrypt": "^6.0.0",
    "bcryptjs": "^3.0.2",
    "cors": "^2.8.5",
    "dotenv": "^17.2.1",
    "expo-barcode-scanner": "^13.0.1",
    "expo-camera": "~16.1.11",
    "expo-image-picker": "~16.1.4",
    "express": "^4.18.2",
    "express-rate-limit": "^8.0.1",
    "helmet": "^8.1.0",
    "html-pdf": "^3.0.1",
    "jsonwebtoken": "^9.0.2",
    "multer": "^2.0.2",
    "nodemailer": "^7.0.6",
    "puppeteer": "^24.18.0",
    "qrcode": "^1.5.4",
    "react-native-qrcode-svg": "^6.3.15",
    "react-native-svg": "^15.12.1",
    "sequelize": "^6.37.7",
    "sqlite3": "^5.1.7",
    "uuid": "^11.1.0"
  },
  "devDependencies": {
    "nodemon": "^3.1.10"
  }
}


# ==== ./backend/debug-server.js ====

// backend/debug-server.js - Temporary file to isolate the issue
const express = require('express');
const cors = require('cors');
require('dotenv').config();

const app = express();
const PORT = process.env.PORT || 5000;

console.log('🔍 Debug server starting...');

// Basic middleware
app.use(cors());
app.use(express.json());

// Test basic route
app.get('/', (req, res) => {
  res.json({ message: 'Debug server working' });
});

// Test auth routes
console.log('Testing auth routes...');
try {
  const authRoutes = require('./routes/auth');
  app.use('/api/auth', authRoutes);
  console.log('✅ Auth routes loaded successfully');
} catch (error) {
  console.error('❌ Auth routes failed:', error.message);
}

// Test member routes
console.log('Testing member routes...');
try {
  const memberRoutes = require('./routes/members');
  app.use('/api/members', memberRoutes);
  console.log('✅ Member routes loaded successfully');
} catch (error) {
  console.error('❌ Member routes failed:', error.message);
}

app.listen(PORT, () => {
  console.log(`🎉 Debug server running on port ${PORT}`);
});


# ==== ./backend/test-server.js ====

// backend/test-server.js - Minimal version of your main server
const express = require('express');
const cors = require('cors');
const path = require('path');
require('dotenv').config();

const app = express();
const PORT = process.env.PORT || 5000;

console.log('🚀 Starting test server...');

// Basic middleware (same as debug server)
app.use(cors({
  origin: '*',
  methods: ['GET', 'POST', 'PUT', 'DELETE', 'PATCH', 'OPTIONS'],
  allowedHeaders: ['Content-Type', 'Authorization', 'X-Requested-With'],
  credentials: false
}));

app.use(express.json({ limit: '10mb' }));
app.use(express.urlencoded({ extended: true, limit: '10mb' }));

// Health check
app.get('/health', (req, res) => {
  res.json({ 
    status: 'OK', 
    message: 'Test server is running',
    timestamp: new Date().toISOString()
  });
});

// Try loading routes
console.log('Loading auth routes...');
const authRoutes = require('./routes/auth');
app.use('/api/auth', authRoutes);

console.log('Loading member routes...');
const memberRoutes = require('./routes/members');
app.use('/api/members', memberRoutes);

console.log('All routes loaded, starting server...');

app.listen(PORT, '0.0.0.0', () => {
  console.log('✅ Test server started successfully on port', PORT);
});


# ==== ./backend/middleware/auth.js ====

// backend/middleware/auth.js - CLEANED VERSION
const jwt = require('jsonwebtoken');
const User = require('../models/User');

const auth = async (req, res, next) => {
  try {
    const token = req.header('Authorization')?.replace('Bearer ', '');
    
    if (!token) {
      return res.status(401).json({ message: 'No token, authorization denied' });
    }

    const decoded = jwt.verify(token, process.env.JWT_SECRET);
    const user = await User.findByPk(decoded.id, {
      attributes: { exclude: ['password'] }
    });
    
    if (!user) {
      return res.status(401).json({ message: 'Token is not valid' });
    }

    req.user = user;
    next();
  } catch (error) {
    res.status(401).json({ message: 'Token is not valid' });
  }
};

// Admin and Organizer access (for most admin features)
const adminAuth = (req, res, next) => {
  if (req.user.role !== 'admin' && req.user.role !== 'organizer') {
    return res.status(403).json({ message: 'Access denied. Admin/Organizer only.' });
  }
  next();
};

// STRICT admin-only access for sensitive operations like delete
const adminOnlyAuth = (req, res, next) => {
  if (req.user && req.user.role === 'admin') {
    next();
  } else {
    res.status(403).json({ 
      message: 'Access denied. Admin privileges required for this operation.',
      userRole: req.user?.role 
    });
  }
};

module.exports = { auth, adminAuth, adminOnlyAuth };

# ==== ./backend/config/database.js ====

const { Sequelize } = require('sequelize');
const path = require('path');

// SQLite database file will be created automatically
const sequelize = new Sequelize({
  dialect: 'sqlite',
  storage: path.join(__dirname, '../database.sqlite'),
  logging: false, // Set to console.log to see SQL queries
});

const connectDB = async () => {
  try {
    await sequelize.authenticate();
    console.log('SQLite database connected successfully');
    
    // Sync all models
    await sequelize.sync({ alter: true });
    console.log('Database tables created/updated');
  } catch (error) {
    console.error('Database connection error:', error);
    process.exit(1);
  }
};

module.exports = { sequelize, connectDB };

# ==== ./backend/models/User.js ====

const { DataTypes } = require('sequelize');
const { sequelize } = require('../config/database');
const bcrypt = require('bcryptjs');

const User = sequelize.define('User', {
  id: {
    type: DataTypes.UUID,
    defaultValue: DataTypes.UUIDV4,
    primaryKey: true,
  },
  membershipId: {
    type: DataTypes.STRING,
    unique: true,
    allowNull: false,
  },
  
  // Existing fields (keeping your structure)
  fullName: {
    type: DataTypes.STRING,
    allowNull: false,
  },
  fatherName: {
    type: DataTypes.STRING,
    allowNull: false,
  },
  address: {
    type: DataTypes.TEXT,
    allowNull: false,
  },
  phone: {
    type: DataTypes.STRING,
    allowNull: false,
  },
  email: {
    type: DataTypes.STRING,
    allowNull: false,
    unique: true,
  },
  dateOfBirth: {
    type: DataTypes.DATE,
    allowNull: false,
  },
  occupation: {
    type: DataTypes.STRING,
  },
  constituency: {
    type: DataTypes.STRING,
  },
  profilePhoto: {
    type: DataTypes.STRING,
  },
  role: {
    type: DataTypes.ENUM('member', 'organizer', 'admin'),
    defaultValue: 'member',
  },
  password: {
    type: DataTypes.STRING,
    allowNull: false,
  },
  qrCode: {
    type: DataTypes.TEXT,
  },
  qrCodeData: {
    type: DataTypes.TEXT,
  },
  isVerified: {
    type: DataTypes.BOOLEAN,
    defaultValue: false,
  },
  registeredBy: {
    type: DataTypes.UUID,
  },
  
  // NEW Aadhar-specific fields (to be added via migration)
  aadharNumber: {
    type: DataTypes.STRING(12),
    allowNull: true,
    validate: {
      len: [12, 12],
      isNumeric: true
    }
  },
  aadharVerified: {
    type: DataTypes.BOOLEAN,
    defaultValue: false
  },
  aadharVerificationDate: {
    type: DataTypes.DATE,
    allowNull: true
  },
  
  // Additional fields for enhanced registration
  gender: {
    type: DataTypes.STRING,
    allowNull: true
  },
  city: {
    type: DataTypes.STRING,
    allowNull: true
  },
  state: {
    type: DataTypes.STRING,
    allowNull: true
  },
  pincode: {
    type: DataTypes.STRING,
    allowNull: true
  },
  isActive: {
    type: DataTypes.BOOLEAN,
    defaultValue: true
  }
}, {
  tableName: 'users',
  timestamps: true,
  hooks: {
    beforeCreate: async (user) => {
      // Hash password if provided
      if (user.password) {
        const salt = await bcrypt.genSalt(10);
        user.password = await bcrypt.hash(user.password, salt);
      }
      
      // Generate membership ID if not provided
      if (!user.membershipId) {
        const timestamp = Date.now().toString().slice(-6);
        const random = Math.random().toString(36).substring(2, 6).toUpperCase();
        user.membershipId = `GJF${timestamp}${random}`;
      }
      
      // Set Aadhar verification date if verified
      if (user.aadharVerified) {
        user.aadharVerificationDate = new Date();
      }
    },
    beforeUpdate: async (user) => {
      // Hash password if changed
      if (user.changed('password') && user.password) {
        const salt = await bcrypt.genSalt(10);
        user.password = await bcrypt.hash(user.password, salt);
      }
      
      // Update verification date if Aadhar status changed
      if (user.changed('aadharVerified') && user.aadharVerified) {
        user.aadharVerificationDate = new Date();
      }
    }
  }
});

// Instance method to check password
User.prototype.validatePassword = async function(password) {
  return await bcrypt.compare(password, this.password);
};

// Instance method to get public profile
User.prototype.getPublicProfile = function() {
  const { password, ...publicData } = this.toJSON();
  return {
    ...publicData,
    hasAadhar: !!this.aadharNumber,
    verificationStatus: this.aadharVerified ? 'verified' : 'unverified'
  };
};

module.exports = User;

# ==== ./backend/scripts/createAdmin.js ====

const { sequelize } = require('../config/database');
const User = require('../models/User');
const bcrypt = require('bcryptjs');
const QRCode = require('qrcode');
const { v4: uuidv4 } = require('uuid');

const createAdminUser = async () => {
  try {
    // Connect to database
    await sequelize.authenticate();
    await sequelize.sync();

    // Check if admin already exists
    const adminExists = await User.findOne({ where: { role: 'admin' } });
    if (adminExists) {
      console.log('Admin user already exists:');
      console.log('Email:', adminExists.email);
      console.log('You can use this account to login');
      
      return;
    }

    // Hash password
    const hashedPassword = await bcrypt.hash('pass1', 12);
    
    // Generate membership ID
    const membershipId = 'GJMF-ADMIN-2026';
    
    // Create QR code data
    const qrData = {
      membershipId,
      name: 'System Administrator',
      phone: '+91-9999999999',
      id: uuidv4()
    };
    
    // Generate QR code
    const qrCode = await QRCode.toDataURL(JSON.stringify(qrData));

    // Create admin user
    const adminUser = await User.create({
      membershipId,
      fullName: 'System Administrator',
      fatherName: 'System',
      address: 'Party Headquarters',
      phone: '+91-9999999999',
      email: 'admin@gmail.com',
      dateOfBirth: new Date('1990-01-01'),
      occupation: 'Administrator',
      constituency: 'Central Office',
      password: hashedPassword,
      role: 'admin',
      qrCode,
      qrCodeData: JSON.stringify(qrData),
      isVerified: true
    });

    console.log('✅ Admin user created successfully!');
    console.log('📧 Email: admin@gmail.com');
    console.log('🔑 Password: pass1');
    console.log('🆔 Membership ID:', adminUser.membershipId);
    console.log('\nYou can now login with these credentials.');
    
    process.exit(0);
  } catch (error) {
    console.error('❌ Error creating admin user:', error);
    process.exit(1);
  }
};

createAdminUser();

# ==== ./backend/scripts/addAadharFieldsToExisting.js ====

const { sequelize } = require('../config/database');

async function addAadharFieldsToExisting() {
  try {
    console.log('🔄 Adding Aadhar fields to existing users table...');

    const queryInterface = sequelize.getQueryInterface();

    // Check if columns already exist before adding
    const tableDescription = await queryInterface.describeTable('users');
    
    // Add aadharNumber if it doesn't exist
    if (!tableDescription.aadharNumber) {
      await queryInterface.addColumn('users', 'aadharNumber', {
        type: sequelize.Sequelize.STRING(12),
        allowNull: true,
        unique: true
      });
      console.log('✅ Added aadharNumber column');
    } else {
      console.log('ℹ️ aadharNumber column already exists');
    }

    // Add aadharVerified if it doesn't exist
    if (!tableDescription.aadharVerified) {
      await queryInterface.addColumn('users', 'aadharVerified', {
        type: sequelize.Sequelize.BOOLEAN,
        defaultValue: false
      });
      console.log('✅ Added aadharVerified column');
    } else {
      console.log('ℹ️ aadharVerified column already exists');
    }

    // Add aadharVerificationDate if it doesn't exist
    if (!tableDescription.aadharVerificationDate) {
      await queryInterface.addColumn('users', 'aadharVerificationDate', {
        type: sequelize.Sequelize.DATE,
        allowNull: true
      });
      console.log('✅ Added aadharVerificationDate column');
    } else {
      console.log('ℹ️ aadharVerificationDate column already exists');
    }

    // Add gender if it doesn't exist
    if (!tableDescription.gender) {
      await queryInterface.addColumn('users', 'gender', {
        type: sequelize.Sequelize.STRING,
        allowNull: true
      });
      console.log('✅ Added gender column');
    } else {
      console.log('ℹ️ gender column already exists');
    }

    // Add city if it doesn't exist
    if (!tableDescription.city) {
      await queryInterface.addColumn('users', 'city', {
        type: sequelize.Sequelize.STRING,
        allowNull: true
      });
      console.log('✅ Added city column');
    } else {
      console.log('ℹ️ city column already exists');
    }

    // Add state if it doesn't exist
    if (!tableDescription.state) {
      await queryInterface.addColumn('users', 'state', {
        type: sequelize.Sequelize.STRING,
        allowNull: true
      });
      console.log('✅ Added state column');
    } else {
      console.log('ℹ️ state column already exists');
    }

    // Add pincode if it doesn't exist
    if (!tableDescription.pincode) {
      await queryInterface.addColumn('users', 'pincode', {
        type: sequelize.Sequelize.STRING,
        allowNull: true
      });
      console.log('✅ Added pincode column');
    } else {
      console.log('ℹ️ pincode column already exists');
    }

    // Add isActive if it doesn't exist
    if (!tableDescription.isActive) {
      await queryInterface.addColumn('users', 'isActive', {
        type: sequelize.Sequelize.BOOLEAN,
        defaultValue: true
      });
      console.log('✅ Added isActive column');
    } else {
      console.log('ℹ️ isActive column already exists');
    }

    console.log('🎉 Migration completed successfully!');

  } catch (error) {
    console.error('❌ Migration failed:', error);
    throw error;
  }
}

// Run migration if called directly
if (require.main === module) {
  addAadharFieldsToExisting()
    .then(() => {
      console.log('✅ All Aadhar fields added successfully');
      process.exit(0);
    })
    .catch((error) => {
      console.error('💥 Migration failed:', error);
      process.exit(1);
    });
}

module.exports = addAadharFieldsToExisting;


# ==== ./backend/controllers/memberController.js ====

// File: backend/controllers/memberController.js

const User = require('../models/User');
const { sendRoleUpdateEmail } = require('../services/emailService');

const getProfile = async (req, res) => {
  try {
    const user = await User.findByPk(req.user.id, {
      attributes: { exclude: ['password', 'qrCodeData'] } // Exclude only sensitive data
    });
    
    if (!user) {
      return res.status(404).json({ message: 'User not found' });
    }
    
    res.json(user);
  } catch (error) {
    res.status(500).json({ message: 'Server error', error: error.message });
  }
};

const getAllMembers = async (req, res) => {
  try {
    const members = await User.findAll({
      attributes: { exclude: ['password', 'qrCodeData'] }
    });
    
    // This formatting is unnecessary if the frontend is updated to handle the flat object
    res.json(members);
  } catch (error) {
    res.status(500).json({ message: 'Server error', error: error.message });
  }
};

const scanQRCode = async (req, res) => {
  try {
    const { qrData } = req.body;
    
    const parsedData = JSON.parse(qrData);
    const user = await User.findOne({ 
      where: { membershipId: parsedData.membershipId },
      attributes: { exclude: ['password'] }
    });
    
    if (!user) {
      return res.status(404).json({ message: 'Member not found' });
    }

    res.json({
      membershipId: user.membershipId,
      name: user.fullName,
      phone: user.phone,
      email: user.email,
      constituency: user.constituency,
      profilePhoto: user.profilePhoto,
      joinDate: user.createdAt
    });
  } catch (error) {
    res.status(500).json({ message: 'Invalid QR Code', error: error.message });
  }
};

const updateMemberRole = async (req, res) => {
  try {
    const { id } = req.params;
    const { role } = req.body;

    if (!['member', 'organizer', 'admin'].includes(role)) {
      return res.status(400).json({ message: 'Invalid role specified' });
    }

    const user = await User.findByPk(id);
    if (!user) {
      return res.status(404).json({ message: 'Member not found' });
    }

    const oldRole = user.role;
    await user.update({ role });

    if (oldRole !== role) {
      const emailData = {
        name: user.fullName,
        email: user.email,
        membershipId: user.membershipId,
      };
      
      sendRoleUpdateEmail(emailData, role).catch(error => {
        console.error('Failed to send role update email:', error);
      });
    }

    res.json({
      message: 'Role updated successfully',
      member: {
        id: user.id,
        name: user.fullName,
        email: user.email,
        role: user.role
      }
    });
  } catch (error) {
    res.status(500).json({ message: 'Server error', error: error.message });
  }
};

const deleteMember = async (req, res) => {
  try {
    const { id } = req.params;
    const { confirmationText } = req.body;

    if (!id) {
      return res.status(400).json({ message: 'Member ID is required' });
    }

    if (confirmationText !== 'DELETE MEMBER') {
      return res.status(400).json({ 
        message: 'Confirmation text required. Type "DELETE MEMBER" to confirm.',
        received: confirmationText,
        expected: 'DELETE MEMBER'
      });
    }

    const member = await User.findByPk(id);
    
    if (!member) {
      const memberByMembershipId = await User.findOne({ 
        where: { membershipId: id } 
      });
      if (memberByMembershipId) {
        return res.status(400).json({ 
          message: 'Please use the database ID, not membership ID',
          hint: `Database ID for ${memberByMembershipId.fullName} is: ${memberByMembershipId.id}`
        });
      }
      return res.status(404).json({ message: 'Member not found' });
    }

    if (member.id === req.user.id) {
      return res.status(400).json({ 
        message: 'Cannot delete your own account' 
      });
    }

    if (member.role === 'admin' && req.user.role !== 'superadmin') {
      return res.status(403).json({ 
        message: 'Cannot delete other admin accounts' 
      });
    }

    const memberInfo = {
      name: member.fullName,
      membershipId: member.membershipId,
      email: member.email,
      role: member.role
    };
    
    await member.destroy();

    res.json({
      success: true,
      message: 'Member deleted successfully',
      deletedMember: memberInfo,
      timestamp: new Date().toISOString()
    });
    
  } catch (error) {
    console.error('Error deleting member:', error);
    
    res.status(500).json({ 
      success: false,
      message: 'Server error occurred while deleting member', 
      error: error.message,
      errorType: error.name,
      timestamp: new Date().toISOString()
    });
  }
};

const updateProfile = async (req, res) => {
  try {
    const userId = req.user.id;
    const { 
      fullName, 
      fatherName, 
      address, 
      phone, 
      email, 
      dateOfBirth, 
      occupation, 
      constituency,
      gender,
      city,
      state,
      pincode,
      aadharNumber
    } = req.body;

    const user = await User.findByPk(userId);
    if (!user) {
      return res.status(404).json({ message: 'User not found' });
    }

    const updateData = {};
    if (fullName !== undefined) updateData.fullName = fullName;
    if (fatherName !== undefined) updateData.fatherName = fatherName;
    if (address !== undefined) updateData.address = address;
    if (phone !== undefined) updateData.phone = phone;
    if (email !== undefined) updateData.email = email;
    if (dateOfBirth !== undefined) updateData.dateOfBirth = dateOfBirth;
    if (occupation !== undefined) updateData.occupation = occupation;
    if (constituency !== undefined) updateData.constituency = constituency;
    if (gender !== undefined) updateData.gender = gender;
    if (city !== undefined) updateData.city = city;
    if (state !== undefined) updateData.state = state;
    if (pincode !== undefined) updateData.pincode = pincode;
    if (aadharNumber !== undefined) updateData.aadharNumber = aadharNumber;

    if (req.file) {
      updateData.profilePhoto = `uploads/${req.file.filename}`;
    }

    await user.update(updateData);

    const updatedUser = await User.findByPk(userId, {
      attributes: { exclude: ['password'] }
    });

    res.json({
      message: 'Profile updated successfully',
      profile: updatedUser // Return the full updated user object
    });

  } catch (error) {
    console.error('Error updating profile:', error);
    res.status(500).json({ 
      message: 'Server error occurred while updating profile', 
      error: error.message 
    });
  }
};

module.exports = { 
  getProfile, 
  getAllMembers, 
  scanQRCode, 
  updateMemberRole, 
  deleteMember,
  updateProfile 
};

# ==== ./backend/controllers/authController.js ====

// backend/controllers/authController.js - COMPLETE FILE using bcryptjs
const bcryptjs = require('bcryptjs'); // Using bcryptjs instead of bcrypt
const jwt = require('jsonwebtoken');
const { Op } = require('sequelize');
const User = require('../models/User');
const QRCode = require('qrcode');
const { v4: uuidv4 } = require('uuid');

const register = async (req, res) => {
  try {
    const { 
      fullName, 
      fatherName, 
      email, 
      phone,
      dateOfBirth,
      occupation,
      address,
      constituency,
      password,
      verificationMethod,
      aadharNumber,
      aadharVerified
    } = req.body;

    console.log('📝 Registration request:', req.body);

    // Validate required fields
    if (!fullName || !email || !password) {
      return res.status(400).json({ message: 'Full name, email, and password are required' });
    }

    // Check if user already exists
    const existingUser = await User.findOne({ 
      where: {
        [Op.or]: [
          { email },
          ...(phone ? [{ phone }] : [])
        ]
      }
    });

    if (existingUser) {
      return res.status(400).json({ message: 'User with this email or phone already exists' });
    }

    // Hash password using bcryptjs
    const hashedPassword = await bcryptjs.hash(password, 12);

    // Generate unique membership ID
    const membershipId = `GJF${Date.now().toString().slice(-6)}${Math.floor(Math.random() * 100).toString().padStart(2, '0')}`;

    // Handle profile photo
    let profilePhotoPath = null;
    if (req.file) {
      profilePhotoPath = req.file.path.replace(/\\/g, '/');
    }

    // Generate QR code data
    const qrCodeData = JSON.stringify({
      membershipId,
      name: fullName,
      email,
      phone: phone || '',
    });

    // Generate QR code
    const qrCodeUrl = await QRCode.toDataURL(qrCodeData);

    // Create user
    const user = await User.create({
      membershipId,
      fullName,
      fatherName,
      email,
      phone,
      dateOfBirth,
      occupation,
      address,
      constituency,
      password: hashedPassword,
      profilePhoto: profilePhotoPath,
      qrCode: qrCodeUrl,
      qrCodeData,
      role: 'member',
      isVerified: aadharVerified === 'true' || aadharVerified === true,
      isActive: true,
      aadharNumber: aadharNumber || null,
      aadharVerified: aadharVerified === 'true' || aadharVerified === true,
      verificationMethod: verificationMethod || 'manual'
    });

    // Generate JWT token
    const token = jwt.sign({ id: user.id }, process.env.JWT_SECRET, { expiresIn: '30d' });

    res.status(201).json({
      message: 'Registration successful! Check your email for membership card.',
      token,
      user: {
        id: user.id,
        membershipId: user.membershipId,
        name: user.fullName,
        email: user.email,
        role: user.role,
        qrCode: user.qrCode
      }
    });
  } catch (error) {
    console.error('Registration error:', error);
    res.status(500).json({ message: 'Server error', error: error.message });
  }
};

const login = async (req, res) => {
  try {
    const { identifier, password } = req.body;

    console.log('🔐 Login attempt:', { 
      identifier: identifier ? identifier.substring(0, 3) + '***' : 'missing', 
      password: password ? '***' : 'missing' 
    });

    // Validate input
    if (!identifier || !password) {
      return res.status(400).json({ message: 'Email/phone and password are required' });
    }

    // Find user by email OR phone number
    const user = await User.findOne({ 
      where: {
        [Op.or]: [
          { email: identifier },
          { phone: identifier }
        ]
      }
    });

    if (!user) {
      console.log('❌ User not found for identifier:', identifier);
      return res.status(400).json({ message: 'Invalid credentials' });
    }

    console.log('👤 User found:', { 
      id: user.id, 
      email: user.email, 
      role: user.role,
      isActive: user.isActive 
    });

    // Check password using bcryptjs
    const isMatch = await bcryptjs.compare(password, user.password);
    if (!isMatch) {
      console.log('❌ Password mismatch for user:', user.email);
      return res.status(400).json({ message: 'Invalid credentials' });
    }

    // Check if user is active
    if (!user.isActive) {
      return res.status(400).json({ message: 'Account is deactivated. Please contact admin.' });
    }

    // Generate JWT token
    const token = jwt.sign({ id: user.id }, process.env.JWT_SECRET, { expiresIn: '30d' });

    console.log('✅ Login successful for:', user.email);

    res.json({
      message: 'Login successful',
      token,
      user: {
        id: user.id,
        membershipId: user.membershipId,
        name: user.fullName,
        fullName: user.fullName,
        email: user.email,
        phone: user.phone,
        role: user.role,
        isVerified: user.isVerified,
        profilePhoto: user.profilePhoto,
        qrCode: user.qrCode,
        qrCodeData: user.qrCodeData,
        dateOfBirth: user.dateOfBirth,
        occupation: user.occupation,
        address: user.address,
        constituency: user.constituency,
        fatherName: user.fatherName,
        city: user.city,
        state: user.state,
        pincode: user.pincode,
        aadharNumber: user.aadharNumber,
        aadharVerified: user.aadharVerified,
        isActive: user.isActive,
        createdAt: user.createdAt,
        updatedAt: user.updatedAt,
      }
    });
  } catch (error) {
    console.error('🚨 Login error:', error);
    res.status(500).json({ message: 'Server error', error: error.message });
  }
};

module.exports = { register, login };

# ==== ./backend/routes/auth.js ====

// backend/routes/auth.js - COMPLETE FILE
const express = require('express');
const multer = require('multer');
const path = require('path');
const { register, login } = require('../controllers/authController');

const router = express.Router();

// Multer configuration for file upload
const storage = multer.diskStorage({
  destination: (req, file, cb) => {
    cb(null, 'uploads/');
  },
  filename: (req, file, cb) => {
    cb(null, Date.now() + path.extname(file.originalname));
  }
});

const upload = multer({ 
  storage: storage,
  limits: { fileSize: 5 * 1024 * 1024 }, // 5MB limit
  fileFilter: (req, file, cb) => {
    const allowedTypes = /jpeg|jpg|png/;
    const extname = allowedTypes.test(path.extname(file.originalname).toLowerCase());
    const mimetype = allowedTypes.test(file.mimetype);

    if (mimetype && extname) {
      return cb(null, true);
    } else {
      cb(new Error('Only image files are allowed'));
    }
  }
});

// Error handling middleware for multer
const uploadHandler = (req, res, next) => {
  upload.single('profilePhoto')(req, res, (err) => {
    if (err instanceof multer.MulterError) {
      // A multer error occurred during upload
      return res.status(400).json({ message: err.message });
    } else if (err) {
      // An unknown error occurred when uploading
      return res.status(500).json({ message: err.message });
    }
    // Everything went fine
    next();
  });
};

// Routes
router.post('/register', uploadHandler, register);
router.post('/login', login);

module.exports = router;

# ==== ./backend/routes/members.js ====

// backend/routes/members.js - COMPLETE FILE
const express = require('express');
const multer = require('multer');
const path = require('path');
const { auth, adminAuth, adminOnlyAuth } = require('../middleware/auth');
const { getProfile, getAllMembers, scanQRCode, updateMemberRole, deleteMember, updateProfile } = require('../controllers/memberController');

const router = express.Router();

// Multer configuration for profile photo upload
const storage = multer.diskStorage({
  destination: (req, file, cb) => {
    cb(null, 'uploads/');
  },
  filename: (req, file, cb) => {
    cb(null, Date.now() + path.extname(file.originalname));
  }
});

const upload = multer({ 
  storage: storage,
  limits: { fileSize: 5 * 1024 * 1024 }, // 5MB limit
  fileFilter: (req, file, cb) => {
    const allowedTypes = /jpeg|jpg|png/;
    const extname = allowedTypes.test(path.extname(file.originalname).toLowerCase());
    const mimetype = allowedTypes.test(file.mimetype);

    if (mimetype && extname) {
      return cb(null, true);
    } else {
      cb(new Error('Only image files are allowed'));
    }
  }
});

// Profile routes
router.get('/profile', auth, getProfile);
router.put('/profile', auth, upload.single('profilePhoto'), updateProfile);

// Admin routes
router.get('/all', auth, adminAuth, getAllMembers);
router.post('/scan', auth, adminAuth, scanQRCode);
router.put('/role/:id', auth, adminAuth, updateMemberRole);

// Delete route - ADMIN ONLY
router.delete('/:id', auth, adminOnlyAuth, deleteMember);

module.exports = router;

# ==== ./backend/services/emailService.js ====

const nodemailer = require('nodemailer');

// Configure email transporter
const transporter = nodemailer.createTransport({
  host: process.env.EMAIL_HOST || 'smtp.gmail.com',
  port: process.env.EMAIL_PORT || 587,
  secure: false,
  auth: {
    user: process.env.EMAIL_USER,
    pass: process.env.EMAIL_PASS,
  },
});

// Generate HTML membership card
const generateMembershipCardHTML = (userData) => {
  return `
    <!DOCTYPE html>
    <html>
    <head>
        <meta charset="UTF-8">
        <style>
            body {
                font-family: 'Arial', sans-serif;
                margin: 0;
                padding: 20px;
                background-color: #f5f5f5;
            }
            .card-container {
                max-width: 600px;
                margin: 0 auto;
                background-color: white;
                border-radius: 15px;
                overflow: hidden;
                box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            }
            .header {
                background: linear-gradient(135deg, #1B2951 0%, #2D5016 100%);
                color: white;
                padding: 30px;
                text-align: center;
            }
            .logo-text {
                font-size: 28px;
                font-weight: bold;
                margin-bottom: 10px;
                letter-spacing: 2px;
            }
            .subtitle {
                font-size: 16px;
                opacity: 0.9;
                margin-bottom: 5px;
            }
            .card-type {
                font-size: 14px;
                opacity: 0.8;
                background-color: rgba(255,255,255,0.2);
                padding: 5px 15px;
                border-radius: 15px;
                display: inline-block;
                margin-top: 10px;
            }
            .member-info {
                padding: 30px;
                background-color: white;
            }
            .member-row {
                display: flex;
                margin-bottom: 15px;
                border-bottom: 1px solid #f0f0f0;
                padding-bottom: 10px;
            }
            .member-row:last-child {
                border-bottom: none;
                margin-bottom: 0;
            }
            .label {
                font-weight: bold;
                color: #1B2951;
                width: 140px;
                font-size: 14px;
            }
            .value {
                color: #333;
                flex: 1;
                font-size: 14px;
            }
            .membership-id {
                background-color: #E8F5E8;
                color: #2D5016;
                font-weight: bold;
                padding: 8px 15px;
                border-radius: 8px;
                font-family: monospace;
                letter-spacing: 1px;
            }
            .qr-section {
                text-align: center;
                padding: 20px;
                background-color: #f8f9fa;
                border-top: 2px solid #2D5016;
            }
            .qr-title {
                font-size: 16px;
                font-weight: bold;
                color: #1B2951;
                margin-bottom: 15px;
            }
            .qr-note {
                font-size: 12px;
                color: #666;
                margin-top: 15px;
                font-style: italic;
            }
            .footer {
                background-color: #1B2951;
                color: white;
                padding: 20px;
                text-align: center;
            }
            .footer-text {
                font-size: 14px;
                margin-bottom: 10px;
            }
            .contact-info {
                font-size: 12px;
                opacity: 0.8;
                line-height: 1.5;
            }
            .welcome-message {
                background-color: #E8F5E8;
                border-left: 4px solid #2D5016;
                padding: 20px;
                margin: 20px 0;
                font-size: 16px;
                line-height: 1.6;
                color: #2D5016;
            }
        </style>
    </head>
    <body>
        <div class="card-container">
            <!-- Header -->
            <div class="header">
                <div class="logo-text">GORKHA JANSHAKTI FRONT</div>
                <div class="subtitle">गोर्खा जनशक्ति फ्रन्ट</div>
                <div class="card-type">OFFICIAL MEMBERSHIP CARD</div>
            </div>

            <!-- Welcome Message -->
            <div class="welcome-message">
                <strong>Welcome to Gorkha Janshakti Front!</strong><br>
                We are honored to have you as a member of our movement. Your membership represents our collective strength in serving the Gorkha community.
            </div>

            <!-- Member Information -->
            <div class="member-info">
                <div class="member-row">
                    <div class="label">Full Name:</div>
                    <div class="value">${userData.fullName}</div>
                </div>
                <div class="member-row">
                    <div class="label">Father's Name:</div>
                    <div class="value">${userData.fatherName}</div>
                </div>
                <div class="member-row">
                    <div class="label">Membership ID:</div>
                    <div class="value">
                        <span class="membership-id">${userData.membershipId}</span>
                    </div>
                </div>
                <div class="member-row">
                    <div class="label">Phone:</div>
                    <div class="value">${userData.phone}</div>
                </div>
                <div class="member-row">
                    <div class="label">Email:</div>
                    <div class="value">${userData.email}</div>
                </div>
                <div class="member-row">
                    <div class="label">Constituency:</div>
                    <div class="value">${userData.constituency || 'Not specified'}</div>
                </div>
                <div class="member-row">
                    <div class="label">Member Since:</div>
                    <div class="value">${new Date().toLocaleDateString('en-IN')}</div>
                </div>
                <div class="member-row">
                    <div class="label">Status:</div>
                    <div class="value" style="color: #2D5016; font-weight: bold;">ACTIVE MEMBER</div>
                </div>
            </div>

            <!-- QR Code Section -->
            <div class="qr-section">
                <div class="qr-title">Verification QR Code</div>
                <div style="margin: 15px 0;">
                    <div style="background-color: white; padding: 10px; border-radius: 8px; display: inline-block;">
                        QR Code: ${userData.membershipId}
                    </div>
                </div>
                <div class="qr-note">
                    Use the mobile app to access your QR code for instant verification.
                </div>
            </div>

            <!-- Footer -->
            <div class="footer">
                <div class="footer-text">Thank you for joining our movement!</div>
                <div class="contact-info">
                    Party Headquarters<br>
                    Phone: +91-1234567890<br>
                    Email: contact@gorkhajanshakti.org
                </div>
            </div>
        </div>
    </body>
    </html>
  `;
};

// Send membership card email
const sendMembershipCard = async (userData) => {
  try {
    const membershipCardHTML = generateMembershipCardHTML(userData);

    const mailOptions = {
      from: {
        name: 'Gorkha Janshakti Front',
        address: process.env.EMAIL_USER
      },
      to: userData.email,
      subject: `Welcome to Gorkha Janshakti Front - Membership ID: ${userData.membershipId}`,
      html: `
        <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
          <h1 style="color: #1B2951;">Welcome to Gorkha Janshakti Front!</h1>
          
          <p>Dear <strong>${userData.fullName}</strong>,</p>
          
          <p>Congratulations! Your membership registration has been successfully completed.</p>
          
          <div style="background-color: #E8F5E8; padding: 15px; border-radius: 8px; margin: 20px 0;">
            <h3 style="color: #2D5016; margin-top: 0;">Your Membership Details:</h3>
            <ul style="color: #2D5016;">
              <li><strong>Membership ID:</strong> ${userData.membershipId}</li>
              <li><strong>Registration Date:</strong> ${new Date().toLocaleDateString('en-IN')}</li>
              <li><strong>Status:</strong> Active Member</li>
            </ul>
          </div>

          <p>Your detailed membership card is below:</p>

          ${membershipCardHTML}

          <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #ddd;">
            <p>Best regards,<br>
            <strong>Gorkha Janshakti Front</strong><br>
            Membership Committee</p>
          </div>
        </div>
      `,
    };

    await transporter.sendMail(mailOptions);
    console.log('Membership card email sent successfully to:', userData.email);
    return { success: true };
  } catch (error) {
    console.error('Error sending membership card email:', error);
    return { success: false, error: error.message };
  }
};

// Send role update email
const sendRoleUpdateEmail = async (userData, newRole) => {
  try {
    const roleNames = {
      member: 'Member',
      organizer: 'Organizer',
      admin: 'Administrator'
    };

    const mailOptions = {
      from: {
        name: 'Gorkha Janshakti Front',
        address: process.env.EMAIL_USER
      },
      to: userData.email,
      subject: `Role Updated - You are now an ${roleNames[newRole]}`,
      html: `
        <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
          <h1 style="color: #1B2951;">Role Update Notification</h1>
          
          <p>Dear <strong>${userData.name}</strong>,</p>
          
          <p>Your role in Gorkha Janshakti Front has been updated.</p>
          
          <div style="background-color: #E8F5E8; padding: 20px; border-radius: 8px; margin: 20px 0; text-align: center;">
            <h2 style="color: #2D5016; margin-top: 0;">New Role: ${roleNames[newRole]}</h2>
          </div>

          <p>Please log into the mobile app to access your new features.</p>

          <p>Best regards,<br>
          <strong>Gorkha Janshakti Front</strong><br>
          Administration Team</p>
        </div>
      `,
    };

    await transporter.sendMail(mailOptions);
    console.log('Role update email sent successfully to:', userData.email);
    return { success: true };
  } catch (error) {
    console.error('Error sending role update email:', error);
    return { success: false, error: error.message };
  }
};

module.exports = {
  sendMembershipCard,
  sendRoleUpdateEmail,
};